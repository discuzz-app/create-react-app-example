/*! For license information please see 62.40e53483.chunk.js.LICENSE.txt */
(self.webpackChunkreact1=self.webpackChunkreact1||[]).push([[62],{7757:function(e,t,n){e.exports=n(9727)},1492:function(e,t,n){"use strict";n.d(t,{BH:function(){return g},LL:function(){return C},ZR:function(){return D},US:function(){return p},tV:function(){return m},$s:function(){return H},Sg:function(){return k},ne:function(){return j},vZ:function(){return F},pd:function(){return B},Rd:function(){return _},m9:function(){return W},z$:function(){return w},ru:function(){return E},d:function(){return T},xb:function(){return P},w1:function(){return x},hl:function(){return Z},uI:function(){return b},b$:function(){return I},G6:function(){return A},Mn:function(){return S},DO:function(){return M},xO:function(){return U},zd:function(){return q}});var r=n(7762),i=n(9439),a=n(7326),o=n(136),u=n(3668),s=n(1120),c=n(9611);var l=n(5647);function h(e){var t="function"===typeof Map?new Map:void 0;return h=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return(0,l.Z)(e,arguments,(0,s.Z)(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,c.Z)(r,e)},h(e)}var f=n(5671),d=n(9521),v=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},p={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,u=o?e[i+1]:0,s=i+2<e.length,c=s?e[i+2]:0,l=a>>2,h=(3&a)<<4|u>>4,f=(15&u)<<2|c>>6,d=63&c;s||(d=64,o||(f=64)),r.push(n[l],n[h],n[f],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(v(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var u=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&u)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,u=++i<e.length?n[e.charAt(i)]:64,s=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==u||null==s)throw Error();var c=a<<2|o>>4;if(r.push(c),64!==u){var l=o<<4&240|u>>2;if(r.push(l),64!==s){var h=u<<6&192|s;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},y=function(e){return function(e){var t=v(e);return p.encodeByteArray(t,!0)}(e).replace(/\./g,"")},m=function(e){try{return p.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};var g=function(){function e(){var t=this;(0,f.Z)(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return(0,d.Z)(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();function k(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[y(JSON.stringify({alg:"none",type:"JWT"})),y(JSON.stringify(a)),""].join(".")}function w(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function E(){var e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function I(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function T(){return w().indexOf("Electron/")>=0}function x(){var e=w();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function S(){return w().indexOf("MSAppHost/")>=0}function A(){return!function(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Z(){return"object"===typeof indexedDB}function _(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}var D=function(e){(0,o.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var o;return(0,f.Z)(this,n),(o=t.call(this,r)).code=e,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf((0,a.Z)(o),n.prototype),Error.captureStackTrace&&Error.captureStackTrace((0,a.Z)(o),C.prototype.create),o}return(0,d.Z)(n)}(h(Error)),C=function(){function e(t,n,r){(0,f.Z)(this,e),this.service=t,this.serviceName=n,this.errors=r}return(0,d.Z)(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?N(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,")."),o=new D(n,a,t);return o}}]),e}();function N(e,t){return e.replace(R,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}var R=/\{\$([^}]+)}/g;function L(e){return JSON.parse(e)}var O=function(e){var t={},n={},r={},i="";try{var a=e.split(".");t=L(m(a[0])||""),n=L(m(a[1])||""),i=a[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}},M=function(e){var t=O(e).claims;return"object"===typeof t&&t.hasOwnProperty("iat")?t.iat:null};function P(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function F(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var u=e[o],s=t[o];if(V(u)&&V(s)){if(!F(u,s))return!1}else if(u!==s)return!1}for(var c=0,l=r;c<l.length;c++){var h=l[c];if(!n.includes(h))return!1}return!0}function V(e){return null!==e&&"object"===typeof e}function U(e){for(var t=[],n=function(){var e=(0,i.Z)(a[r],2),n=e[0],o=e[1];Array.isArray(o)?o.forEach((function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(o))},r=0,a=Object.entries(e);r<a.length;r++)n();return t.length?"&"+t.join("&"):""}function q(e){var t={};return e.replace(/^\?/,"").split("&").forEach((function(e){if(e){var n=e.split("="),r=(0,i.Z)(n,2),a=r[0],o=r[1];t[decodeURIComponent(a)]=decodeURIComponent(o)}})),t}function B(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function j(e,t){var n=new K(e,t);return n.subscribe.bind(n)}var K=function(){function e(t,n){var r=this;(0,f.Z)(this,e),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then((function(){t(r)})).catch((function(e){r.error(e)}))}return(0,d.Z)(e,[{key:"next",value:function(e){this.forEachObserver((function(t){t.next(e)}))}},{key:"error",value:function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)}},{key:"complete",value:function(){this.forEachObserver((function(e){e.complete()})),this.close()}},{key:"subscribe",value:function(e,t,n){var i,a=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(i=function(e,t){if("object"!==typeof e||null===e)return!1;var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in e&&"function"===typeof e[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(i.next=G),void 0===i.error&&(i.error=G),void 0===i.complete&&(i.complete=G);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{a.finalError?i.error(a.finalError):i.complete()}catch(e){}})),this.observers.push(i),o}},{key:"unsubscribeOne",value:function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)}},{key:"sendOne",value:function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))}},{key:"close",value:function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))}}]),e}();function G(){}var z=144e5;function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(z,r+i)}function W(e){return e&&e._delegate?e._delegate:e}},9062:function(e,t,n){"use strict";n.r(t),n.d(t,{AbstractUserDataWriter:function(){return Vv},Bytes:function(){return Od},CACHE_SIZE_UNLIMITED:function(){return yd},CollectionReference:function(){return ud},DocumentReference:function(){return ad},DocumentSnapshot:function(){return vv},FieldPath:function(){return Rd},FieldValue:function(){return Md},Firestore:function(){return md},FirestoreError:function(){return Qr},GeoPoint:function(){return Pd},LoadBundleTask:function(){return pd},Query:function(){return od},QueryConstraint:function(){return wv},QueryDocumentSnapshot:function(){return pv},QuerySnapshot:function(){return yv},SnapshotMetadata:function(){return dv},Timestamp:function(){return fi},Transaction:function(){return ap},WriteBatch:function(){return Bv},_DatabaseId:function(){return Hf},_DocumentKey:function(){return Li},_EmptyAppCheckTokenProvider:function(){return ai},_EmptyAuthCredentialsProvider:function(){return Jr},_FieldPath:function(){return wi},_cast:function(){return ed},_debugAssert:function(){return zr},_isBase64Available:function(){return Ei},_logWarn:function(){return Br},_validateIsNotUsedTogether:function(){return Yf},addDoc:function(){return ep},arrayRemove:function(){return lp},arrayUnion:function(){return cp},clearIndexedDbPersistence:function(){return xd},collection:function(){return sd},collectionGroup:function(){return cd},connectFirestoreEmulator:function(){return id},deleteDoc:function(){return $v},deleteField:function(){return up},disableNetwork:function(){return Zd},doc:function(){return ld},documentId:function(){return Ld},enableIndexedDbPersistence:function(){return Ed},enableMultiTabIndexedDbPersistence:function(){return Id},enableNetwork:function(){return Ad},endAt:function(){return Lv},endBefore:function(){return Rv},ensureFirestoreConfigured:function(){return wd},executeWrite:function(){return rp},getDoc:function(){return Kv},getDocFromCache:function(){return zv},getDocFromServer:function(){return Hv},getDocs:function(){return Wv},getDocsFromCache:function(){return Qv},getDocsFromServer:function(){return Yv},getFirestore:function(){return kd},increment:function(){return hp},initializeFirestore:function(){return gd},limit:function(){return Av},limitToLast:function(){return Zv},loadBundle:function(){return Dd},namedQuery:function(){return Cd},onSnapshot:function(){return tp},onSnapshotsInSync:function(){return np},orderBy:function(){return xv},query:function(){return bv},queryEqual:function(){return fd},refEqual:function(){return hd},runTransaction:function(){return op},serverTimestamp:function(){return sp},setDoc:function(){return Xv},setLogLevel:function(){return Vr},snapshotEqual:function(){return gv},startAfter:function(){return Cv},startAt:function(){return Dv},terminate:function(){return _d},updateDoc:function(){return Jv},waitForPendingWrites:function(){return Sd},where:function(){return Iv},writeBatch:function(){return fp}});var r,i=n(5647),a=n(1752),o=n(1120),u=n(9439),s=n(7762),c=n(5861),l=n(136),h=n(3668),f=n(3433),d=n(5671),v=n(9521),p=n(7757),y=n.n(p),m=n(9474),g=n(3258),k=n(6781),w=n(1492),b="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},E={},I=I||{},T=b||self;function x(){}function S(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function A(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Z="closure_uid_"+(1e9*Math.random()>>>0),_=0;function D(e,t,n){return e.call.apply(e.bind,arguments)}function C(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function N(e,t,n){return(N=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?D:C).apply(null,arguments)}function R(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function L(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function O(){this.s=this.s,this.o=this.o}var M={};O.prototype.s=!1,O.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,Z)&&e[Z]||(e[Z]=++_)}(this);delete M[e]}},O.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var P=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},F=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"===typeof e?e.split(""):e,a=0;a<r;a++)a in i&&t.call(n,i[a],a,e)};function V(e){return Array.prototype.concat.apply([],arguments)}function U(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function q(e){return/^[\s\xa0]*$/.test(e)}var B,j=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function K(e,t){return-1!=e.indexOf(t)}function G(e,t){return e<t?-1:e>t?1:0}e:{var z=T.navigator;if(z){var H=z.userAgent;if(H){B=H;break e}}B=""}function W(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Q(e){var t={};for(var n in e)t[n]=e[n];return t}var Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<Y.length;a++)n=Y[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function J(e){return J[" "](e),e}J[" "]=x;var $,ee=K(B,"Opera"),te=K(B,"Trident")||K(B,"MSIE"),ne=K(B,"Edge"),re=ne||te,ie=K(B,"Gecko")&&!(K(B.toLowerCase(),"webkit")&&!K(B,"Edge"))&&!(K(B,"Trident")||K(B,"MSIE"))&&!K(B,"Edge"),ae=K(B.toLowerCase(),"webkit")&&!K(B,"Edge");function oe(){var e=T.document;return e?e.documentMode:void 0}e:{var ue="",se=function(){var e=B;return ie?/rv:([^\);]+)(\)|;)/.exec(e):ne?/Edge\/([\d\.]+)/.exec(e):te?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):ae?/WebKit\/(\S+)/.exec(e):ee?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(se&&(ue=se?se[1]:""),te){var ce=oe();if(null!=ce&&ce>parseFloat(ue)){$=String(ce);break e}}$=ue}var le,he={};function fe(){return function(e){var t=he;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){for(var e=0,t=j(String($)).split("."),n=j("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var a=t[i]||"",o=n[i]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==a[0].length&&0==o[0].length)break;e=G(0==a[1].length?0:parseInt(a[1],10),0==o[1].length?0:parseInt(o[1],10))||G(0==a[2].length,0==o[2].length)||G(a[2],o[2]),a=a[3],o=o[3]}while(0==e)}return 0<=e}))}if(T.document&&te){var de=oe();le=de||(parseInt($,10)||void 0)}else le=void 0;var ve=le,pe=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{T.addEventListener("test",x,t),T.removeEventListener("test",x,t)}catch(n){}return e}();function ye(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function me(e,t){if(ye.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ie){e:{try{J(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:ge[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&me.Z.h.call(this)}}ye.prototype.h=function(){this.defaultPrevented=!0},L(me,ye);var ge={2:"touch",3:"pen",4:"mouse"};me.prototype.h=function(){me.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ke="closure_listenable_"+(1e6*Math.random()|0),we=0;function be(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++we,this.ca=this.fa=!1}function Ee(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Ie(e){this.src=e,this.g={},this.h=0}function Te(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=P(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(Ee(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function xe(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.ca&&a.listener==t&&a.capture==!!n&&a.ia==r)return i}return-1}Ie.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=xe(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new be(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var Se="closure_lm_"+(1e6*Math.random()|0),Ae={};function Ze(e,t,n,r,i){if(r&&r.once)return De(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)Ze(e,t[a],n,r,i);return null}return n=Pe(n),e&&e[ke]?e.N(t,n,A(r)?!!r.capture:!!r,i):_e(e,t,n,!1,r,i)}function _e(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=A(i)?!!i.capture:!!i,u=Oe(e);if(u||(e[Se]=u=new Ie(e)),(n=u.add(t,n,r,o,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Le;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)pe||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Re(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function De(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)De(e,t[a],n,r,i);return null}return n=Pe(n),e&&e[ke]?e.O(t,n,A(r)?!!r.capture:!!r,i):_e(e,t,n,!0,r,i)}function Ce(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)Ce(e,t[a],n,r,i);else r=A(r)?!!r.capture:!!r,n=Pe(n),e&&e[ke]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=xe(a=e.g[t],n,r,i))&&(Ee(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Oe(e))&&(t=e.g[t.toString()],e=-1,t&&(e=xe(t,n,r,i)),(n=-1<e?t[e]:null)&&Ne(n))}function Ne(e){if("number"!==typeof e&&e&&!e.ca){var t=e.src;if(t&&t[ke])Te(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Re(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Oe(t))?(Te(n,e),0==n.h&&(n.src=null,t[Se]=null)):Ee(e)}}}function Re(e){return e in Ae?Ae[e]:Ae[e]="on"+e}function Le(e,t){if(e.ca)e=!0;else{t=new me(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Ne(e),e=n.call(r,t)}return e}function Oe(e){return(e=e[Se])instanceof Ie?e:null}var Me="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pe(e){return"function"===typeof e?e:(e[Me]||(e[Me]=function(t){return e.handleEvent(t)}),e[Me])}function Fe(){O.call(this),this.i=new Ie(this),this.P=this,this.I=null}function Ve(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new ye(t,e);else if(t instanceof ye)t.target=t.target||e;else{var i=t;X(t=new ye(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=Ue(o,r,!0,t)&&i}if(i=Ue(o=t.g=e,r,!0,t)&&i,i=Ue(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=Ue(o=t.g=n[a],r,!1,t)&&i}function Ue(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.ca&&o.capture==n){var u=o.listener,s=o.ia||o.src;o.fa&&Te(e.i,o),i=!1!==u.call(s,r)&&i}}return i&&!r.defaultPrevented}L(Fe,O),Fe.prototype[ke]=!0,Fe.prototype.removeEventListener=function(e,t,n,r){Ce(this,e,t,n,r)},Fe.prototype.M=function(){if(Fe.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Ee(n[r]);delete t.g[e],t.h--}}this.I=null},Fe.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Fe.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var qe=T.JSON.stringify;function Be(){var e=Ye,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var je,Ke=function(){function e(){(0,d.Z)(this,e),this.h=this.g=null}return(0,v.Z)(e,[{key:"add",value:function(e,t){var n=Ge.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),Ge=new(function(){function e(t,n){(0,d.Z)(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return(0,v.Z)(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}())((function(){return new ze}),(function(e){return e.reset()})),ze=function(){function e(){(0,d.Z)(this,e),this.next=this.g=this.h=null}return(0,v.Z)(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function He(e){T.setTimeout((function(){throw e}),0)}function We(e,t){je||function(){var e=T.Promise.resolve(void 0);je=function(){e.then(Xe)}}(),Qe||(je(),Qe=!0),Ye.add(e,t)}var Qe=!1,Ye=new Ke;function Xe(){for(var e;e=Be();){try{e.h.call(e.g)}catch(n){He(n)}var t=Ge;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Qe=!1}function Je(e,t){Fe.call(this),this.h=e||1,this.g=t||T,this.j=N(this.kb,this),this.l=Date.now()}function $e(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function et(e,t,n){if("function"===typeof e)n&&(e=N(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=N(e.handleEvent,e)}return 2147483647<Number(t)?-1:T.setTimeout(e,t||0)}function tt(e){e.g=et((function(){e.g=null,e.i&&(e.i=!1,tt(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}L(Je,Fe),(r=Je.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ve(this,"tick"),this.da&&($e(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Je.Z.M.call(this),$e(this),delete this.g};var nt=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).m=e,i.j=r,i.h=null,i.i=!1,i.g=null,i}return(0,v.Z)(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:tt(this)}},{key:"M",value:function(){(0,a.Z)((0,o.Z)(n.prototype),"M",this).call(this),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(O);function rt(e){O.call(this),this.h=e,this.g={}}L(rt,O);var it=[];function at(e,t,n,r){Array.isArray(n)||(n&&(it[0]=n.toString()),n=it);for(var i=0;i<n.length;i++){var a=Ze(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function ot(e){W(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ne(e)}),e),e.g={}}function ut(){this.g=!0}function st(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return qe(n)}catch(u){return t}}(e,n)+(r?" "+r:"")}))}rt.prototype.M=function(){rt.Z.M.call(this),ot(this)},rt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ut.prototype.Aa=function(){this.g=!1},ut.prototype.info=function(){};var ct={},lt=null;function ht(){return lt=lt||new Fe}function ft(e){ye.call(this,ct.Ma,e)}function dt(e){var t=ht();Ve(t,new ft(t,e))}function vt(e,t){ye.call(this,ct.STAT_EVENT,e),this.stat=t}function pt(e){var t=ht();Ve(t,new vt(t,e))}function yt(e,t){ye.call(this,ct.Na,e),this.size=t}function mt(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return T.setTimeout((function(){e()}),t)}ct.Ma="serverreachability",L(ft,ye),ct.STAT_EVENT="statevent",L(vt,ye),ct.Na="timingevent",L(yt,ye);var gt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},kt={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function wt(){}function bt(e){return e.h||(e.h=e.i())}function Et(){}wt.prototype.h=null;var It,Tt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function xt(){ye.call(this,"d")}function St(){ye.call(this,"c")}function At(){}function Zt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new rt(this),this.P=Dt,e=re?125:void 0,this.W=new Je(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new _t}function _t(){this.i=null,this.g="",this.h=!1}L(xt,ye),L(St,ye),L(At,wt),At.prototype.g=function(){return new XMLHttpRequest},At.prototype.i=function(){return{}},It=new At;var Dt=45e3,Ct={},Nt={};function Rt(e,t,n){e.K=1,e.v=nn(Yt(t)),e.s=n,e.U=!0,Lt(e,null)}function Lt(e,t){e.F=Date.now(),Ft(e),e.A=Yt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),yn(n.h,"t",r),e.C=0,n=e.l.H,e.h=new _t,e.g=gr(e.l,n?t:null,!e.s),0<e.O&&(e.L=new nt(N(e.Ia,e,e.g),e.O)),at(e.V,e.g,"readystatechange",e.gb),t=e.H?Q(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),dt(1),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var o="",u=a.split("&"),s=0;s<u.length;s++){var c=u[s].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function Ot(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Mt(e,t,n){for(var r,i=!0;!e.I&&e.C<n.length;){if((r=Pt(e,n))==Nt){4==t&&(e.o=4,pt(14),i=!1),st(e.j,e.m,null,"[Incomplete Response]");break}if(r==Ct){e.o=4,pt(15),st(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}st(e.j,e.m,r,null),jt(e,r)}Ot(e)&&r!=Nt&&r!=Ct&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,pt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),lr(t),t.L=!0,pt(11))):(st(e.j,e.m,n,"[Invalid Chunked Response]"),Bt(e),qt(e))}function Pt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Nt:(n=Number(t.substring(n,r)),isNaN(n)?Ct:(r+=1)+n>t.length?Nt:(t=t.substr(r,n),e.C=r+n,t))}function Ft(e){e.Y=Date.now()+e.P,Vt(e,e.P)}function Vt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=mt(N(e.eb,e),t)}function Ut(e){e.B&&(T.clearTimeout(e.B),e.B=null)}function qt(e){0==e.l.G||e.I||dr(e.l,e)}function Bt(e){Ut(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,$e(e.W),ot(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function jt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Tn(n.i,e)))if(n.I=e.N,!e.J&&Tn(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;fr(n),tr(n)}cr(n),pt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=mt(N(n.ab,n),6e3));if(1>=In(n.i)&&n.ka){try{n.ka()}catch(a){}n.ka=void 0}}else pr(n,11)}else if((e.J||n.g==e)&&fr(n),!q(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.U=a[0],a=a[1],2==n.G)if("c"==a[0]){n.J=a[1],n.la=a[2];var o=a[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var u=a[4];null!=u&&(n.za=u,n.h.info("SVER="+n.za));var s=a[5];null!=s&&"number"===typeof s&&0<s&&(r=1.5*s,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.i;!h.g&&(K(l,"spdy")||K(l,"quic")||K(l,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(xn(h,h.h),h.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,tn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=e;if((r=n).oa=mr(r,r.H?r.la:null,r.W),d.J){Sn(r.i,d);var v=d,p=r.K;p&&v.setTimeout(p),v.B&&(Ut(v),Ft(v)),r.g=d}else sr(r);0<n.l.length&&ir(n)}else"stop"!=a[0]&&"close"!=a[0]||pr(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?pr(n,7):er(n):"noop"!=a[0]&&n.j&&n.j.wa(a),n.A=0)}dt(4)}catch(a){}}function Kt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(S(e)||"string"===typeof e)F(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(S(e)||"string"===typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"===typeof e)return e.split("");if(S(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length;for(var a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}}function Gt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Gt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function zt(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Ht(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Ht(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Ht(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(r=Zt.prototype).setTimeout=function(e){this.P=e},r.gb=function(e){e=e.target;var t=this.L;t&&3==Qn(e)?t.l():this.Ia(e)},r.Ia=function(e){try{if(e==this.g)e:{var t=Qn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(3!=t||re||this.g&&(this.h.h||this.g.ga()||Yn(this.g)))){this.I||4!=t||7==n||dt(8==n||0>=r?3:2),Ut(this);var i=this.g.ba();this.N=i;t:if(Ot(this)){var a=Yn(this.g);e="";var o=a.length,u=4==Qn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Bt(this),qt(this);var s="";break t}this.h.i=new T.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,e+=this.h.i.decode(a[n],{stream:u&&n==o-1});a.splice(0,o),this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.ga();if(this.i=200==i,function(e,t,n,r,i,a,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o}))}(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(c)){var h=c;break t}}h=null}if(!(i=h)){this.i=!1,this.o=3,pt(12),Bt(this),qt(this);break e}st(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,jt(this,i)}this.U?(Mt(this,t,s),re&&this.i&&3==t&&(at(this.V,this.W,"tick",this.fb),this.W.start())):(st(this.j,this.m,s,null),jt(this,s)),4==t&&Bt(this),this.i&&!this.I&&(4==t?dr(this.l,this):(this.i=!1,Ft(this)))}else 400==i&&0<s.indexOf("Unknown SID")?(this.o=3,pt(12)):(this.o=0,pt(13)),Bt(this),qt(this)}}}catch(t){}},r.fb=function(){if(this.g){var e=Qn(this.g),t=this.g.ga();this.C<t.length&&(Ut(this),Mt(this,e,t),this.i&&4!=e&&Ft(this))}},r.cancel=function(){this.I=!0,Bt(this)},r.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(dt(3),pt(17)),Bt(this),this.o=2,qt(this)):Vt(this,this.Y-e)},(r=Gt.prototype).R=function(){zt(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},r.T=function(){return zt(this),this.g.concat()},r.get=function(e,t){return Ht(this.h,e)?this.h[e]:t},r.set=function(e,t){Ht(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},r.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],a=this.get(i);e.call(t,a,i,this)}};var Wt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Qt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Qt){this.g=void 0!==t?t:e.g,Xt(this,e.j),this.s=e.s,Jt(this,e.i),$t(this,e.m),this.l=e.l,t=e.h;var n=new fn;n.i=t.i,t.g&&(n.g=new Gt(t.g),n.h=t.h),en(this,n),this.o=e.o}else e&&(n=String(e).match(Wt))?(this.g=!!t,Xt(this,n[1]||"",!0),this.s=rn(n[2]||""),Jt(this,n[3]||"",!0),$t(this,n[4]),this.l=rn(n[5]||"",!0),en(this,n[6]||"",!0),this.o=rn(n[7]||"")):(this.g=!!t,this.h=new fn(null,this.g))}function Yt(e){return new Qt(e)}function Xt(e,t,n){e.j=n?rn(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Jt(e,t,n){e.i=n?rn(t,!0):t}function $t(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function en(e,t,n){t instanceof fn?(e.h=t,function(e,t){t&&!e.j&&(dn(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(vn(this,t),yn(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=an(t,ln)),e.h=new fn(t,e.g))}function tn(e,t,n){e.h.set(t,n)}function nn(e){return tn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function rn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function an(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,on),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function on(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Qt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(an(t,un,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(an(t,un,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(an(n,"/"==n.charAt(0)?cn:sn,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",an(n,hn)),e.join("")};var un=/[#\/\?@]/g,sn=/[#\?:]/g,cn=/[#\?]/g,ln=/[#\?@]/g,hn=/#/g;function fn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function dn(e){e.g||(e.g=new Gt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function vn(e,t){dn(e),t=mn(e,t),Ht(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Ht((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&zt(e)))}function pn(e,t){return dn(e),t=mn(e,t),Ht(e.g.h,t)}function yn(e,t,n){vn(e,t),0<n.length&&(e.i=null,e.g.set(mn(e,t),U(n)),e.h+=n.length)}function mn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=fn.prototype).add=function(e,t){dn(this),this.i=null,e=mn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){dn(this),this.g.forEach((function(n,r){F(n,(function(n){e.call(t,n,r,this)}),this)}),this)},r.T=function(){dn(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},r.R=function(e){dn(this);var t=[];if("string"===typeof e)pn(this,e)&&(t=V(t,this.g.get(mn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=V(t,e[n])}return t},r.set=function(e,t){return dn(this),this.i=null,pn(this,e=mn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var a=0;a<r.length;a++){var o=i;""!==r[a]&&(o+="="+encodeURIComponent(String(r[a]))),e.push(o)}}return this.i=e.join("&")};var gn=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.h=t,this.g=n}));function kn(e){this.l=e||bn,T.PerformanceNavigationTiming?e=0<(e=T.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(T.g&&T.g.Ea&&T.g.Ea()&&T.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wn,bn=10;function En(e){return!!e.h||!!e.g&&e.g.size>=e.j}function In(e){return e.h?1:e.g?e.g.size:0}function Tn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function xn(e,t){e.g?e.g.add(t):e.h=t}function Sn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function An(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=(0,s.Z)(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.D)}}catch(a){r.e(a)}finally{r.f()}return n}return U(e.i)}function Zn(){}function _n(){this.g=new Zn}function Dn(e,t,n){var r=n||"";try{Kt(e,(function(e,n){var i=e;A(e)&&(i=qe(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Cn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(a){}}function Nn(e){this.l=e.$b||null,this.j=e.ib||!1}function Rn(e,t){Fe.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Ln,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}kn.prototype.cancel=function(){if(this.i=An(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=(0,s.Z)(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}},Zn.prototype.stringify=function(e){return T.JSON.stringify(e,void 0)},Zn.prototype.parse=function(e){return T.JSON.parse(e,void 0)},L(Nn,wt),Nn.prototype.g=function(){return new Rn(this.l,this.j)},Nn.prototype.i=(wn={},function(){return wn}),L(Rn,Fe);var Ln=0;function On(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Mn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Pn(e)}function Pn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=Rn.prototype).open=function(e,t){if(this.readyState!=Ln)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Pn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||T).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mn(this)),this.readyState=Ln},r.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Pn(this)),this.g&&(this.readyState=3,Pn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof T.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;On(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mn(this):Pn(this),3==this.readyState&&On(this)}},r.Ua=function(e){this.g&&(this.response=this.responseText=e,Mn(this))},r.Ta=function(e){this.g&&(this.response=e,Mn(this))},r.ha=function(){this.g&&Mn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Rn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Fn=T.JSON.parse;function Vn(e){Fe.call(this),this.headers=new Gt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Un,this.K=this.L=!1}L(Vn,Fe);var Un="",qn=/^https?$/i,Bn=["POST","PUT"];function jn(e){return"content-type"==e.toLowerCase()}function Kn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Gn(e),Hn(e)}function Gn(e){e.D||(e.D=!0,Ve(e,"complete"),Ve(e,"error"))}function zn(e){if(e.h&&"undefined"!=typeof I&&(!e.C[1]||4!=Qn(e)||2!=e.ba()))if(e.v&&4==Qn(e))et(e.Fa,0,e);else if(Ve(e,"readystatechange"),4==Qn(e)){e.h=!1;try{var t,n=e.ba();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.H).match(Wt)[1]||null;if(!a&&T.self&&T.self.location){var o=T.self.location.protocol;a=o.substr(0,o.length-1)}i=!qn.test(a?a.toLowerCase():"")}t=i}if(t)Ve(e,"complete"),Ve(e,"success");else{e.m=6;try{var u=2<Qn(e)?e.g.statusText:""}catch(s){u=""}e.j=u+" ["+e.ba()+"]",Gn(e)}}finally{Hn(e)}}}function Hn(e,t){if(e.g){Wn(e);var n=e.g,r=e.C[0]?x:null;e.g=null,e.C=null,t||Ve(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function Wn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(T.clearTimeout(e.A),e.A=null)}function Qn(e){return e.g?e.g.readyState:0}function Yn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Un:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Xn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){var t="";return W(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):tn(e,t,n))}function Jn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function $n(e){this.za=0,this.l=[],this.h=new ut,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Jn("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Jn("baseRetryDelayMs",5e3,e),this.$a=Jn("retryDelaySeedMs",1e4,e),this.Ya=Jn("forwardChannelMaxRetries",2,e),this.ra=Jn("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new kn(e&&e.concurrentRequestLimit),this.Ca=new _n,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function er(e){if(nr(e),3==e.G){var t=e.V++,n=Yt(e.F);tn(n,"SID",e.J),tn(n,"RID",t),tn(n,"TYPE","terminate"),or(e,n),(t=new Zt(e,e.h,t,void 0)).K=2,t.v=nn(Yt(n)),n=!1,T.navigator&&T.navigator.sendBeacon&&(n=T.navigator.sendBeacon(t.v.toString(),"")),!n&&T.Image&&((new Image).src=t.v,n=!0),n||(t.g=gr(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Ft(t)}yr(e)}function tr(e){e.g&&(lr(e),e.g.cancel(),e.g=null)}function nr(e){tr(e),e.u&&(T.clearTimeout(e.u),e.u=null),fr(e),e.i.cancel(),e.m&&("number"===typeof e.m&&T.clearTimeout(e.m),e.m=null)}function rr(e,t){e.l.push(new gn(e.Za++,t)),3==e.G&&ir(e)}function ir(e){En(e.i)||e.m||(e.m=!0,We(e.Ha,e),e.C=0)}function ar(e,t){var n;n=t?t.m:e.V++;var r=Yt(e.F);tn(r,"SID",e.J),tn(r,"RID",n),tn(r,"AID",e.U),or(e,r),e.o&&e.s&&Xn(r,e.o,e.s),n=new Zt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=ur(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),xn(e.i,n),Rt(n,r,t)}function or(e,t){e.j&&Kt({},(function(e,n){tn(t,n,e)}))}function ur(e,t,n){n=Math.min(e.l.length,n);var r=e.j?N(e.j.Oa,e.j,e):null;e:for(var i=e.l,a=-1;;){var o=["count="+n];-1==a?0<n?(a=i[0].h,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var u=!0,s=0;s<n;s++){var c=i[s].h,l=i[s].g;if(0>(c-=a))a=Math.max(0,i[s].h-100),u=!1;else try{Dn(l,o,"req"+c+"_")}catch(Xr){r&&r(l)}}if(u){r=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function sr(e){e.g||e.u||(e.Y=1,We(e.Ga,e),e.A=0)}function cr(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=mt(N(e.Ga,e),vr(e,e.A)),e.A++,!0)}function lr(e){null!=e.B&&(T.clearTimeout(e.B),e.B=null)}function hr(e){e.g=new Zt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Yt(e.oa);tn(t,"RID","rpc"),tn(t,"SID",e.J),tn(t,"CI",e.N?"0":"1"),tn(t,"AID",e.U),or(e,t),tn(t,"TYPE","xmlhttp"),e.o&&e.s&&Xn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=nn(Yt(t)),n.s=null,n.U=!0,Lt(n,e)}function fr(e){null!=e.v&&(T.clearTimeout(e.v),e.v=null)}function dr(e,t){var n=null;if(e.g==t){fr(e),lr(e),e.g=null;var r=2}else{if(!Tn(e.i,t))return;n=t.D,Sn(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Ve(r=ht(),new yt(r,n,t,i)),ir(e)}else sr(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(In(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.l=t.D.concat(e.l),!0):!(1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya))&&(e.m=mt(N(e.Ha,e,t),vr(e,e.C)),e.C++,!0))}(e,t)||2==r&&cr(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:pr(e,5);break;case 4:pr(e,10);break;case 3:pr(e,6);break;default:pr(e,2)}}function vr(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function pr(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=N(e.jb,e);n||(n=new Qt("//www.google.com/images/cleardot.gif"),T.location&&"http"==T.location.protocol||Xt(n,"https"),nn(n)),function(e,t){var n=new ut;if(T.Image){var r=new Image;r.onload=R(Cn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=R(Cn,n,r,"TestLoadImage: error",!1,t),r.onabort=R(Cn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=R(Cn,n,r,"TestLoadImage: timeout",!1,t),T.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else pt(2);e.G=0,e.j&&e.j.va(t),yr(e),nr(e)}function yr(e){e.G=0,e.I=-1,e.j&&(0==An(e.i).length&&0==e.l.length||(e.i.i.length=0,U(e.l),e.l.length=0),e.j.ua())}function mr(e,t,n){var r=function(e){return e instanceof Qt?Yt(e):new Qt(e,void 0)}(n);if(""!=r.i)t&&Jt(r,t+"."+r.i),$t(r,r.m);else{var i=T.location;r=function(e,t,n,r){var i=new Qt(null,void 0);return e&&Xt(i,e),t&&Jt(i,t),n&&$t(i,n),r&&(i.l=r),i}(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&W(e.aa,(function(e,t){tn(r,t,e)})),t=e.D,n=e.sa,t&&n&&tn(r,t,n),tn(r,"VER",e.ma),or(e,r),r}function gr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Vn(new Nn({ib:!0})):new Vn(e.qa)).L=e.H,t}function kr(){}function wr(){if(te&&!(10<=Number(ve)))throw Error("Environmental error: no available transport.")}function br(e,t){Fe.call(this),this.g=new $n(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!q(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!q(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Tr(this)}function Er(e){xt.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Ir(){St.call(this),this.status=1}function Tr(e){this.g=e}(r=Vn.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():It.g(),this.C=this.u?bt(this.u):bt(It),this.g.onreadystatechange=N(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(a){return void Kn(this,a)}e=n||"";var i=new Gt(this.headers);r&&Kt(r,(function(e,t){i.set(t,e)})),r=function(e){e:{for(var t=jn,n=e.length,r="string"===typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(i.T()),n=T.FormData&&e instanceof T.FormData,!(0<=P(Bn,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Wn(this),0<this.B&&((this.K=function(e){return te&&fe()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=N(this.pa,this)):this.A=et(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(a){Kn(this,a)}},r.pa=function(){"undefined"!=typeof I&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ve(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ve(this,"complete"),Ve(this,"abort"),Hn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Hn(this,!0)),Vn.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?zn(this):this.cb())},r.cb=function(){zn(this)},r.ba=function(){try{return 2<Qn(this)?this.g.status:-1}catch(wn){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(wn){return""}},r.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Fn(t)}},r.Da=function(){return this.m},r.La=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=$n.prototype).ma=8,r.G=1,r.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},r.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new Zt(this,this.h,e,void 0),n=this.s;if(this.P&&(n?X(n=Q(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var a=this.l[i];if(void 0===(a="__data__"in a.g&&"string"===typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=ur(this,t,r),tn(i=Yt(this.F),"RID",e),tn(i,"CVER",22),this.D&&tn(i,"X-HTTP-Session-Id",this.D),or(this,i),this.o&&n&&Xn(i,this.o,n),xn(this.i,t),this.Ra&&tn(i,"TYPE","init"),this.ja?(tn(i,"$req",r),tn(i,"SID","null"),t.$=!0,Rt(t,i,null)):Rt(t,i,r),this.G=2}}else 3==this.G&&(e?ar(this,e):0==this.l.length||En(this.i)||ar(this))},r.Ga=function(){if(this.u=null,hr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=mt(N(this.bb,this),e)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,pt(10),tr(this),hr(this))},r.ab=function(){null!=this.v&&(this.v=null,tr(this),cr(this),pt(19))},r.jb=function(e){e?(this.h.info("Successfully pinged google.com"),pt(2)):(this.h.info("Failed to ping google.com"),pt(1))},(r=kr.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},wr.prototype.g=function(e,t){return new br(e,t)},L(br,Fe),br.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),We(N(e.hb,e,t))),pt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=mr(e,null,e.W),ir(e)},br.prototype.close=function(){er(this.g)},br.prototype.u=function(e){if("string"===typeof e){var t={};t.__data__=e,rr(this.g,t)}else this.v?((t={}).__data__=qe(e),rr(this.g,t)):rr(this.g,e)},br.prototype.M=function(){this.g.j=null,delete this.j,er(this.g),delete this.g,br.Z.M.call(this)},L(Er,xt),L(Ir,St),L(Tr,kr),Tr.prototype.xa=function(){Ve(this.g,"a")},Tr.prototype.wa=function(e){Ve(this.g,new Er(e))},Tr.prototype.va=function(e){Ve(this.g,new Ir(e))},Tr.prototype.ua=function(){Ve(this.g,"b")},wr.prototype.createWebChannel=wr.prototype.g,br.prototype.send=br.prototype.u,br.prototype.open=br.prototype.m,br.prototype.close=br.prototype.close,gt.NO_ERROR=0,gt.TIMEOUT=8,gt.HTTP_ERROR=6,kt.COMPLETE="complete",Et.EventType=Tt,Tt.OPEN="a",Tt.CLOSE="b",Tt.ERROR="c",Tt.MESSAGE="d",Fe.prototype.listen=Fe.prototype.N,Vn.prototype.listenOnce=Vn.prototype.O,Vn.prototype.getLastError=Vn.prototype.La,Vn.prototype.getLastErrorCode=Vn.prototype.Da,Vn.prototype.getStatus=Vn.prototype.ba,Vn.prototype.getResponseJson=Vn.prototype.Qa,Vn.prototype.getResponseText=Vn.prototype.ga,Vn.prototype.send=Vn.prototype.ea;var xr=E.createWebChannelTransport=function(){return new wr},Sr=E.getStatEventTarget=function(){return ht()},Ar=E.ErrorCode=gt,Zr=E.EventType=kt,_r=E.Event=ct,Dr=E.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Cr=E.FetchXmlHttpFactory=Nn,Nr=E.WebChannel=Et,Rr=E.XhrIo=Vn,Lr="@firebase/firestore",Or=function(){function e(t){(0,d.Z)(this,e),this.uid=t}return(0,v.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();Or.UNAUTHENTICATED=new Or(null),Or.GOOGLE_CREDENTIALS=new Or("google-credentials-uid"),Or.FIRST_PARTY=new Or("first-party-uid"),Or.MOCK_USER=new Or("mock-user");var Mr="9.6.2",Pr=new k.Yd("@firebase/firestore");function Fr(){return Pr.logLevel}function Vr(e){Pr.setLogLevel(e)}function Ur(e){if(Pr.logLevel<=k.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(jr);Pr.debug.apply(Pr,["Firestore (".concat(Mr,"): ").concat(e)].concat((0,f.Z)(i)))}}function qr(e){if(Pr.logLevel<=k.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(jr);Pr.error.apply(Pr,["Firestore (".concat(Mr,"): ").concat(e)].concat((0,f.Z)(i)))}}function Br(e){if(Pr.logLevel<=k.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(jr);Pr.warn.apply(Pr,["Firestore (".concat(Mr,"): ").concat(e)].concat((0,f.Z)(i)))}}function jr(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Kr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(Mr,") INTERNAL ASSERTION FAILED: ")+e;throw qr(t),new Error(t)}function Gr(e,t){e||Kr()}function zr(e,t){e||Kr()}function Hr(e,t){return e}var Wr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Qr=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,v.Z)(n)}(w.ZR),Yr=(0,v.Z)((function e(){var t=this;(0,d.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),Xr=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),Jr=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Or.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),$r=function(){function e(t){(0,d.Z)(this,e),this.token=t,this.changeListener=null}return(0,v.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),ei=function(){function e(t){(0,d.Z)(this,e),this.t=t,this.currentUser=Or.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,v.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new Yr;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new Yr,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable((0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},u=function(e){Ur("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return u(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?u(e):(Ur("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Yr)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(Ur("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Gr("string"==typeof n.accessToken),new Xr(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return Gr(null===e||"string"==typeof e),new Or(e)}}]),e}(),ti=(0,v.Z)((function e(t,n,r){(0,d.Z)(this,e),this.type="FirstParty",this.user=Or.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)})),ni=function(){function e(t,n,r){(0,d.Z)(this,e),this.h=t,this.l=n,this.m=r}return(0,v.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new ti(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Or.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),ri=(0,v.Z)((function e(t){(0,d.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),ii=function(){function e(t){(0,d.Z)(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null}return(0,v.Z)(e,[{key:"start",value:function(e,t){var n=this;this.o=function(n){e.enqueueRetryable((function(){return function(e){return null!=e.error&&Ur("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message)),t(e.token)}(n)}))};var r=function(e){Ur("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit((function(e){return r(e)})),setTimeout((function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?r(e):Ur("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((function(e){return e?(Gr("string"==typeof e.token),new ri(e.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),ai=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new ri(""))}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){}},{key:"shutdown",value:function(){}}]),e}(),oi=function(){function e(t,n){var r=this;(0,d.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.p(e)},this.T=function(e){return n.writeSequenceNumber(e)})}return(0,v.Z)(e,[{key:"p",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.T&&this.T(e),e}}]),e}();function ui(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}oi.I=-1;var si=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,null,[{key:"A",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=ui(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function ci(e,t){return e<t?-1:e>t?1:0}function li(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function hi(e){return e+"\0"}var fi=function(){function e(t,n){if((0,d.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new Qr(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Qr(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new Qr(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Qr(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,v.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?ci(this.nanoseconds,e.nanoseconds):ci(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),di=function(){function e(t){(0,d.Z)(this,e),this.timestamp=t}return(0,v.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new fi(0,0))}}]),e}();function vi(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function pi(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function yi(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var mi=function(){function e(t,n,r){(0,d.Z)(this,e),void 0===n?n=0:n>t.length&&Kr(),void 0===r?r=t.length-n:r>t.length-n&&Kr(),this.segments=t,this.offset=n,this.len=r}return(0,v.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),gi=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var u=o[a];if(u.indexOf("//")>=0)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid segment (".concat(u,"). Paths must not contain // in them."));e.push.apply(e,(0,f.Z)(u.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(mi),ki=/^[_a-zA-Z][_a-zA-Z0-9]*$/,wi=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return ki.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;i<e.length;){var u=e[i];if("\\"===u){if(i+1===e.length)throw new Qr(Wr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Qr(Wr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===u?(o=!o,i++):"."!==u||o?(r+=u,i++):(a(),i++)}if(a(),o)throw new Qr(Wr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(mi),bi=function(){function e(t){(0,d.Z)(this,e),this.fields=t,t.sort(wi.comparator)}return(0,v.Z)(e,[{key:"covers",value:function(e){var t,n=(0,s.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return li(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}]),e}();function Ei(){return"undefined"!=typeof atob}var Ii=function(e){function t(e){(0,d.Z)(this,t),this.binaryString=e}return(0,v.Z)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return ci(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}(Symbol.iterator);Ii.EMPTY_BYTE_STRING=new Ii("");var Ti=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xi(e){if(Gr(!!e),"string"==typeof e){var t=0,n=Ti.exec(e);if(Gr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Si(e.seconds),nanos:Si(e.nanos)}}function Si(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ai(e){return"string"==typeof e?Ii.fromBase64String(e):Ii.fromUint8Array(e)}function Zi(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function _i(e){var t=e.mapValue.fields.__previous_value__;return Zi(t)?_i(t):t}function Di(e){var t=xi(e.mapValue.fields.__local_write_time__.timestampValue);return new fi(t.seconds,t.nanos)}function Ci(e){return null==e}function Ni(e){return 0===e&&1/e==-1/0}function Ri(e){return"number"==typeof e&&Number.isInteger(e)&&!Ni(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var Li=function(){function e(t){(0,d.Z)(this,e),this.path=t}return(0,v.Z)(e,[{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"isEqual",value:function(e){return null!==e&&0===gi.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(gi.fromString(t))}},{key:"fromName",value:function(t){return new e(gi.fromString(t).popFirst(5))}},{key:"comparator",value:function(e,t){return gi.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new gi(t.slice()))}}]),e}();function Oi(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Zi(e)?4:10:Kr()}function Mi(e,t){if(e===t)return!0;var n=Oi(e);if(n!==Oi(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Di(e).isEqual(Di(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=xi(e.timestampValue),r=xi(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ai(e.bytesValue).isEqual(Ai(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Si(e.geoPointValue.latitude)===Si(t.geoPointValue.latitude)&&Si(e.geoPointValue.longitude)===Si(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Si(e.integerValue)===Si(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Si(e.doubleValue),r=Si(t.doubleValue);return n===r?Ni(n)===Ni(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return li(e.arrayValue.values||[],t.arrayValue.values||[],Mi);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(vi(n)!==vi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Mi(n[i],r[i])))return!1;return!0}(e,t);default:return Kr()}}function Pi(e,t){return void 0!==(e.values||[]).find((function(e){return Mi(e,t)}))}function Fi(e,t){if(e===t)return 0;var n=Oi(e),r=Oi(t);if(n!==r)return ci(n,r);switch(n){case 0:return 0;case 1:return ci(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=Si(e.integerValue||e.doubleValue),r=Si(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Vi(e.timestampValue,t.timestampValue);case 4:return Vi(Di(e),Di(t));case 5:return ci(e.stringValue,t.stringValue);case 6:return function(e,t){var n=Ai(e),r=Ai(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=ci(n[i],r[i]);if(0!==a)return a}return ci(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=ci(Si(e.latitude),Si(t.latitude));return 0!==n?n:ci(Si(e.longitude),Si(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=Fi(n[i],r[i]);if(a)return a}return ci(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var u=ci(r[o],a[o]);if(0!==u)return u;var s=Fi(n[r[o]],i[a[o]]);if(0!==s)return s}return ci(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Kr()}}function Vi(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ci(e,t);var n=xi(e),r=xi(t),i=ci(n.seconds,r.seconds);return 0!==i?i:ci(n.nanos,r.nanos)}function Ui(e){return qi(e)}function qi(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=xi(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ai(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Li.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=(0,s.Z)(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=qi(a)}}catch(o){i.e(o)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=(0,s.Z)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;i?i=!1:r+=",",r+="".concat(o,":").concat(qi(e.fields[o]))}}catch(u){a.e(u)}finally{a.f()}return r+"}"}(e.mapValue):Kr();var t,n}function Bi(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function ji(e){return!!e&&"integerValue"in e}function Ki(e){return!!e&&"arrayValue"in e}function Gi(e){return!!e&&"nullValue"in e}function zi(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Hi(e){return!!e&&"mapValue"in e}function Wi(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return pi(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Wi(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Wi(e.arrayValue.values[r]);return n}return Object.assign({},e)}var Qi=function(){function e(t){(0,d.Z)(this,e),this.value=t}return(0,v.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Hi(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wi(t)}},{key:"setAll",value:function(e){var t=this,n=wi.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Wi(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Hi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Mi(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Hi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){pi(t,(function(t,n){return e[t]=n}));var r,i=(0,s.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(o){i.e(o)}finally{i.f()}}},{key:"clone",value:function(){return new e(Wi(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Yi(e){var t=[];return pi(e.fields,(function(e,n){var r=new wi([e]);if(Hi(n)){var i=Yi(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,o=(0,s.Z)(i);try{for(o.s();!(a=o.n()).done;){var u=a.value;t.push(r.child(u))}}catch(c){o.e(c)}finally{o.f()}}}else t.push(r)})),new bi(t)}var Xi=function(){function e(t,n,r,i,a){(0,d.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=a}return(0,v.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Qi.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Qi.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,di.min(),Qi.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,Qi.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,Qi.empty(),2)}}]),e}(),Ji=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,d.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=u,this.R=null}));function $i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Ji(e,t,n,r,i,a,o)}function ea(e){var t=Hr(e);if(null===t.R){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return function(e){return e.field.canonicalString()+e.op.toString()+Ui(e.value)}(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),Ci(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=da(t.startAt)),t.endAt&&(n+="|ub:",n+=da(t.endAt)),t.R=n}return t.R}function ta(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!pa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!Mi(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ma(e.startAt,t.startAt)&&ma(e.endAt,t.endAt)}function na(e){return Li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var ra=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,v.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Fi(t,this.value)):null!==t&&Oi(this.value)===Oi(t)&&this.v(Fi(t,this.value))}},{key:"v",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Kr()}}},{key:"V",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,r):new ia(e,t,r):"array-contains"===t?new sa(e,r):"in"===t?new ca(e,r):"not-in"===t?new la(e,r):"array-contains-any"===t?new ha(e,r):new n(e,t,r)}},{key:"P",value:function(e,t,n){return"in"===t?new aa(e,n):new oa(e,n)}}]),n}(function(){return(0,v.Z)((function e(){(0,d.Z)(this,e)}))}());var ia=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this,e,r,i)).key=Li.fromName(i.referenceValue),a}return(0,v.Z)(n,[{key:"matches",value:function(e){var t=Li.comparator(e.key,this.key);return this.v(t)}}]),n}(ra),aa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e,"in",r)).keys=ua("in",r),i}return(0,v.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(ra),oa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=ua("not-in",r),i}return(0,v.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(ra);function ua(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return Li.fromName(e.referenceValue)}))}var sa=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,d.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,v.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return Ki(t)&&Pi(t.arrayValue,this.value)}}]),n}(ra),ca=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,d.Z)(this,n),t.call(this,e,"in",r)}return(0,v.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&Pi(this.value.arrayValue,t)}}]),n}(ra),la=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,d.Z)(this,n),t.call(this,e,"not-in",r)}return(0,v.Z)(n,[{key:"matches",value:function(e){if(Pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Pi(this.value.arrayValue,t)}}]),n}(ra),ha=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){return(0,d.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,v.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!Ki(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return Pi(t.value.arrayValue,e)}))}}]),n}(ra),fa=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.position=t,this.before=n}));function da(e){return"".concat(e.before?"b":"a",":").concat(e.position.map((function(e){return Ui(e)})).join(","))}var va=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,d.Z)(this,e),this.field=t,this.dir=n}));function pa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function ya(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?Li.comparator(Li.fromName(o.referenceValue),n.key):Fi(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function ma(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Mi(e.position[n],t.position[n]))return!1;return!0}var ga=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,d.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=u,this.endAt=s,this.S=null,this.D=null,this.startAt,this.endAt}));function ka(e,t,n,r,i,a,o,u){return new ga(e,t,n,r,i,a,o,u)}function wa(e){return new ga(e)}function ba(e){return!Ci(e.limit)&&"F"===e.limitType}function Ea(e){return!Ci(e.limit)&&"L"===e.limitType}function Ia(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Ta(e){var t,n=(0,s.Z)(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.V())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function xa(e){return null!==e.collectionGroup}function Sa(e){var t=Hr(e);if(null===t.S){t.S=[];var n=Ta(t),r=Ia(t);if(null!==n&&null===r)n.isKeyField()||t.S.push(new va(n)),t.S.push(new va(wi.keyField(),"asc"));else{var i,a=!1,o=(0,s.Z)(t.explicitOrderBy);try{for(o.s();!(i=o.n()).done;){var u=i.value;t.S.push(u),u.field.isKeyField()&&(a=!0)}}catch(l){o.e(l)}finally{o.f()}if(!a){var c=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new va(wi.keyField(),c))}}}return t.S}function Aa(e){var t=Hr(e);if(!t.D)if("F"===t.limitType)t.D=$i(t.path,t.collectionGroup,Sa(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=(0,s.Z)(Sa(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,o="desc"===a.dir?"asc":"desc";r.push(new va(a.field,o))}}catch(l){i.e(l)}finally{i.f()}var u=t.endAt?new fa(t.endAt.position,!t.endAt.before):null,c=t.startAt?new fa(t.startAt.position,!t.startAt.before):null;t.D=$i(t.path,t.collectionGroup,r,t.filters,t.limit,u,c)}return t.D}function Za(e,t,n){return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function _a(e,t){return ta(Aa(e),Aa(t))&&e.limitType===t.limitType}function Da(e){return"".concat(ea(Aa(e)),"|lt:").concat(e.limitType)}function Ca(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(Ui(t.value));var t})).join(", "),"]")),Ci(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: "+da(e.startAt)),e.endAt&&(t+=", endAt: "+da(e.endAt)),"Target(".concat(t,")")}(Aa(e)),"; limitType=").concat(e.limitType,")")}function Na(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Li.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=(0,s.Z)(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=(0,s.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!ya(e.startAt,Sa(e),t))&&(!e.endAt||!ya(e.endAt,Sa(e),t))}(e,t)}function Ra(e){return function(t,n){var r,i=!1,a=(0,s.Z)(Sa(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,u=La(o,t,n);if(0!==u)return u;i=i||o.field.isKeyField()}}catch(c){a.e(c)}finally{a.f()}return 0}}function La(e,t,n){var r=e.field.isKeyField()?Li.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Fi(r,i):Kr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Kr()}}function Oa(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ni(t)?"-0":t}}function Ma(e){return{integerValue:""+e}}function Pa(e,t){return Ri(t)?Ma(t):Oa(e,t)}var Fa=(0,v.Z)((function e(){(0,d.Z)(this,e),this._=void 0}));function Va(e,t,n){return e instanceof Ba?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof ja?Ka(e,t):e instanceof Ga?za(e,t):function(e,t){var n=qa(e,t),r=Wa(n)+Wa(e.N);return ji(n)&&ji(e.N)?Ma(r):Oa(e.k,r)}(e,t)}function Ua(e,t,n){return e instanceof ja?Ka(e,t):e instanceof Ga?za(e,t):n}function qa(e,t){return e instanceof Ha?ji(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var Ba=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n)}(Fa),ja=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,v.Z)(n)}(Fa);function Ka(e,t){var n,r=Qa(t),i=(0,s.Z)(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return Mi(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var Ga=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,v.Z)(n)}(Fa);function za(e,t){var n,r=Qa(t),i=(0,s.Z)(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!Mi(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var Ha=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).k=e,i.N=r,i}return(0,v.Z)(n)}(Fa);function Wa(e){return Si(e.integerValue||e.doubleValue)}function Qa(e){return Ki(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Ya=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.field=t,this.transform=n}));var Xa=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.version=t,this.transformResults=n})),Ja=function(){function e(t,n){(0,d.Z)(this,e),this.updateTime=t,this.exists=n}return(0,v.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function $a(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var eo=(0,v.Z)((function e(){(0,d.Z)(this,e)}));function to(e,t,n){e instanceof oo?function(e,t,n){var r=e.value.clone(),i=co(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof uo?function(e,t,n){if($a(e.precondition,t)){var r=co(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(so(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function no(e,t,n){e instanceof oo?function(e,t,n){if($a(e.precondition,t)){var r=e.value.clone(),i=lo(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(ao(t),r).setHasLocalMutations()}}(e,t,n):e instanceof uo?function(e,t,n){if($a(e.precondition,t)){var r=lo(e.fieldTransforms,n,t),i=t.data;i.setAll(so(e)),i.setAll(r),t.convertToFoundDocument(ao(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){$a(e.precondition,t)&&t.convertToNoDocument(di.min())}(e,t)}function ro(e,t){var n,r=null,i=(0,s.Z)(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),u=qa(a.transform,o||null);null!=u&&(null==r&&(r=Qi.empty()),r.set(a.field,u))}}catch(c){i.e(c)}finally{i.f()}return r||null}function io(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&li(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ja&&t instanceof ja||e instanceof Ga&&t instanceof Ga?li(e.elements,t.elements,Mi):e instanceof Ha&&t instanceof Ha?Mi(e.N,t.N):e instanceof Ba&&t instanceof Ba}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function ao(e){return e.isFoundDocument()?e.version:di.min()}var oo=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,d.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=o,a.type=0,a}return(0,v.Z)(n)}(eo),uo=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a){var o,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,d.Z)(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=i,o.precondition=a,o.fieldTransforms=u,o.type=1,o}return(0,v.Z)(n)}(eo);function so(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function co(e,t,n){var r=new Map;Gr(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],o=a.transform,u=t.data.field(a.field);r.set(a.field,Ua(o,u,n[i]))}return r}function lo(e,t,n){var r,i=new Map,a=(0,s.Z)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,u=o.transform,c=n.data.field(o.field);i.set(o.field,Va(u,c,t))}}catch(l){a.e(l)}finally{a.f()}return i}var ho,fo,vo=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,v.Z)(n)}(eo),po=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,v.Z)(n)}(eo),yo=(0,v.Z)((function e(t){(0,d.Z)(this,e),this.count=t}));function mo(e){switch(e){default:return Kr();case Wr.CANCELLED:case Wr.UNKNOWN:case Wr.DEADLINE_EXCEEDED:case Wr.RESOURCE_EXHAUSTED:case Wr.INTERNAL:case Wr.UNAVAILABLE:case Wr.UNAUTHENTICATED:return!1;case Wr.INVALID_ARGUMENT:case Wr.NOT_FOUND:case Wr.ALREADY_EXISTS:case Wr.PERMISSION_DENIED:case Wr.FAILED_PRECONDITION:case Wr.ABORTED:case Wr.OUT_OF_RANGE:case Wr.UNIMPLEMENTED:case Wr.DATA_LOSS:return!0}}function go(e){if(void 0===e)return qr("GRPC error has no .code"),Wr.UNKNOWN;switch(e){case ho.OK:return Wr.OK;case ho.CANCELLED:return Wr.CANCELLED;case ho.UNKNOWN:return Wr.UNKNOWN;case ho.DEADLINE_EXCEEDED:return Wr.DEADLINE_EXCEEDED;case ho.RESOURCE_EXHAUSTED:return Wr.RESOURCE_EXHAUSTED;case ho.INTERNAL:return Wr.INTERNAL;case ho.UNAVAILABLE:return Wr.UNAVAILABLE;case ho.UNAUTHENTICATED:return Wr.UNAUTHENTICATED;case ho.INVALID_ARGUMENT:return Wr.INVALID_ARGUMENT;case ho.NOT_FOUND:return Wr.NOT_FOUND;case ho.ALREADY_EXISTS:return Wr.ALREADY_EXISTS;case ho.PERMISSION_DENIED:return Wr.PERMISSION_DENIED;case ho.FAILED_PRECONDITION:return Wr.FAILED_PRECONDITION;case ho.ABORTED:return Wr.ABORTED;case ho.OUT_OF_RANGE:return Wr.OUT_OF_RANGE;case ho.UNIMPLEMENTED:return Wr.UNIMPLEMENTED;case ho.DATA_LOSS:return Wr.DATA_LOSS;default:return Kr()}}(fo=ho||(ho={}))[fo.OK=0]="OK",fo[fo.CANCELLED=1]="CANCELLED",fo[fo.UNKNOWN=2]="UNKNOWN",fo[fo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fo[fo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fo[fo.NOT_FOUND=5]="NOT_FOUND",fo[fo.ALREADY_EXISTS=6]="ALREADY_EXISTS",fo[fo.PERMISSION_DENIED=7]="PERMISSION_DENIED",fo[fo.UNAUTHENTICATED=16]="UNAUTHENTICATED",fo[fo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fo[fo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fo[fo.ABORTED=10]="ABORTED",fo[fo.OUT_OF_RANGE=11]="OUT_OF_RANGE",fo[fo.UNIMPLEMENTED=12]="UNIMPLEMENTED",fo[fo.INTERNAL=13]="INTERNAL",fo[fo.UNAVAILABLE=14]="UNAVAILABLE",fo[fo.DATA_LOSS=15]="DATA_LOSS";var ko=function(){function e(t,n){(0,d.Z)(this,e),this.comparator=t,this.root=n||bo.EMPTY}return(0,v.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,bo.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,bo.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new wo(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new wo(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new wo(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new wo(this.root,e,this.comparator,!0)}}]),e}(),wo=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,v.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),bo=function(){function e(t,n,r,i,a){(0,d.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,v.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw Kr();if(this.right.isRed())throw Kr();var e=this.left.check();if(e!==this.right.check())throw Kr();return e+(this.isRed()?0:1)}}]),e}();bo.EMPTY=null,bo.RED=!0,bo.BLACK=!1,bo.EMPTY=new(function(){function e(){(0,d.Z)(this,e),this.size=0}return(0,v.Z)(e,[{key:"key",get:function(){throw Kr()}},{key:"value",get:function(){throw Kr()}},{key:"color",get:function(){throw Kr()}},{key:"left",get:function(){throw Kr()}},{key:"right",get:function(){throw Kr()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new bo(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Eo=function(){function e(t){(0,d.Z)(this,e),this.comparator=t,this.data=new ko(this.comparator)}return(0,v.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new Io(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new Io(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),Io=function(){function e(t){(0,d.Z)(this,e),this.iter=t}return(0,v.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}(),To=new ko(Li.comparator);function xo(){return To}var So=new ko(Li.comparator);function Ao(){return So}var Zo=new ko(Li.comparator);function _o(){return Zo}var Do=new Eo(Li.comparator);function Co(){for(var e=Do,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.add(o)}return e}var No=new Eo(ci);function Ro(){return No}var Lo=function(){function e(t,n,r,i,a){(0,d.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,v.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,Oo.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(di.min(),r,Ro(),xo(),Co())}}]),e}(),Oo=function(){function e(t,n,r,i,a){(0,d.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,v.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(Ii.EMPTY_BYTE_STRING,n,Co(),Co(),Co())}}]),e}(),Mo=(0,v.Z)((function e(t,n,r,i){(0,d.Z)(this,e),this.$=t,this.removedTargetIds=n,this.key=r,this.O=i})),Po=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.targetId=t,this.F=n})),Fo=(0,v.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ii.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,d.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),Vo=function(){function e(){(0,d.Z)(this,e),this.M=0,this.L=Bo(),this.B=Ii.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}return(0,v.Z)(e,[{key:"current",get:function(){return this.U}},{key:"resumeToken",get:function(){return this.B}},{key:"K",get:function(){return 0!==this.M}},{key:"j",get:function(){return this.q}},{key:"W",value:function(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}},{key:"G",value:function(){var e=Co(),t=Co(),n=Co();return this.L.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Kr()}})),new Oo(this.B,this.U,e,t,n)}},{key:"H",value:function(){this.q=!1,this.L=Bo()}},{key:"J",value:function(e,t){this.q=!0,this.L=this.L.insert(e,t)}},{key:"Y",value:function(e){this.q=!0,this.L=this.L.remove(e)}},{key:"X",value:function(){this.M+=1}},{key:"Z",value:function(){this.M-=1}},{key:"tt",value:function(){this.q=!0,this.U=!0}}]),e}(),Uo=function(){function e(t){(0,d.Z)(this,e),this.et=t,this.nt=new Map,this.st=xo(),this.it=qo(),this.rt=new Eo(ci)}return(0,v.Z)(e,[{key:"ot",value:function(e){var t,n=(0,s.Z)(e.$);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.O&&e.O.isFoundDocument()?this.at(r,e.O):this.ct(r,e.key,e.O)}}catch(u){n.e(u)}finally{n.f()}var i,a=(0,s.Z)(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.ct(o,e.key,e.O)}}catch(u){a.e(u)}finally{a.f()}}},{key:"ut",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.ht(n);switch(e.state){case 0:t.lt(n)&&r.W(e.resumeToken);break;case 1:r.Z(),r.K||r.H(),r.W(e.resumeToken);break;case 2:r.Z(),r.K||t.removeTarget(n);break;case 3:t.lt(n)&&(r.tt(),r.W(e.resumeToken));break;case 4:t.lt(n)&&(t.ft(n),r.W(e.resumeToken));break;default:Kr()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((function(e,r){n.lt(r)&&t(r)}))}},{key:"dt",value:function(e){var t=e.targetId,n=e.F.count,r=this.wt(t);if(r){var i=r.target;if(na(i))if(0===n){var a=new Li(i.path);this.ct(t,a,Xi.newNoDocument(a,di.min()))}else Gr(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}},{key:"gt",value:function(e){var t=this,n=new Map;this.nt.forEach((function(r,i){var a=t.wt(i);if(a){if(r.current&&na(a.target)){var o=new Li(a.target.path);null!==t.st.get(o)||t.yt(i,o)||t.ct(i,o,Xi.newNoDocument(o,e))}r.j&&(n.set(i,r.G()),r.H())}}));var r=Co();this.it.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.wt(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))}));var i=new Lo(e,n,this.rt,this.st,r);return this.st=xo(),this.it=qo(),this.rt=new Eo(ci),i}},{key:"at",value:function(e,t){if(this.lt(e)){var n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}}},{key:"ct",value:function(e,t,n){if(this.lt(e)){var r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}}},{key:"removeTarget",value:function(e){this.nt.delete(e)}},{key:"_t",value:function(e){var t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"X",value:function(e){this.ht(e).X()}},{key:"ht",value:function(e){var t=this.nt.get(e);return t||(t=new Vo,this.nt.set(e,t)),t}},{key:"Tt",value:function(e){var t=this.it.get(e);return t||(t=new Eo(ci),this.it=this.it.insert(e,t)),t}},{key:"lt",value:function(e){var t=null!==this.wt(e);return t||Ur("WatchChangeAggregator","Detected inactive target",e),t}},{key:"wt",value:function(e){var t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}},{key:"ft",value:function(e){var t=this;this.nt.set(e,new Vo),this.et.getRemoteKeysForTarget(e).forEach((function(n){t.ct(e,n,null)}))}},{key:"yt",value:function(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}]),e}();function qo(){return new ko(Li.comparator)}function Bo(){return new ko(Li.comparator)}var jo={asc:"ASCENDING",desc:"DESCENDING"},Ko={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Go=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.databaseId=t,this.C=n}));function zo(e,t){return e.C?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ho(e,t){return e.C?t.toBase64():t.toUint8Array()}function Wo(e,t){return zo(e,t.toTimestamp())}function Qo(e){return Gr(!!e),di.fromTimestamp(function(e){var t=xi(e);return new fi(t.seconds,t.nanos)}(e))}function Yo(e,t){return function(e){return new gi(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Xo(e){var t=gi.fromString(e);return Gr(Eu(t)),t}function Jo(e,t){return Yo(e.databaseId,t.path)}function $o(e,t){var n=Xo(t);if(n.get(1)!==e.databaseId.projectId)throw new Qr(Wr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Qr(Wr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Li(ru(n))}function eu(e,t){return Yo(e.databaseId,t)}function tu(e){var t=Xo(e);return 4===t.length?gi.emptyPath():ru(t)}function nu(e){return new gi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ru(e){return Gr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function iu(e,t,n){return{name:Jo(e,t),fields:n.value.mapValue.fields}}function au(e,t,n){var r=$o(e,t.name),i=Qo(t.updateTime),a=new Qi({mapValue:{fields:t.fields}}),o=Xi.newFoundDocument(r,i,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ou(e,t){return"found"in t?function(e,t){Gr(!!t.found),t.found.name,t.found.updateTime;var n=$o(e,t.found.name),r=Qo(t.found.updateTime),i=new Qi({mapValue:{fields:t.found.fields}});return Xi.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Gr(!!t.missing),Gr(!!t.readTime);var n=$o(e,t.missing),r=Qo(t.readTime);return Xi.newNoDocument(n,r)}(e,t):Kr()}function uu(e,t){var n;if(t instanceof oo)n={update:iu(e,t.key,t.value)};else if(t instanceof vo)n={delete:Jo(e,t.key)};else if(t instanceof uo)n={update:iu(e,t.key,t.data),updateMask:bu(t.fieldMask)};else{if(!(t instanceof po))return Kr();n={verify:Jo(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Ba)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ja)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ga)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ha)return{fieldPath:t.field.canonicalString(),increment:n.N};throw Kr()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Wo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Kr()}(e,t.precondition)),n}function su(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Ja.updateTime(Qo(e.updateTime)):void 0!==e.exists?Ja.exists(e.exists):Ja.none()}(t.currentDocument):Ja.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)Gr("REQUEST_TIME"===t.setToServerValue),n=new Ba;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new ja(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Ga(i)}else"increment"in t?n=new Ha(e,t.increment):Kr();var a=wi.fromServerFormat(t.fieldPath);return new Ya(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=$o(e,t.update.name),a=new Qi({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=function(e){var t=e.fieldPaths||[];return new bi(t.map((function(e){return wi.fromServerFormat(e)})))}(t.updateMask);return new uo(i,a,o,n,r)}return new oo(i,a,n,r)}if(t.delete){var u=$o(e,t.delete);return new vo(u,n)}if(t.verify){var s=$o(e,t.verify);return new po(s,n)}return Kr()}function cu(e,t){return{documents:[eu(e,t.path)]}}function lu(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=eu(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=eu(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(zi(e.value))return{unaryFilter:{field:mu(e.field),op:"IS_NAN"}};if(Gi(e.value))return{unaryFilter:{field:mu(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(zi(e.value))return{unaryFilter:{field:mu(e.field),op:"IS_NOT_NAN"}};if(Gi(e.value))return{unaryFilter:{field:mu(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mu(e.field),op:yu(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:mu(e.field),direction:pu(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var o=function(e,t){return e.C||Ci(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=du(t.startAt)),t.endAt&&(n.structuredQuery.endAt=du(t.endAt)),n}function hu(e){var t=tu(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Gr(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var o=[];n.where&&(o=fu(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(e){return function(e){return new va(gu(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var s=null;n.limit&&(s=function(e){var t;return Ci(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=vu(n.startAt));var l=null;return n.endAt&&(l=vu(n.endAt)),ka(t,i,u,o,s,"F",c,l)}function fu(e){return e?void 0!==e.unaryFilter?[wu(e)]:void 0!==e.fieldFilter?[ku(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return fu(e)})).reduce((function(e,t){return e.concat(t)})):Kr():[]}function du(e){return{before:e.before,values:e.position}}function vu(e){var t=!!e.before,n=e.values||[];return new fa(n,t)}function pu(e){return jo[e]}function yu(e){return Ko[e]}function mu(e){return{fieldPath:e.canonicalString()}}function gu(e){return wi.fromServerFormat(e.fieldPath)}function ku(e){return ra.create(gu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Kr()}}(e.fieldFilter.op),e.fieldFilter.value)}function wu(e){switch(e.unaryFilter.op){case"IS_NAN":var t=gu(e.unaryFilter.field);return ra.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=gu(e.unaryFilter.field);return ra.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=gu(e.unaryFilter.field);return ra.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=gu(e.unaryFilter.field);return ra.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Kr()}}function bu(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function Eu(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Iu(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=xu(t)),t=Tu(e.get(n),t);return xu(t)}function Tu(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=a}}return n}function xu(e){return e+"\x01\x01"}function Su(e){var t=e.length;if(Gr(t>=2),2===t)return Gr("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),gi.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var o=e.indexOf("\x01",a);switch((o<0||o>n)&&Kr(),e.charAt(o+1)){case"\x01":var u=e.substring(a,o),s=void 0;0===i.length?s=u:(s=i+=u,i=""),r.push(s);break;case"\x10":i+=e.substring(a,o),i+="\0";break;case"\x11":i+=e.substring(a,o+1);break;default:Kr()}a=o+2}return new gi(r)}var Au=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.seconds=t,this.nanoseconds=n})),Zu=(0,v.Z)((function e(t,n,r){(0,d.Z)(this,e),this.ownerId=t,this.allowTabSynchronization=n,this.leaseTimestampMs=r}));Zu.store="owner",Zu.key="owner";var _u=(0,v.Z)((function e(t,n,r){(0,d.Z)(this,e),this.userId=t,this.lastAcknowledgedBatchId=n,this.lastStreamToken=r}));_u.store="mutationQueues",_u.keyPath="userId";var Du=(0,v.Z)((function e(t,n,r,i,a){(0,d.Z)(this,e),this.userId=t,this.batchId=n,this.localWriteTimeMs=r,this.baseMutations=i,this.mutations=a}));Du.store="mutations",Du.keyPath="batchId",Du.userMutationsIndex="userMutationsIndex",Du.userMutationsKeyPath=["userId","batchId"];var Cu=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,null,[{key:"prefixForUser",value:function(e){return[e]}},{key:"prefixForPath",value:function(e,t){return[e,Iu(t)]}},{key:"key",value:function(e,t,n){return[e,Iu(t),n]}}]),e}();Cu.store="documentMutations",Cu.PLACEHOLDER=new Cu;var Nu=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.path=t,this.readTime=n})),Ru=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.path=t,this.version=n})),Lu=(0,v.Z)((function e(t,n,r,i,a,o){(0,d.Z)(this,e),this.unknownDocument=t,this.noDocument=n,this.document=r,this.hasCommittedMutations=i,this.readTime=a,this.parentPath=o}));Lu.store="remoteDocuments",Lu.readTimeIndex="readTimeIndex",Lu.readTimeIndexPath="readTime",Lu.collectionReadTimeIndex="collectionReadTimeIndex",Lu.collectionReadTimeIndexPath=["parentPath","readTime"];var Ou=(0,v.Z)((function e(t){(0,d.Z)(this,e),this.byteSize=t}));Ou.store="remoteDocumentGlobal",Ou.key="remoteDocumentGlobalKey";var Mu=(0,v.Z)((function e(t,n,r,i,a,o,u){(0,d.Z)(this,e),this.targetId=t,this.canonicalId=n,this.readTime=r,this.resumeToken=i,this.lastListenSequenceNumber=a,this.lastLimboFreeSnapshotVersion=o,this.query=u}));Mu.store="targets",Mu.keyPath="targetId",Mu.queryTargetsIndexName="queryTargetsIndex",Mu.queryTargetsKeyPath=["canonicalId","targetId"];var Pu=(0,v.Z)((function e(t,n,r){(0,d.Z)(this,e),this.targetId=t,this.path=n,this.sequenceNumber=r}));Pu.store="targetDocuments",Pu.keyPath=["targetId","path"],Pu.documentTargetsIndex="documentTargetsIndex",Pu.documentTargetsKeyPath=["path","targetId"];var Fu=(0,v.Z)((function e(t,n,r,i){(0,d.Z)(this,e),this.highestTargetId=t,this.highestListenSequenceNumber=n,this.lastRemoteSnapshotVersion=r,this.targetCount=i}));Fu.key="targetGlobalKey",Fu.store="targetGlobal";var Vu=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.collectionId=t,this.parent=n}));Vu.store="collectionParents",Vu.keyPath=["collectionId","parent"];var Uu=(0,v.Z)((function e(t,n,r,i){(0,d.Z)(this,e),this.clientId=t,this.updateTimeMs=n,this.networkEnabled=r,this.inForeground=i}));Uu.store="clientMetadata",Uu.keyPath="clientId";var qu=(0,v.Z)((function e(t,n,r){(0,d.Z)(this,e),this.bundleId=t,this.createTime=n,this.version=r}));qu.store="bundles",qu.keyPath="bundleId";var Bu=(0,v.Z)((function e(t,n,r){(0,d.Z)(this,e),this.name=t,this.readTime=n,this.bundledQuery=r}));Bu.store="namedQueries",Bu.keyPath="name";var ju=[_u.store,Du.store,Cu.store,Lu.store,Mu.store,Zu.store,Fu.store,Pu.store].concat([Uu.store]).concat([Ou.store]).concat([Vu.store]).concat([qu.store,Bu.store]),Ku="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Gu=function(){function e(){(0,d.Z)(this,e),this.onCommittedListeners=[]}return(0,v.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}(),zu=function(){function e(t){var n=this;(0,d.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,v.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&Kr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=(0,s.Z)(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}}]),e}(),Hu=function(){function e(t,n){var r=this;(0,d.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.It=new Yr,this.transaction.oncomplete=function(){r.It.resolve()},this.transaction.onabort=function(){n.error?r.It.reject(new Yu(t,n.error)):r.It.resolve()},this.transaction.onerror=function(e){var n=ts(e.target.error);r.It.reject(new Yu(t,n))}}return(0,v.Z)(e,[{key:"At",get:function(){return this.It.promise}},{key:"abort",value:function(e){e&&this.It.reject(e),this.aborted||(Ur("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Ju(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Yu(n,t)}}}]),e}(),Wu=function(){function e(t,n,r){(0,d.Z)(this,e),this.name=t,this.version=n,this.Rt=r,12.2===e.bt((0,w.z$)())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return(0,v.Z)(e,[{key:"Ct",value:function(){var e=(0,c.Z)(y().mark((function e(t){var n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return Ur("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Yu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Qr(Wr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new Qr(Wr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Yu(t,n))},i.onupgradeneeded=function(e){Ur("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.Rt.Nt(t,i.transaction,e.oldVersion,n.version).next((function(){Ur("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.kt&&(this.db.onversionchange=function(e){return n.kt(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"xt",value:function(e){this.kt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=(0,c.Z)(y().mark((function e(t,n,r,i){var a,o,u,s,c=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,o=0;case 2:return++o,e.prev=3,e.delegateYield(y().mark((function e(){var n,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Ct(t);case 2:return c.db=e.sent,n=Hu.open(c.db,t,a?"readonly":"readwrite",r),o=i(n).catch((function(e){return n.abort(e),zu.reject(e)})).toPromise(),o.catch((function(){})),e.next=7,n.At;case 7:return e.t0=o,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!==typeof(u=e.t0)){e.next=8;break}return e.abrupt("return",u.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),s="FirebaseError"!==e.t1.name&&o<3,Ur("SimpleDb","Transaction failed with error:",e.t1.message,"Retrying:",s),this.close(),s){e.next=15;break}return e.abrupt("return",Promise.reject(e.t1));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return Ur("SimpleDb","Removing database:",e),$u(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"Pt",value:function(){if(!(0,w.hl)())return!1;if(e.vt())return!0;var t=(0,w.z$)(),n=e.bt(t),r=0<n&&n<10,i=e.Vt(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"vt",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={NODE_ENV:"production",PUBLIC_URL:"/create-react-app-example",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===e?void 0:e.St)}},{key:"Dt",value:function(e,t){return e.store(t)}},{key:"bt",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"Vt",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Qu=function(){function e(t){(0,d.Z)(this,e),this.$t=t,this.Ot=!1,this.Ft=null}return(0,v.Z)(e,[{key:"isDone",get:function(){return this.Ot}},{key:"Mt",get:function(){return this.Ft}},{key:"cursor",set:function(e){this.$t=e}},{key:"done",value:function(){this.Ot=!0}},{key:"Lt",value:function(e){this.Ft=e}},{key:"delete",value:function(){return $u(this.$t.delete())}}]),e}(),Yu=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,Wr.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return(0,v.Z)(n)}(Qr);function Xu(e){return"IndexedDbTransactionError"===e.name}var Ju=function(){function e(t){(0,d.Z)(this,e),this.store=t}return(0,v.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(Ur("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Ur("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),$u(n)}},{key:"add",value:function(e){return Ur("SimpleDb","ADD",this.store.name,e,e),$u(this.store.add(e))}},{key:"get",value:function(e){var t=this;return $u(this.store.get(e)).next((function(n){return void 0===n&&(n=null),Ur("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return Ur("SimpleDb","DELETE",this.store.name,e),$u(this.store.delete(e))}},{key:"count",value:function(){return Ur("SimpleDb","COUNT",this.store.name),$u(this.store.count())}},{key:"Bt",value:function(e,t){var n=this.cursor(this.options(e,t)),r=[];return this.Ut(n,(function(e,t){r.push(t)})).next((function(){return r}))}},{key:"qt",value:function(e,t){Ur("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.Kt=!1;var r=this.cursor(n);return this.Ut(r,(function(e,t,n){return n.delete()}))}},{key:"jt",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Ut(r,t)}},{key:"Qt",value:function(e){var t=this.cursor({});return new zu((function(n,r){t.onerror=function(e){var t=ts(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"Ut",value:function(e,t){var n=[];return new zu((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Qu(i),o=t(i.primaryKey,i.value,a);if(o instanceof zu){var u=o.catch((function(e){return a.done(),zu.reject(e)}));n.push(u)}a.isDone?r():null===a.Mt?i.continue():i.continue(a.Mt)}else r()}})).next((function(){return zu.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.Kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function $u(e){return new zu((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=ts(e.target.error);n(t)}}))}var es=!1;function ts(e){var t=Wu.bt((0,w.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new Qr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return es||(es=!0,setTimeout((function(){throw r}),0)),r}}return e}var ns=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).Wt=e,i.currentSequenceNumber=r,i}return(0,v.Z)(n)}(Gu);function rs(e,t){var n=Hr(e);return Wu.Dt(n.Wt,t)}var is=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,v.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&to(i,e,n[r])}}},{key:"applyToLocalView",value:function(e){var t,n=(0,s.Z)(this.baseMutations);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.key.isEqual(e.key)&&no(r,e,this.localWriteTime)}}catch(u){n.e(u)}finally{n.f()}var i,a=(0,s.Z)(this.mutations);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.key.isEqual(e.key)&&no(o,e,this.localWriteTime)}}catch(u){a.e(u)}finally{a.f()}}},{key:"applyToLocalDocumentSet",value:function(e){var t=this;this.mutations.forEach((function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(di.min())}))}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),Co())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&li(this.mutations,e.mutations,(function(e,t){return io(e,t)}))&&li(this.baseMutations,e.baseMutations,(function(e,t){return io(e,t)}))}}]),e}(),as=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,v.Z)(e,null,[{key:"from",value:function(t,n,r){Gr(t.mutations.length===r.length);for(var i=_o(),a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),os=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:di.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:di.min(),u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ii.EMPTY_BYTE_STRING;(0,d.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u}return(0,v.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),us=(0,v.Z)((function e(t){(0,d.Z)(this,e),this.Gt=t}));function ss(e,t){if(t.document)return au(e.Gt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=Li.fromSegments(t.noDocument.path),r=ds(t.noDocument.readTime),i=Xi.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var a=Li.fromSegments(t.unknownDocument.path),o=ds(t.unknownDocument.version);return Xi.newUnknownDocument(a,o)}return Kr()}function cs(e,t,n){var r=ls(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var a=function(e,t){return{name:Jo(e,t.key),fields:t.data.value.mapValue.fields,updateTime:zo(e,t.version.toTimestamp())}}(e.Gt,t),o=t.hasCommittedMutations;return new Lu(null,null,a,o,r,i)}if(t.isNoDocument()){var u=t.key.path.toArray(),s=fs(t.version),c=t.hasCommittedMutations;return new Lu(null,new Nu(u,s),null,c,r,i)}if(t.isUnknownDocument()){var l=t.key.path.toArray(),h=fs(t.version);return new Lu(new Ru(l,h),null,null,!0,r,i)}return Kr()}function ls(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function hs(e){var t=new fi(e[0],e[1]);return di.fromTimestamp(t)}function fs(e){var t=e.toTimestamp();return new Au(t.seconds,t.nanoseconds)}function ds(e){var t=new fi(e.seconds,e.nanoseconds);return di.fromTimestamp(t)}function vs(e,t){for(var n=(t.baseMutations||[]).map((function(t){return su(e.Gt,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var o=t.mutations.map((function(t){return su(e.Gt,t)})),u=fi.fromMillis(t.localWriteTimeMs);return new is(t.batchId,u,n,o)}function ps(e){var t,n,r=ds(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?ds(e.lastLimboFreeSnapshotVersion):di.min();return void 0!==e.query.documents?(Gr(1===(n=e.query).documents.length),t=Aa(wa(tu(n.documents[0])))):t=function(e){return Aa(hu(e))}(e.query),new os(t,e.targetId,0,e.lastListenSequenceNumber,r,i,Ii.fromBase64String(e.resumeToken))}function ys(e,t){var n,r=fs(t.snapshotVersion),i=fs(t.lastLimboFreeSnapshotVersion);n=na(t.target)?cu(e.Gt,t.target):lu(e.Gt,t.target);var a=t.resumeToken.toBase64();return new Mu(t.targetId,ea(t.target),r,a,t.sequenceNumber,i,n)}function ms(e){var t=hu({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Za(t,t.limit,"L"):t}var gs=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return ks(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:ds(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return ks(e).put({bundleId:(n=t).id,createTime:fs(Qo(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return ws(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:ms(t.bundledQuery),readTime:ds(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return ws(e).put(function(e){return{name:e.name,readTime:fs(Qo(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function ks(e){return rs(e,qu.store)}function ws(e){return rs(e,Bu.store)}var bs=function(){function e(){(0,d.Z)(this,e),this.zt=new Es}return(0,v.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.zt.add(t),zu.resolve()}},{key:"getCollectionParents",value:function(e,t){return zu.resolve(this.zt.getEntries(t))}}]),e}(),Es=function(){function e(){(0,d.Z)(this,e),this.index={}}return(0,v.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Eo(gi.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Eo(gi.comparator)).toArray()}}]),e}(),Is=function(){function e(){(0,d.Z)(this,e),this.Ht=new Es}return(0,v.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.Ht.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.Ht.add(t)}));var a={collectionId:r,parent:Iu(i)};return Ts(e).put(a)}return zu.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[hi(t),""],!1,!0);return Ts(e).Bt(r).next((function(e){var r,i=(0,s.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(Su(a.parent))}}catch(o){i.e(o)}finally{i.f()}return n}))}}]),e}();function Ts(e){return rs(e,Vu.store)}var xs={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ss=function(){function e(t,n,r){(0,d.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,v.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function As(e,t,n){var r=e.store(Du.store),i=e.store(Cu.store),a=[],o=IDBKeyRange.only(n.batchId),u=0,c=r.jt({range:o},(function(e,t,n){return u++,n.delete()}));a.push(c.next((function(){Gr(1===u)})));var l,h=[],f=(0,s.Z)(n.mutations);try{for(f.s();!(l=f.n()).done;){var d=l.value,v=Cu.key(t,d.key.path,n.batchId);a.push(i.delete(v)),h.push(d.key)}}catch(p){f.e(p)}finally{f.f()}return zu.waitFor(a).next((function(){return h}))}function Zs(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Kr();t=e.noDocument}return JSON.stringify(t).length}Ss.DEFAULT_COLLECTION_PERCENTILE=10,Ss.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ss.DEFAULT=new Ss(41943040,Ss.DEFAULT_COLLECTION_PERCENTILE,Ss.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ss.DISABLED=new Ss(-1,0,0);var _s=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.userId=t,this.k=n,this.Jt=r,this.referenceDelegate=i,this.Yt={}}return(0,v.Z)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Cs(e).jt({index:Du.userMutationsIndex,range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=Ns(e),o=Cs(e);return o.add({}).next((function(u){Gr("number"==typeof u);var c,l=new is(u,t,n,r),h=function(e,t,n){var r=n.baseMutations.map((function(t){return uu(e.Gt,t)})),i=n.mutations.map((function(t){return uu(e.Gt,t)}));return new Du(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.k,i.userId,l),f=[],d=new Eo((function(e,t){return ci(e.canonicalString(),t.canonicalString())})),v=(0,s.Z)(r);try{for(v.s();!(c=v.n()).done;){var p=c.value,y=Cu.key(i.userId,p.key.path,u);d=d.add(p.key.path.popLast()),f.push(o.put(h)),f.push(a.put(y,Cu.PLACEHOLDER))}}catch(m){v.e(m)}finally{v.f()}return d.forEach((function(t){f.push(i.Jt.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.Yt[u]=l.keys()})),zu.waitFor(f).next((function(){return l}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return Cs(e).get(t).next((function(e){return e?(Gr(e.userId===n.userId),vs(n.k,e)):null}))}},{key:"Zt",value:function(e,t){var n=this;return this.Yt[t]?zu.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.Yt[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return Cs(e).jt({index:Du.userMutationsIndex,range:i},(function(e,t,i){t.userId===n.userId&&(Gr(t.batchId>=r),a=vs(n.k,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Cs(e).jt({index:Du.userMutationsIndex,range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Cs(e).Bt(Du.userMutationsIndex,n).next((function(e){return e.map((function(e){return vs(t.k,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=Cu.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return Ns(e).jt({range:i},(function(r,i,o){var s=(0,u.Z)(r,3),c=s[0],l=s[1],h=s[2],f=Su(l);if(c===n.userId&&t.path.isEqual(f))return Cs(e).get(h).next((function(e){if(!e)throw Kr();Gr(e.userId===n.userId),a.push(vs(n.k,e))}));o.done()})).next((function(){return a}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Eo(ci),i=[];return t.forEach((function(t){var a=Cu.prefixForPath(n.userId,t.path),o=IDBKeyRange.lowerBound(a),s=Ns(e).jt({range:o},(function(e,i,a){var o=(0,u.Z)(e,3),s=o[0],c=o[1],l=o[2],h=Su(c);s===n.userId&&t.path.isEqual(h)?r=r.add(l):a.done()}));i.push(s)})),zu.waitFor(i).next((function(){return n.te(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=Cu.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(a),s=new Eo(ci);return Ns(e).jt({range:o},(function(e,t,a){var o=(0,u.Z)(e,3),c=o[0],l=o[1],h=o[2],f=Su(l);c===n.userId&&r.isPrefixOf(f)?f.length===i&&(s=s.add(h)):a.done()})).next((function(){return n.te(e,s)}))}},{key:"te",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(Cs(e).get(t).next((function(e){if(null===e)throw Kr();Gr(e.userId===n.userId),r.push(vs(n.k,e))})))})),zu.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return As(e.Wt,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.ee(t.batchId)})),zu.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"ee",value:function(e){delete this.Yt[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return zu.resolve();var r=IDBKeyRange.lowerBound(Cu.prefixForUser(t.userId)),i=[];return Ns(e).jt({range:r},(function(e,n,r){if(e[0]===t.userId){var a=Su(e[1]);i.push(a)}else r.done()})).next((function(){Gr(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return Ds(e,this.userId,t)}},{key:"ne",value:function(e){var t=this;return Rs(e).get(this.userId).next((function(e){return e||new _u(t.userId,-1,"")}))}}],[{key:"Xt",value:function(t,n,r,i){return Gr(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function Ds(e,t,n){var r=Cu.prefixForPath(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),o=!1;return Ns(e).jt({range:a,Kt:!0},(function(e,n,r){var a=(0,u.Z)(e,3),s=a[0],c=a[1];a[2];s===t&&c===i&&(o=!0),r.done()})).next((function(){return o}))}function Cs(e){return rs(e,Du.store)}function Ns(e){return rs(e,Cu.store)}function Rs(e){return rs(e,_u.store)}var Ls=function(){function e(t){(0,d.Z)(this,e),this.se=t}return(0,v.Z)(e,[{key:"next",value:function(){return this.se+=2,this.se}}],[{key:"ie",value:function(){return new e(0)}},{key:"re",value:function(){return new e(-1)}}]),e}(),Os=function(){function e(t,n){(0,d.Z)(this,e),this.referenceDelegate=t,this.k=n}return(0,v.Z)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.oe(e).next((function(n){var r=new Ls(n.highestTargetId);return n.highestTargetId=r.next(),t.ae(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.oe(e).next((function(e){return di.fromTimestamp(new fi(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.oe(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.oe(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.ae(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.ce(e,t).next((function(){return n.oe(e).next((function(r){return r.targetCount+=1,n.ue(t,r),n.ae(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.ce(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Ms(e).delete(t.targetId)})).next((function(){return n.oe(e)})).next((function(t){return Gr(t.targetCount>0),t.targetCount-=1,n.ae(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Ms(e).jt((function(o,u){var s=ps(u);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))})).next((function(){return zu.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return Ms(e).jt((function(e,n){var r=ps(n);t(r)}))}},{key:"oe",value:function(e){return Ps(e).get(Fu.key).next((function(e){return Gr(null!==e),e}))}},{key:"ae",value:function(e,t){return Ps(e).put(Fu.key,t)}},{key:"ce",value:function(e,t){return Ms(e).put(ys(this.k,t))}},{key:"ue",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.oe(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=ea(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ms(e).jt({range:r,index:Mu.queryTargetsIndexName},(function(e,n,r){var a=ps(n);ta(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=Fs(e);return t.forEach((function(t){var o=Iu(t.path);i.push(a.put(new Pu(n,o))),i.push(r.referenceDelegate.addReference(e,n,t))})),zu.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=Fs(e);return zu.forEach(t,(function(t){var a=Iu(t.path);return zu.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Fs(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Fs(e),i=Co();return r.jt({range:n,Kt:!0},(function(e,t,n){var r=Su(e[1]),a=new Li(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=Iu(t.path),r=IDBKeyRange.bound([n],[hi(n)],!1,!0),i=0;return Fs(e).jt({index:Pu.documentTargetsIndex,Kt:!0,range:r},(function(e,t,n){var r=(0,u.Z)(e,2),a=r[0];r[1];0!==a&&(i++,n.done())})).next((function(){return i>0}))}},{key:"Et",value:function(e,t){return Ms(e).get(t).next((function(e){return e?ps(e):null}))}}]),e}();function Ms(e){return rs(e,Mu.store)}function Ps(e){return rs(e,Fu.store)}function Fs(e){return rs(e,Pu.store)}function Vs(e){return Us.apply(this,arguments)}function Us(){return Us=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===Wr.FAILED_PRECONDITION&&t.message===Ku){e.next=2;break}throw t;case 2:Ur("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)}))),Us.apply(this,arguments)}function qs(e,t){var n=(0,u.Z)(e,2),r=n[0],i=n[1],a=(0,u.Z)(t,2),o=a[0],s=a[1],c=ci(r,o);return 0===c?ci(i,s):c}var Bs=function(){function e(t){(0,d.Z)(this,e),this.he=t,this.buffer=new Eo(qs),this.le=0}return(0,v.Z)(e,[{key:"fe",value:function(){return++this.le}},{key:"de",value:function(e){var t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();qs(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),js=function(){function e(t,n){(0,d.Z)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.we=!1,this._e=null}return(0,v.Z)(e,[{key:"start",value:function(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}},{key:"stop",value:function(){this._e&&(this._e.cancel(),this._e=null)}},{key:"started",get:function(){return null!==this._e}},{key:"me",value:function(e){var t=this,n=this.we?3e5:6e4;Ur("LruGarbageCollector","Garbage collection scheduled in ".concat(n,"ms")),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(0,c.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t._e=null,t.we=!0,n.prev=1,n.next=4,e.collectGarbage(t.garbageCollector);case 4:n.next=14;break;case 6:if(n.prev=6,n.t0=n.catch(1),!Xu(n.t0)){n.next=12;break}Ur("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n.t0),n.next=14;break;case 12:return n.next=14,Vs(n.t0);case 14:return n.next=16,t.me(e);case 16:case"end":return n.stop()}}),n,null,[[1,6]])}))))}}]),e}(),Ks=function(){function e(t,n){(0,d.Z)(this,e),this.ge=t,this.params=n}return(0,v.Z)(e,[{key:"calculateTargetCount",value:function(e,t){return this.ge.ye(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return zu.resolve(oi.I);var r=new Bs(t);return this.ge.forEachTarget(e,(function(e){return r.de(e.sequenceNumber)})).next((function(){return n.ge.pe(e,(function(e){return r.de(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.ge.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.ge.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Ur("LruGarbageCollector","Garbage collection skipped; disabled"),zu.resolve(xs)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Ur("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),xs):n.Te(e,t)}))}},{key:"getCacheSize",value:function(e){return this.ge.getCacheSize(e)}},{key:"Te",value:function(e,t){var n,r,i,a,o,u,s,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(Ur("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,o=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,u=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return s=Date.now(),Fr()<=k.in.DEBUG&&Ur("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(u-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(s-u)+"ms\n"+"Total Duration: ".concat(s-l,"ms")),zu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}(),Gs=function(){function e(t,n){(0,d.Z)(this,e),this.db=t,this.garbageCollector=function(e,t){return new Ks(e,t)}(this,n)}return(0,v.Z)(e,[{key:"ye",value:function(e){var t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"Ee",value:function(e){var t=0;return this.pe(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"pe",value:function(e,t){return this.Ie(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return zs(e,n)}},{key:"removeReference",value:function(e,t,n){return zs(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return zs(e,t)}},{key:"Ae",value:function(e,t){return function(e,t){var n=!1;return Rs(e).Qt((function(r){return Ds(e,r,t).next((function(e){return e&&(n=!0),zu.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Ie(e,(function(o,u){if(u<=t){var s=n.Ae(e,o).next((function(t){if(!t)return a++,r.getEntry(e,o).next((function(){return r.removeEntry(o),Fs(e).delete([0,Iu(o.path)])}))}));i.push(s)}})).next((function(){return zu.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return zs(e,t)}},{key:"Ie",value:function(e,t){var n,r=Fs(e),i=oi.I;return r.jt({index:Pu.documentTargetsIndex},(function(e,r){var a=(0,u.Z)(e,2),o=a[0],s=(a[1],r.path),c=r.sequenceNumber;0===o?(i!==oi.I&&t(new Li(Su(n)),i),i=c,n=s):i=oi.I})).next((function(){i!==oi.I&&t(new Li(Su(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function zs(e,t){return Fs(e).put(function(e,t){return new Pu(0,Iu(e.path),t)}(t,e.currentSequenceNumber))}var Hs=function(){function e(t,n){(0,d.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return(0,v.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=(0,s.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,u.Z)(r.value,2),o=a[0],c=a[1];if(this.equalsFn(o,e))return c}}catch(l){i.e(l)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}},{key:"forEach",value:function(e){pi(this.inner,(function(t,n){var r,i=(0,s.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,u.Z)(r.value,2),o=a[0],c=a[1];e(o,c)}}catch(l){i.e(l)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return yi(this.inner)}}]),e}(),Ws=function(){function e(){(0,d.Z)(this,e),this.changes=new Hs((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,v.Z)(e,[{key:"getReadTime",value:function(e){var t=this.changes.get(e);return t?t.readTime:di.min()}},{key:"addEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}},{key:"removeEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.assertNotApplied(),this.changes.set(e,{document:Xi.newInvalidDocument(e),readTime:t})}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?zu.resolve(n.document):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Qs=function(){function e(t,n){(0,d.Z)(this,e),this.k=t,this.Jt=n}return(0,v.Z)(e,[{key:"addEntry",value:function(e,t,n){return Js(e).put($s(t),n)}},{key:"removeEntry",value:function(e,t){var n=Js(e),r=$s(t);return n.delete(r)}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.Re(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this;return Js(e).get($s(t)).next((function(e){return n.be(t,e)}))}},{key:"Pe",value:function(e,t){var n=this;return Js(e).get($s(t)).next((function(e){return{document:n.be(t,e),size:Zs(e)}}))}},{key:"getEntries",value:function(e,t){var n=this,r=xo();return this.ve(e,t,(function(e,t){var i=n.be(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"Ve",value:function(e,t){var n=this,r=xo(),i=new ko(Li.comparator);return this.ve(e,t,(function(e,t){var a=n.be(e,t);r=r.insert(e,a),i=i.insert(e,Zs(t))})).next((function(){return{documents:r,Se:i}}))}},{key:"ve",value:function(e,t,n){if(t.isEmpty())return zu.resolve();var r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator(),a=i.getNext();return Js(e).jt({range:r},(function(e,t,r){for(var o=Li.fromSegments(e);a&&Li.comparator(a,o)<0;)n(a,null),a=i.getNext();a&&a.isEqual(o)&&(n(a,t),a=i.hasNext()?i.getNext():null),a?r.Lt(a.path.toArray()):r.done()})).next((function(){for(;a;)n(a,null),a=i.hasNext()?i.getNext():null}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){var r=this,i=xo(),a=t.path.length+1,o={};if(n.isEqual(di.min())){var u=t.path.toArray();o.range=IDBKeyRange.lowerBound(u)}else{var s=t.path.toArray(),c=ls(n);o.range=IDBKeyRange.lowerBound([s,c],!0),o.index=Lu.collectionReadTimeIndex}return Js(e).jt(o,(function(e,n,o){if(e.length===a){var u=ss(r.k,n);t.path.isPrefixOf(u.key.path)?Na(t,u)&&(i=i.insert(u.key,u)):o.done()}})).next((function(){return i}))}},{key:"newChangeBuffer",value:function(e){return new Ys(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return Xs(e).get(Ou.key).next((function(e){return Gr(!!e),e}))}},{key:"Re",value:function(e,t){return Xs(e).put(Ou.key,t)}},{key:"be",value:function(e,t){if(t){var n=ss(this.k,t);if(!n.isNoDocument()||!n.version.isEqual(di.min()))return n}return Xi.newInvalidDocument(e)}}]),e}(),Ys=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).De=e,i.trackRemovals=r,i.Ce=new Hs((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return(0,v.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new Eo((function(e,t){return ci(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,o){var u=t.Ce.get(a);if(o.document.isValidDocument()){var s=cs(t.De.k,o.document,t.getReadTime(a));i=i.add(a.path.popLast());var c=Zs(s);r+=c-u,n.push(t.De.addEntry(e,a,s))}else if(r-=u,t.trackRemovals){var l=cs(t.De.k,Xi.newNoDocument(a,di.min()),t.getReadTime(a));n.push(t.De.addEntry(e,a,l))}else n.push(t.De.removeEntry(e,a))})),i.forEach((function(r){n.push(t.De.Jt.addToCollectionParentIndex(e,r))})),n.push(this.De.updateMetadata(e,r)),zu.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.De.Pe(e,t).next((function(e){return n.Ce.set(t,e.size),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.De.Ve(e,t).next((function(e){var t=e.documents;return e.Se.forEach((function(e,t){n.Ce.set(e,t)})),t}))}}]),n}(Ws);function Xs(e){return rs(e,Ou.store)}function Js(e){return rs(e,Lu.store)}function $s(e){return e.path.toArray()}var ec=function(){function e(t){(0,d.Z)(this,e),this.k=t}return(0,v.Z)(e,[{key:"Nt",value:function(e,t,n,r){var i=this;Gr(n<r&&n>=0&&r<=11);var a=new Hu("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(Zu.store)}(e),function(e){e.createObjectStore(_u.store,{keyPath:_u.keyPath}),e.createObjectStore(Du.store,{keyPath:Du.keyPath,autoIncrement:!0}).createIndex(Du.userMutationsIndex,Du.userMutationsKeyPath,{unique:!0}),e.createObjectStore(Cu.store)}(e),tc(e),function(e){e.createObjectStore(Lu.store)}(e));var o=zu.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Pu.store),e.deleteObjectStore(Mu.store),e.deleteObjectStore(Fu.store)}(e),tc(e)),o=o.next((function(){return function(e){var t=e.store(Fu.store),n=new Fu(0,0,di.min().toTimestamp(),0);return t.put(Fu.key,n)}(a)}))),n<4&&r>=4&&(0!==n&&(o=o.next((function(){return function(e,t){return t.store(Du.store).Bt().next((function(n){e.deleteObjectStore(Du.store),e.createObjectStore(Du.store,{keyPath:Du.keyPath,autoIncrement:!0}).createIndex(Du.userMutationsIndex,Du.userMutationsKeyPath,{unique:!0});var r=t.store(Du.store),i=n.map((function(e){return r.put(e)}));return zu.waitFor(i)}))}(e,a)}))),o=o.next((function(){!function(e){e.createObjectStore(Uu.store,{keyPath:Uu.keyPath})}(e)}))),n<5&&r>=5&&(o=o.next((function(){return i.Ne(a)}))),n<6&&r>=6&&(o=o.next((function(){return function(e){e.createObjectStore(Ou.store)}(e),i.ke(a)}))),n<7&&r>=7&&(o=o.next((function(){return i.xe(a)}))),n<8&&r>=8&&(o=o.next((function(){return i.$e(e,a)}))),n<9&&r>=9&&(o=o.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){var t=e.objectStore(Lu.store);t.createIndex(Lu.readTimeIndex,Lu.readTimeIndexPath,{unique:!1}),t.createIndex(Lu.collectionReadTimeIndex,Lu.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(o=o.next((function(){return i.Oe(a)}))),n<11&&r>=11&&(o=o.next((function(){!function(e){e.createObjectStore(qu.store,{keyPath:qu.keyPath})}(e),function(e){e.createObjectStore(Bu.store,{keyPath:Bu.keyPath})}(e)}))),o}},{key:"ke",value:function(e){var t=0;return e.store(Lu.store).jt((function(e,n){t+=Zs(n)})).next((function(){var n=new Ou(t);return e.store(Ou.store).put(Ou.key,n)}))}},{key:"Ne",value:function(e){var t=this,n=e.store(_u.store),r=e.store(Du.store);return n.Bt().next((function(n){return zu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Bt(Du.userMutationsIndex,i).next((function(r){return zu.forEach(r,(function(r){Gr(r.userId===n.userId);var i=vs(t.k,r);return As(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"xe",value:function(e){var t=e.store(Pu.store),n=e.store(Lu.store);return e.store(Fu.store).get(Fu.key).next((function(e){var r=[];return n.jt((function(n,i){var a=new gi(n),o=function(e){return[0,Iu(e)]}(a);r.push(t.get(o).next((function(n){return n?zu.resolve():function(n){return t.put(new Pu(0,Iu(n),e.highestListenSequenceNumber))}(a)})))})).next((function(){return zu.waitFor(r)}))}))}},{key:"$e",value:function(e,t){e.createObjectStore(Vu.store,{keyPath:Vu.keyPath});var n=t.store(Vu.store),r=new Es,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:Iu(i)})}};return t.store(Lu.store).jt({Kt:!0},(function(e,t){var n=new gi(e);return i(n.popLast())})).next((function(){return t.store(Cu.store).jt({Kt:!0},(function(e,t){var n=(0,u.Z)(e,3),r=(n[0],n[1]),a=(n[2],Su(r));return i(a.popLast())}))}))}},{key:"Oe",value:function(e){var t=this,n=e.store(Mu.store);return n.jt((function(e,r){var i=ps(r),a=ys(t.k,i);return n.put(a)}))}}]),e}();function tc(e){e.createObjectStore(Pu.store,{keyPath:Pu.keyPath}).createIndex(Pu.documentTargetsIndex,Pu.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Mu.store,{keyPath:Mu.keyPath}).createIndex(Mu.queryTargetsIndexName,Mu.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Fu.store)}var nc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",rc=function(){function e(t,n,r,i,a,o,u,s,c,l){if((0,d.Z)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Fe=a,this.window=o,this.document=u,this.Me=c,this.Le=l,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=function(e){return Promise.resolve()},!e.Pt())throw new Qr(Wr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gs(this,i),this.Ge=n+"main",this.k=new us(s),this.ze=new Wu(this.Ge,11,new ec(this.k)),this.He=new Os(this.referenceDelegate,this.k),this.Jt=new Is,this.Je=function(e,t){return new Qs(e,t)}(this.k,this.Jt),this.Ye=new gs,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===l&&qr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return(0,v.Z)(e,[{key:"start",value:function(){var e=this;return this.Ze().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Qr(Wr.FAILED_PRECONDITION,nc);return e.tn(),e.en(),e.nn(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.He.getHighestSequenceNumber(t)}))})).then((function(t){e.Be=new oi(t,e.Me)})).then((function(){e.Ue=!0})).catch((function(t){return e.ze&&e.ze.close(),Promise.reject(t)}))}},{key:"sn",value:function(e){var t=this;return this.We=function(){var n=(0,c.Z)(y().mark((function n(r){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.ze.xt(function(){var t=(0,c.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Fe.enqueueAndForget((0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.Ze();case 4:case"end":return e.stop()}}),e)})))))}},{key:"Ze",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return ac(t).put(new Uu(e.clientId,Date.now(),e.networkEnabled,e.inForeground)).next((function(){if(e.isPrimary)return e.rn(t).next((function(t){t||(e.isPrimary=!1,e.Fe.enqueueRetryable((function(){return e.We(!1)})))}))})).next((function(){return e.on(t)})).next((function(n){return e.isPrimary&&!n?e.an(t).next((function(){return!1})):!!n&&e.cn(t).next((function(){return!0}))}))})).catch((function(t){if(Xu(t))return Ur("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return Ur("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.Fe.enqueueRetryable((function(){return e.We(t)})),e.isPrimary=t}))}},{key:"rn",value:function(e){var t=this;return ic(e).get(Zu.key).next((function(e){return zu.resolve(t.un(e))}))}},{key:"hn",value:function(e){return ac(e).delete(this.clientId)}},{key:"ln",value:function(){var e=(0,c.Z)(y().mark((function e(){var t,n,r,i,a=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.fn(this.Qe,18e5)){e.next=6;break}return this.Qe=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=rs(e,Uu.store);return t.Bt().next((function(e){var n=a.dn(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return zu.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.Xe){n=(0,s.Z)(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.Xe.removeItem(this.wn(i.clientId))}catch(o){n.e(o)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nn",value:function(){var e=this;this.je=this.Fe.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.Ze().then((function(){return e.ln()})).then((function(){return e.nn()}))}))}},{key:"un",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"on",value:function(e){var t=this;return this.Le?zu.resolve(!0):ic(e).get(Zu.key).next((function(n){if(null!==n&&t.fn(n.leaseTimestampMs,5e3)&&!t._n(n.ownerId)){if(t.un(n)&&t.networkEnabled)return!0;if(!t.un(n)){if(!n.allowTabSynchronization)throw new Qr(Wr.FAILED_PRECONDITION,nc);return!1}}return!(!t.networkEnabled||!t.inForeground)||ac(e).Bt().next((function(e){return void 0===t.dn(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&Ur("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:function(){var e=(0,c.Z)(y().mark((function e(){var t=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),e.next=7,this.ze.runTransaction("shutdown","readwrite",[Zu.store,Uu.store],(function(e){var n=new ns(e,oi.I);return t.an(n).next((function(){return t.hn(n)}))}));case 7:this.ze.close(),this.pn();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dn",value:function(e,t){var n=this;return e.filter((function(e){return n.fn(e.updateTimeMs,t)&&!n._n(e.clientId)}))}},{key:"Tn",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return ac(t).Bt().next((function(t){return e.dn(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.Ue}},{key:"getMutationQueue",value:function(e){return _s.Xt(e,this.k,this.Jt,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.He}},{key:"getRemoteDocumentCache",value:function(){return this.Je}},{key:"getIndexManager",value:function(){return this.Jt}},{key:"getBundleCache",value:function(){return this.Ye}},{key:"runTransaction",value:function(e,t,n){var r=this;Ur("IndexedDbPersistence","Starting transaction:",e);var i,a="readonly"===t?"readonly":"readwrite";return this.ze.runTransaction(e,a,ju,(function(a){return i=new ns(a,r.Be?r.Be.next():oi.I),"readwrite-primary"===t?r.rn(i).next((function(e){return!!e||r.on(i)})).next((function(t){if(!t)throw qr("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.Fe.enqueueRetryable((function(){return r.We(!1)})),new Qr(Wr.FAILED_PRECONDITION,Ku);return n(i)})).next((function(e){return r.cn(i).next((function(){return e}))})):r.En(i).next((function(){return n(i)}))})).then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"En",value:function(e){var t=this;return ic(e).get(Zu.key).next((function(e){if(null!==e&&t.fn(e.leaseTimestampMs,5e3)&&!t._n(e.ownerId)&&!t.un(e)&&!(t.Le||t.allowTabSynchronization&&e.allowTabSynchronization))throw new Qr(Wr.FAILED_PRECONDITION,nc)}))}},{key:"cn",value:function(e){var t=new Zu(this.clientId,this.allowTabSynchronization,Date.now());return ic(e).put(Zu.key,t)}},{key:"an",value:function(e){var t=this,n=ic(e);return n.get(Zu.key).next((function(e){return t.un(e)?(Ur("IndexedDbPersistence","Releasing primary lease."),n.delete(Zu.key)):zu.resolve()}))}},{key:"fn",value:function(e,t){var n=Date.now();return!(e<n-t)&&(!(e>n)||(qr("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}},{key:"tn",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=function(){e.Fe.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.Ze()}))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}},{key:"gn",value:function(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}},{key:"en",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=function(){t.mn(),(0,w.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&t.Fe.enterRestrictedMode(!0),t.Fe.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.qe))}},{key:"yn",value:function(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}},{key:"_n",value:function(e){var t;try{var n=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return Ur("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return qr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"mn",value:function(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(L){qr("Failed to set zombie client id.",L)}}},{key:"pn",value:function(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(L){}}},{key:"wn",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"Pt",value:function(){return Wu.Pt()}}]),e}();function ic(e){return rs(e,Zu.store)}function ac(e){return rs(e,Uu.store)}function oc(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var uc=(0,v.Z)((function e(t,n){(0,d.Z)(this,e),this.progress=t,this.In=n})),sc=function(){function e(t,n,r){(0,d.Z)(this,e),this.Je=t,this.An=n,this.Jt=r}return(0,v.Z)(e,[{key:"Rn",value:function(e,t){var n=this;return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next((function(r){return n.bn(e,t,r)}))}},{key:"bn",value:function(e,t,n){return this.Je.getEntry(e,t).next((function(e){var t,r=(0,s.Z)(n);try{for(r.s();!(t=r.n()).done;){t.value.applyToLocalView(e)}}catch(i){r.e(i)}finally{r.f()}return e}))}},{key:"Pn",value:function(e,t){e.forEach((function(e,n){var r,i=(0,s.Z)(t);try{for(i.s();!(r=i.n()).done;){r.value.applyToLocalView(n)}}catch(a){i.e(a)}finally{i.f()}}))}},{key:"vn",value:function(e,t){var n=this;return this.Je.getEntries(e,t).next((function(t){return n.Vn(e,t).next((function(){return t}))}))}},{key:"Vn",value:function(e,t){var n=this;return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){return n.Pn(t,e)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return Li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Sn(e,t.path):xa(t)?this.Dn(e,t,n):this.Cn(e,t,n)}},{key:"Sn",value:function(e,t){return this.Rn(e,new Li(t)).next((function(e){var t=Ao();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"Dn",value:function(e,t,n){var r=this,i=t.collectionGroup,a=Ao();return this.Jt.getCollectionParents(e,i).next((function(o){return zu.forEach(o,(function(o){var u=function(e,t){return new ga(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return r.Cn(e,u,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"Cn",value:function(e,t,n){var r,i,a=this;return this.Je.getDocumentsMatchingQuery(e,t,n).next((function(n){return r=n,a.An.getAllMutationBatchesAffectingQuery(e,t)})).next((function(t){return i=t,a.Nn(e,i,r).next((function(e){r=e;var t,n=(0,s.Z)(i);try{for(n.s();!(t=n.n()).done;){var a,o=t.value,u=(0,s.Z)(o.mutations);try{for(u.s();!(a=u.n()).done;){var c=a.value,l=c.key,h=r.get(l);null==h&&(h=Xi.newInvalidDocument(l),r=r.insert(l,h)),no(c,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(l))}}catch(f){u.e(f)}finally{u.f()}}}catch(f){n.e(f)}finally{n.f()}}))})).next((function(){return r.forEach((function(e,n){Na(t,n)||(r=r.remove(e))})),r}))}},{key:"Nn",value:function(e,t,n){var r,i=Co(),a=(0,s.Z)(t);try{for(a.s();!(r=a.n()).done;){var o,u=r.value,c=(0,s.Z)(u.mutations);try{for(c.s();!(o=c.n()).done;){var l=o.value;l instanceof uo&&null===n.get(l.key)&&(i=i.add(l.key))}}catch(f){c.e(f)}finally{c.f()}}}catch(f){a.e(f)}finally{a.f()}var h=n;return this.Je.getEntries(e,i).next((function(e){return e.forEach((function(e,t){t.isFoundDocument()&&(h=h.insert(e,t))})),h}))}}]),e}(),cc=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.targetId=t,this.fromCache=n,this.kn=r,this.xn=i}return(0,v.Z)(e,null,[{key:"$n",value:function(t,n){var r,i=Co(),a=Co(),o=(0,s.Z)(n.docChanges);try{for(o.s();!(r=o.n()).done;){var u=r.value;switch(u.type){case 0:i=i.add(u.doc.key);break;case 1:a=a.add(u.doc.key)}}}catch(c){o.e(c)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),lc=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,[{key:"On",value:function(e){this.Fn=e}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(di.min())?this.Mn(e,t):this.Fn.vn(e,r).next((function(a){var o=i.Ln(t,a);return(ba(t)||Ea(t))&&i.Bn(t.limitType,o,r,n)?i.Mn(e,t):(Fr()<=k.in.DEBUG&&Ur("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ca(t)),i.Fn.getDocumentsMatchingQuery(e,t,n).next((function(e){return o.forEach((function(t){e=e.insert(t.key,t)})),e})))}))}},{key:"Ln",value:function(e,t){var n=new Eo(Ra(e));return t.forEach((function(t,r){Na(e,r)&&(n=n.add(r))})),n}},{key:"Bn",value:function(e,t,n,r){if(n.size!==t.size)return!0;var i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Mn",value:function(e,t){return Fr()<=k.in.DEBUG&&Ur("QueryEngine","Using full collection scan to execute query:",Ca(t)),this.Fn.getDocumentsMatchingQuery(e,t,di.min())}}]),e}(),hc=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.persistence=t,this.Un=n,this.k=i,this.qn=new ko(ci),this.Kn=new Hs((function(e){return ea(e)}),ta),this.jn=di.min(),this.An=t.getMutationQueue(r),this.Qn=t.getRemoteDocumentCache(),this.He=t.getTargetCache(),this.Wn=new sc(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=t.getBundleCache(),this.Un.On(this.Wn)}return(0,v.Z)(e,[{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.qn)}))}}]),e}();function fc(e,t,n,r){return new hc(e,t,n,r)}function dc(e,t){return vc.apply(this,arguments)}function vc(){return vc=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t),i=r.An,a=r.Wn,e.next=4,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.An.getAllMutationBatches(e).next((function(o){return t=o,i=r.persistence.getMutationQueue(n),a=new sc(r.Qn,i,r.persistence.getIndexManager()),i.getAllMutationBatches(e)})).next((function(n){var r,i=[],o=[],u=Co(),c=(0,s.Z)(t);try{for(c.s();!(r=c.n()).done;){var l=r.value;i.push(l.batchId);var h,f=(0,s.Z)(l.mutations);try{for(f.s();!(h=f.n()).done;){var d=h.value;u=u.add(d.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){c.e(w)}finally{c.f()}var v,p=(0,s.Z)(n);try{for(p.s();!(v=p.n()).done;){var y=v.value;o.push(y.batchId);var m,g=(0,s.Z)(y.mutations);try{for(g.s();!(m=g.n()).done;){var k=m.value;u=u.add(k.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){p.e(w)}finally{p.f()}return a.vn(e,u).next((function(e){return{Gn:e,removedBatchIds:i,addedBatchIds:o}}))}))}));case 4:return o=e.sent,e.abrupt("return",(r.An=i,r.Wn=a,r.Un.On(r.Wn),o));case 6:case"end":return e.stop()}}),e)}))),vc.apply(this,arguments)}function pc(e,t){var n=Hr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),o=zu.resolve();return a.forEach((function(e){o=o.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);Gr(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),o.next((function(){return e.An.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.An.performConsistencyCheck(e)})).next((function(){return n.Wn.vn(e,r)}))}))}function yc(e){var t=Hr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.He.getLastRemoteSnapshotVersion(e)}))}function mc(e,t){var n=Hr(e),r=t.snapshotVersion,i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;var o=[];t.targetChanges.forEach((function(a,u){var s=i.get(u);if(s){o.push(n.He.removeMatchingKeys(e,a.removedDocuments,u).next((function(){return n.He.addMatchingKeys(e,a.addedDocuments,u)})));var c=s.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(u)?c=c.withResumeToken(Ii.EMPTY_BYTE_STRING,di.min()).withLastLimboFreeSnapshotVersion(di.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(u,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,a)&&o.push(n.He.updateTargetData(e,c))}}));var u=xo();if(t.documentUpdates.forEach((function(r,i){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(gc(e,a,t.documentUpdates,r,void 0).next((function(e){u=e}))),!r.isEqual(di.min())){var s=n.He.getLastRemoteSnapshotVersion(e).next((function(t){return n.He.setTargetsMetadata(e,e.currentSequenceNumber,r)}));o.push(s)}return zu.waitFor(o).next((function(){return a.apply(e)})).next((function(){return n.Wn.Vn(e,u)})).next((function(){return u}))})).then((function(e){return n.qn=i,e}))}function gc(e,t,n,r,i){var a=Co();return n.forEach((function(e){return a=a.add(e)})),t.getEntries(e,a).next((function(e){var a=xo();return n.forEach((function(n,o){var u=e.get(n),s=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(di.min())?(t.removeEntry(n,s),a=a.insert(n,o)):!u.isValidDocument()||o.version.compareTo(u.version)>0||0===o.version.compareTo(u.version)&&u.hasPendingWrites?(t.addEntry(o,s),a=a.insert(n,o)):Ur("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",o.version)})),a}))}function kc(e,t){var n=Hr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)}))}function wc(e,t){var n=Hr(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.He.getTargetData(e,t).next((function(i){return i?(r=i,zu.resolve(r)):n.He.allocateTargetId(e).next((function(i){return r=new os(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e}))}function bc(e,t,n){return Ec.apply(this,arguments)}function Ec(){return Ec=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Hr(t),a=i.qn.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",o,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Xu(e.t1)){e.next=12;break}throw e.t1;case 12:Ur("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.qn=i.qn.remove(n),i.Kn.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])}))),Ec.apply(this,arguments)}function Ic(e,t,n){var r=Hr(e),i=di.min(),a=Co();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=Hr(e),i=r.Kn.get(n);return void 0!==i?zu.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,Aa(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Un.getDocumentsMatchingQuery(e,t,n?i:di.min(),n?a:Co())})).next((function(e){return{documents:e,zn:a}}))}))}function Tc(e,t){var n=Hr(e),r=Hr(n.He),i=n.qn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.Et(e,t).next((function(e){return e?e.target:null}))}))}function xc(e){var t=Hr(e);return t.persistence.runTransaction("Get new document changes","readonly",(function(e){return function(e,t,n){var r=Hr(e),i=xo(),a=ls(n),o=Js(t),u=IDBKeyRange.lowerBound(a,!0);return o.jt({index:Lu.readTimeIndex,range:u},(function(e,t){var n=ss(r.k,t);i=i.insert(n.key,n),a=t.readTime})).next((function(){return{In:i,readTime:hs(a)}}))}(t.Qn,e,t.jn)})).then((function(e){var n=e.In,r=e.readTime;return t.jn=r,n}))}function Sc(e){return Ac.apply(this,arguments)}function Ac(){return Ac=(0,c.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Hr(t),e.abrupt("return",n.persistence.runTransaction("Synchronize last document change read time","readonly",(function(e){return function(e){var t=Js(e),n=di.min();return t.jt({index:Lu.readTimeIndex,reverse:!0},(function(e,t,r){t.readTime&&(n=hs(t.readTime)),r.done()})).next((function(){return n}))}(e)})).then((function(e){n.jn=e})));case 2:case"end":return e.stop()}}),e)}))),Ac.apply(this,arguments)}function Zc(e,t,n,r){return _c.apply(this,arguments)}function _c(){return _c=(0,c.Z)(y().mark((function e(t,n,r,i){var a,o,u,c,l,h,f,d,v,p;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Hr(t),o=Co(),u=xo(),c=_o(),l=(0,s.Z)(r);try{for(l.s();!(h=l.n()).done;)f=h.value,d=n.Hn(f.metadata.name),f.document&&(o=o.add(d)),u=u.insert(d,n.Jn(f)),c=c.insert(d,n.Yn(f.metadata.readTime))}catch(y){l.e(y)}finally{l.f()}return v=a.Qn.newChangeBuffer({trackRemovals:!0}),e.next=7,wc(a,function(e){return Aa(wa(gi.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return p=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return gc(e,v,u,di.min(),c).next((function(t){return v.apply(e),t})).next((function(t){return a.He.removeMatchingKeysForTargetId(e,p.targetId).next((function(){return a.He.addMatchingKeys(e,o,p.targetId)})).next((function(){return a.Wn.Vn(e,t)})).next((function(){return t}))}))})));case 9:case"end":return e.stop()}}),e)}))),_c.apply(this,arguments)}function Dc(e,t){return Cc.apply(this,arguments)}function Cc(){return Cc=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:Co(),e.next=3,wc(t,Aa(ms(n.bundledQuery)));case 3:return i=e.sent,a=Hr(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Qo(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Ye.saveNamedQuery(e,n);var o=i.withResumeToken(Ii.EMPTY_BYTE_STRING,t);return a.qn=a.qn.insert(o.targetId,o),a.He.updateTargetData(e,o).next((function(){return a.He.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.He.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Ye.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),Cc.apply(this,arguments)}var Nc=function(){function e(t){(0,d.Z)(this,e),this.k=t,this.Xn=new Map,this.Zn=new Map}return(0,v.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return zu.resolve(this.Xn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:Qo(n.createTime)}),zu.resolve()}},{key:"getNamedQuery",value:function(e,t){return zu.resolve(this.Zn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Zn.set(t.name,function(e){return{name:e.name,query:ms(e.bundledQuery),readTime:Qo(e.readTime)}}(t)),zu.resolve()}}]),e}(),Rc=function(){function e(){(0,d.Z)(this,e),this.ts=new Eo(Lc.es),this.ns=new Eo(Lc.ss)}return(0,v.Z)(e,[{key:"isEmpty",value:function(){return this.ts.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Lc(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}},{key:"rs",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.os(new Lc(e,t))}},{key:"cs",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"us",value:function(e){var t=this,n=new Li(new gi([])),r=new Lc(n,e),i=new Lc(n,e+1),a=[];return this.ns.forEachInRange([r,i],(function(e){t.os(e),a.push(e.key)})),a}},{key:"hs",value:function(){var e=this;this.ts.forEach((function(t){return e.os(t)}))}},{key:"os",value:function(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}},{key:"ls",value:function(e){var t=new Li(new gi([])),n=new Lc(t,e),r=new Lc(t,e+1),i=Co();return this.ns.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Lc(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Lc=function(){function e(t,n){(0,d.Z)(this,e),this.key=t,this.fs=n}return(0,v.Z)(e,null,[{key:"es",value:function(e,t){return Li.comparator(e.key,t.key)||ci(e.fs,t.fs)}},{key:"ss",value:function(e,t){return ci(e.fs,t.fs)||Li.comparator(e.key,t.key)}}]),e}(),Oc=function(){function e(t,n){(0,d.Z)(this,e),this.Jt=t,this.referenceDelegate=n,this.An=[],this.ds=1,this.ws=new Eo(Lc.es)}return(0,v.Z)(e,[{key:"checkEmpty",value:function(e){return zu.resolve(0===this.An.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];var a=new is(i,t,n,r);this.An.push(a);var o,u=(0,s.Z)(r);try{for(u.s();!(o=u.n()).done;){var c=o.value;this.ws=this.ws.add(new Lc(c.key,i)),this.Jt.addToCollectionParentIndex(e,c.key.path.popLast())}}catch(l){u.e(l)}finally{u.f()}return zu.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return zu.resolve(this._s(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.gs(n),i=r<0?0:r;return zu.resolve(this.An.length>i?this.An[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return zu.resolve(0===this.An.length?-1:this.ds-1)}},{key:"getAllMutationBatches",value:function(e){return zu.resolve(this.An.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Lc(t,0),i=new Lc(t,Number.POSITIVE_INFINITY),a=[];return this.ws.forEachInRange([r,i],(function(e){var t=n._s(e.fs);a.push(t)})),zu.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Eo(ci);return t.forEach((function(e){var t=new Lc(e,0),i=new Lc(e,Number.POSITIVE_INFINITY);n.ws.forEachInRange([t,i],(function(e){r=r.add(e.fs)}))})),zu.resolve(this.ys(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;Li.isDocumentKey(i)||(i=i.child(""));var a=new Lc(new Li(i),0),o=new Eo(ci);return this.ws.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)}),a),zu.resolve(this.ys(o))}},{key:"ys",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t._s(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;Gr(0===this.ps(t.batchId,"removed")),this.An.shift();var r=this.ws;return zu.forEach(t.mutations,(function(i){var a=new Lc(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.ws=r}))}},{key:"ee",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Lc(t,0),r=this.ws.firstAfterOrEqual(n);return zu.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.An.length,zu.resolve()}},{key:"ps",value:function(e,t){return this.gs(e)}},{key:"gs",value:function(e){return 0===this.An.length?0:e-this.An[0].batchId}},{key:"_s",value:function(e){var t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}]),e}(),Mc=function(){function e(t,n){(0,d.Z)(this,e),this.Jt=t,this.Ts=n,this.docs=new ko(Li.comparator),this.size=0}return(0,v.Z)(e,[{key:"addEntry",value:function(e,t,n){var r=t.key,i=this.docs.get(r),a=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-a,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return zu.resolve(n?n.document.mutableCopy():Xi.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=xo();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Xi.newInvalidDocument(e))})),zu.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){for(var r=xo(),i=new Li(t.path.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var o=a.getNext(),u=o.key,s=o.value,c=s.document,l=s.readTime;if(!t.path.isPrefixOf(u.path))break;l.compareTo(n)<=0||Na(t,c)&&(r=r.insert(c.key,c.mutableCopy()))}return zu.resolve(r)}},{key:"Es",value:function(e,t){return zu.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new Pc(this)}},{key:"getSize",value:function(e){return zu.resolve(this.size)}}]),e}(),Pc=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this)).De=e,r}return(0,v.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(t.De.addEntry(e,i.document,t.getReadTime(r))):t.De.removeEntry(r)})),zu.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.De.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.De.getEntries(e,t)}}]),n}(Ws),Fc=function(){function e(t){(0,d.Z)(this,e),this.persistence=t,this.Is=new Hs((function(e){return ea(e)}),ta),this.lastRemoteSnapshotVersion=di.min(),this.highestTargetId=0,this.As=0,this.Rs=new Rc,this.targetCount=0,this.bs=Ls.ie()}return(0,v.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Is.forEach((function(e,n){return t(n)})),zu.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return zu.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return zu.resolve(this.As)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.bs.next(),zu.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),zu.resolve()}},{key:"ce",value:function(e){this.Is.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.bs=new Ls(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.ce(t),this.targetCount+=1,zu.resolve()}},{key:"updateTargetData",value:function(e,t){return this.ce(t),zu.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,zu.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Is.forEach((function(o,u){u.sequenceNumber<=t&&null===n.get(u.targetId)&&(r.Is.delete(o),a.push(r.removeMatchingKeysForTargetId(e,u.targetId)),i++)})),zu.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return zu.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Is.get(t)||null;return zu.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Rs.rs(t,n),zu.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Rs.cs(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),zu.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Rs.us(t),zu.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Rs.ls(t);return zu.resolve(n)}},{key:"containsKey",value:function(e,t){return zu.resolve(this.Rs.containsKey(t))}}]),e}(),Vc=function(){function e(t,n){var r=this;(0,d.Z)(this,e),this.Ps={},this.Be=new oi(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=t(this),this.He=new Fc(this),this.Jt=new bs,this.Je=function(e,t){return new Mc(e,(function(e){return r.referenceDelegate.vs(e)}))}(this.Jt),this.k=new us(n),this.Ye=new Nc(this.k)}return(0,v.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Ue=!1,Promise.resolve()}},{key:"started",get:function(){return this.Ue}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(){return this.Jt}},{key:"getMutationQueue",value:function(e){var t=this.Ps[e.toKey()];return t||(t=new Oc(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}},{key:"getTargetCache",value:function(){return this.He}},{key:"getRemoteDocumentCache",value:function(){return this.Je}},{key:"getBundleCache",value:function(){return this.Ye}},{key:"runTransaction",value:function(e,t,n){var r=this;Ur("MemoryPersistence","Starting transaction:",e);var i=new Uc(this.Be.next());return this.referenceDelegate.Vs(),n(i).next((function(e){return r.referenceDelegate.Ss(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ds",value:function(e,t){return zu.or(Object.values(this.Ps).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),Uc=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,v.Z)(n)}(Gu),qc=function(){function e(t){(0,d.Z)(this,e),this.persistence=t,this.Cs=new Rc,this.Ns=null}return(0,v.Z)(e,[{key:"xs",get:function(){if(this.Ns)return this.Ns;throw Kr()}},{key:"addReference",value:function(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),zu.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),zu.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.xs.add(t.toString()),zu.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Cs.us(t.targetId).forEach((function(e){return n.xs.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.xs.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"Vs",value:function(){this.Ns=new Set}},{key:"Ss",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return zu.forEach(this.xs,(function(r){var i=Li.fromPath(r);return t.$s(e,i).next((function(e){e||n.removeEntry(i)}))})).next((function(){return t.Ns=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.$s(e,t).next((function(e){e?n.xs.delete(t.toString()):n.xs.add(t.toString())}))}},{key:"vs",value:function(e){return 0}},{key:"$s",value:function(e,t){var n=this;return zu.or([function(){return zu.resolve(n.Cs.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ds(e,t)}])}}],[{key:"ks",value:function(t){return new e(t)}}]),e}();function Bc(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function jc(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Kc(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Gc=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return(0,v.Z)(e,[{key:"Fs",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Os",value:function(t,n,r){var i,a=JSON.parse(r),o="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return o&&a.error&&((o="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new Qr(a.error.code,a.error.message))),o?new e(t,n,a.state,i):(qr("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),zc=function(){function e(t,n,r){(0,d.Z)(this,e),this.targetId=t,this.state=n,this.error=r}return(0,v.Z)(e,[{key:"Fs",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Os",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Qr(i.error.code,i.error.message))),a?new e(t,i.state,r):(qr("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Hc=function(){function e(t,n){(0,d.Z)(this,e),this.clientId=t,this.activeTargetIds=n}return(0,v.Z)(e,null,[{key:"Os",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=Ro(),o=0;i&&o<r.activeTargetIds.length;++o)i=Ri(r.activeTargetIds[o]),a=a.add(r.activeTargetIds[o]);return i?new e(t,a):(qr("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),Wc=function(){function e(t,n){(0,d.Z)(this,e),this.clientId=t,this.onlineState=n}return(0,v.Z)(e,null,[{key:"Os",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(qr("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),Qc=function(){function e(){(0,d.Z)(this,e),this.activeTargetIds=Ro()}return(0,v.Z)(e,[{key:"Ms",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Ls",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Fs",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),Yc=function(){function e(t,n,r,i,a){(0,d.Z)(this,e),this.window=t,this.Fe=n,this.persistenceKey=r,this.Bs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new ko(ci),this.started=!1,this.js=[];var o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.Qs=Bc(this.persistenceKey,this.Bs),this.Ws=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new Qc),this.Gs=new RegExp("^firestore_clients_".concat(o,"_([^_]*)$")),this.zs=new RegExp("^firestore_mutations_".concat(o,"_(\\d+)(?:_(.*))?$")),this.Hs=new RegExp("^firestore_targets_".concat(o,"_(\\d+)$")),this.Js=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Ys=function(e){return"firestore_bundle_loaded_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}return(0,v.Z)(e,[{key:"start",value:function(){var e=(0,c.Z)(y().mark((function e(){var t,n,r,i,a,o,u,c,l,h,f,d=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.Tn();case 2:t=e.sent,n=(0,s.Z)(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.Bs){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Bc(this.persistenceKey,i)))&&(o=Hc.Os(i,a))&&(this.Ks=this.Ks.insert(o.clientId,o));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.Xs(),(u=this.storage.getItem(this.Js))&&(c=this.Zs(u))&&this.ti(c),l=(0,s.Z)(this.js);try{for(l.s();!(h=l.n()).done;)f=h.value,this.qs(f)}catch(v){l.e(v)}finally{l.f()}this.js=[],this.window.addEventListener("pagehide",(function(){return d.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.Ws,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.ei(this.Ks)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.Ks.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.ni(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.ni(e,t,n),this.si(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(Kc(this.persistenceKey,e));if(n){var r=zc.Os(e,n);r&&(t=r.state)}}return this.ii.Ms(e),this.Xs(),t}},{key:"removeLocalQueryTarget",value:function(e){this.ii.Ls(e),this.Xs()}},{key:"isLocalQueryTarget",value:function(e){return this.ii.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Kc(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.ri(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.si(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.oi(e)}},{key:"notifyBundleLoaded",value:function(){this.ai()}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return Ur("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){Ur("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){Ur("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"qs",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(Ur("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Qs)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fe.enqueueRetryable((0,c.Z)(y().mark((function e(){var r,i,a,o,u,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=41;break}if(null===n.key){e.next=39;break}if(!t.Gs.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.ci(n.key),e.abrupt("return",t.ui(r,null));case 6:if(!(i=t.hi(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.ui(i.clientId,i));case 9:e.next=39;break;case 11:if(!t.zs.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.li(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.fi(a));case 16:e.next=39;break;case 18:if(!t.Hs.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(o=t.di(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.wi(o));case 23:e.next=39;break;case 25:if(n.key!==t.Js){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(u=t.Zs(n.newValue))){e.next=30;break}return e.abrupt("return",t.ti(u));case 30:e.next=39;break;case 32:if(n.key!==t.Ws){e.next=37;break}s=function(e){var t=oi.I;if(null!=e)try{var n=JSON.parse(e);Gr("number"==typeof n),t=n}catch(e){qr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),s!==oi.I&&t.sequenceNumberHandler(s),e.next=39;break;case 37:if(n.key!==t.Ys){e.next=39;break}return e.abrupt("return",t.syncEngine._i());case 39:e.next=42;break;case 41:t.js.push(n);case 42:case"end":return e.stop()}}),e)}))))}}},{key:"ii",get:function(){return this.Ks.get(this.Bs)}},{key:"Xs",value:function(){this.setItem(this.Qs,this.ii.Fs())}},{key:"ni",value:function(e,t,n){var r=new Gc(this.currentUser,e,t,n),i=jc(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Fs())}},{key:"si",value:function(e){var t=jc(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"oi",value:function(e){var t={clientId:this.Bs,onlineState:e};this.storage.setItem(this.Js,JSON.stringify(t))}},{key:"ri",value:function(e,t,n){var r=Kc(this.persistenceKey,e),i=new zc(e,t,n);this.setItem(r,i.Fs())}},{key:"ai",value:function(){this.setItem(this.Ys,"value-not-used")}},{key:"ci",value:function(e){var t=this.Gs.exec(e);return t?t[1]:null}},{key:"hi",value:function(e,t){var n=this.ci(e);return Hc.Os(n,t)}},{key:"li",value:function(e,t){var n=this.zs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Gc.Os(new Or(i),r,t)}},{key:"di",value:function(e,t){var n=this.Hs.exec(e),r=Number(n[1]);return zc.Os(r,t)}},{key:"Zs",value:function(e){return Wc.Os(e)}},{key:"fi",value:function(){var e=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.mi(t.batchId,t.state,t.error));case 2:Ur("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"wi",value:function(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}},{key:"ui",value:function(e,t){var n=this,r=t?this.Ks.insert(e,t):this.Ks.remove(e),i=this.ei(this.Ks),a=this.ei(r),o=[],u=[];return a.forEach((function(e){i.has(e)||o.push(e)})),i.forEach((function(e){a.has(e)||u.push(e)})),this.syncEngine.yi(o,u).then((function(){n.Ks=r}))}},{key:"ti",value:function(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"ei",value:function(e){var t=Ro();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"Pt",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Xc=function(){function e(){(0,d.Z)(this,e),this.pi=new Qc,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,v.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.pi.Ms(e),this.Ti[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.Ti[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.pi.Ls(e)}},{key:"isLocalQueryTarget",value:function(e){return this.pi.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.Ti[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.pi.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.pi.activeTargetIds.has(e)}},{key:"start",value:function(){return this.pi=new Qc,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(){}}]),e}(),Jc=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,[{key:"Ei",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),$c=function(){function e(){var t=this;(0,d.Z)(this,e),this.Ii=function(){return t.Ai()},this.Ri=function(){return t.bi()},this.Pi=[],this.vi()}return(0,v.Z)(e,[{key:"Ei",value:function(e){this.Pi.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}},{key:"vi",value:function(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}},{key:"Ai",value:function(){Ur("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=(0,s.Z)(this.Pi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"bi",value:function(){Ur("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=(0,s.Z)(this.Pi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"Pt",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),el={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},tl=function(){function e(t){(0,d.Z)(this,e),this.Vi=t.Vi,this.Si=t.Si}return(0,v.Z)(e,[{key:"Di",value:function(e){this.Ci=e}},{key:"Ni",value:function(e){this.ki=e}},{key:"onMessage",value:function(e){this.xi=e}},{key:"close",value:function(){this.Si()}},{key:"send",value:function(e){this.Vi(e)}},{key:"$i",value:function(){this.Ci()}},{key:"Oi",value:function(e){this.ki(e)}},{key:"Fi",value:function(e){this.xi(e)}}]),e}(),nl=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return(0,v.Z)(n,[{key:"Ki",value:function(e,t,n,r){return new Promise((function(i,a){var o=new Rr;o.listenOnce(Zr.COMPLETE,(function(){try{switch(o.getLastErrorCode()){case Ar.NO_ERROR:var t=o.getResponseJson();Ur("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Ar.TIMEOUT:Ur("Connection",'RPC "'+e+'" timed out'),a(new Qr(Wr.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:var n=o.getStatus();if(Ur("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var u=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(Wr).indexOf(t)>=0?t:Wr.UNKNOWN}(r.status);a(new Qr(u,r.message))}else a(new Qr(Wr.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new Qr(Wr.UNAVAILABLE,"Connection failed."));break;default:Kr()}}finally{Ur("Connection",'RPC "'+e+'" completed.')}}));var u=JSON.stringify(r);o.send(t,"POST",u,n,15)}))}},{key:"Qi",value:function(e,t,n){var r=[this.Mi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=xr(),a=Sr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Cr({})),this.qi(o.initMessageHeaders,t,n),(0,w.uI)()||(0,w.b$)()||(0,w.d)()||(0,w.w1)()||(0,w.Mn)()||(0,w.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var u=r.join("");Ur("Connection","Creating WebChannel: "+u,o);var s=i.createWebChannel(u,o),c=!1,l=!1,h=new tl({Vi:function(e){l?Ur("Connection","Not sending because WebChannel is closed:",e):(c||(Ur("Connection","Opening WebChannel transport."),s.open(),c=!0),Ur("Connection","WebChannel sending:",e),s.send(e))},Si:function(){return s.close()}}),f=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return f(s,Nr.EventType.OPEN,(function(){l||Ur("Connection","WebChannel transport opened.")})),f(s,Nr.EventType.CLOSE,(function(){l||(l=!0,Ur("Connection","WebChannel transport closed"),h.Oi())})),f(s,Nr.EventType.ERROR,(function(e){l||(l=!0,Br("Connection","WebChannel transport errored:",e),h.Oi(new Qr(Wr.UNAVAILABLE,"The operation could not be completed")))})),f(s,Nr.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];Gr(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Ur("Connection","WebChannel received error:",i);var a=i.status,o=function(e){var t=ho[e];if(void 0!==t)return go(t)}(a),u=i.message;void 0===o&&(o=Wr.INTERNAL,u="Unknown error status: "+a+" with message "+i.message),l=!0,h.Oi(new Qr(o,u)),s.close()}else Ur("Connection","WebChannel received:",n),h.Fi(n)}})),f(a,_r.STAT_EVENT,(function(e){e.stat===Dr.PROXY?Ur("Connection","Detected buffering proxy"):e.stat===Dr.NOPROXY&&Ur("Connection","Detected no buffering proxy")})),setTimeout((function(){h.$i()}),0),h}}]),n}(function(){function e(t){(0,d.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Mi=n+"://"+t.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return(0,v.Z)(e,[{key:"Bi",value:function(e,t,n,r,i){var a=this.Ui(e,t);Ur("RestConnection","Sending: ",a,n);var o={};return this.qi(o,r,i),this.Ki(e,a,o,n).then((function(e){return Ur("RestConnection","Received: ",e),e}),(function(t){throw Br("RestConnection","".concat(e," failed with error: "),t,"url: ",a,"request:",n),t}))}},{key:"ji",value:function(e,t,n,r,i){return this.Bi(e,t,n,r,i)}},{key:"qi",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Mr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"Ui",value:function(e,t){var n=el[e];return"".concat(this.Mi,"/v1/").concat(t,":").concat(n)}}]),e}());function rl(){return"undefined"!=typeof window?window:null}function il(){return"undefined"!=typeof document?document:null}function al(e){return new Go(e,!0)}var ol=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,d.Z)(this,e),this.Fe=t,this.timerId=n,this.Wi=r,this.Gi=i,this.zi=a,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}return(0,v.Z)(e,[{key:"reset",value:function(){this.Hi=0}},{key:"Xi",value:function(){this.Hi=this.zi}},{key:"Zi",value:function(e){var t=this;this.cancel();var n=Math.floor(this.Hi+this.tr()),r=Math.max(0,Date.now()-this.Yi),i=Math.max(0,n-r);i>0&&Ur("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.Hi," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Ji=this.Fe.enqueueAfterDelay(this.timerId,i,(function(){return t.Yi=Date.now(),e()})),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}},{key:"er",value:function(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}},{key:"cancel",value:function(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}},{key:"tr",value:function(){return(Math.random()-.5)*this.Hi}}]),e}(),ul=function(){function e(t,n,r,i,a,o,u,s){(0,d.Z)(this,e),this.Fe=t,this.nr=r,this.sr=i,this.ir=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=s,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new ol(t,n)}return(0,v.Z)(e,[{key:"hr",value:function(){return 1===this.state||5===this.state||this.lr()}},{key:"lr",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.dr()}},{key:"stop",value:function(){var e=(0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.hr(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"wr",value:function(){this.state=0,this.ur.reset()}},{key:"_r",value:function(){var e=this;this.lr()&&null===this.ar&&(this.ar=this.Fe.enqueueAfterDelay(this.nr,6e4,(function(){return e.mr()})))}},{key:"gr",value:function(e){this.yr(),this.stream.send(e)}},{key:"mr",value:function(){var e=(0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.lr()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"yr",value:function(){this.ar&&(this.ar.cancel(),this.ar=null)}},{key:"pr",value:function(){this.cr&&(this.cr.cancel(),this.cr=null)}},{key:"close",value:function(){var e=(0,c.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==t?this.ur.reset():n&&n.code===Wr.RESOURCE_EXHAUSTED?(qr(n.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):n&&n.code===Wr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Ni(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"Tr",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Er(this.rr),n=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,u.Z)(t,2),i=r[0],a=r[1];e.rr===n&&e.Ir(i,a)}),(function(n){t((function(){var t=new Qr(Wr.UNKNOWN,"Fetching auth token failed: "+n.message);return e.Ar(t)}))}))}},{key:"Ir",value:function(e,t){var n=this,r=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di((function(){r((function(){return n.state=2,n.cr=n.Fe.enqueueAfterDelay(n.sr,1e4,(function(){return n.lr()&&(n.state=3),Promise.resolve()})),n.listener.Di()}))})),this.stream.Ni((function(e){r((function(){return n.Ar(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"dr",value:function(){var e=this;this.state=5,this.ur.Zi((0,c.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"Ar",value:function(e){return Ur("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Er",value:function(e){var t=this;return function(n){t.Fe.enqueueAndForget((function(){return t.rr===e?n():(Ur("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),sl=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a,o,u){var s;return(0,d.Z)(this,n),(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,u)).k=o,s}return(0,v.Z)(n,[{key:"Rr",value:function(e,t){return this.ir.Qi("Listen",e,t)}},{key:"onMessage",value:function(e){this.ur.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Kr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.C?(Gr(void 0===t||"string"==typeof t),Ii.fromBase64String(t||"")):(Gr(void 0===t||t instanceof Uint8Array),Ii.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,u=o&&function(e){var t=void 0===e.code?Wr.UNKNOWN:go(e.code);return new Qr(t,e.message||"")}(o);n=new Fo(r,i,a,u||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=$o(e,s.document.name),l=Qo(s.document.updateTime),h=new Qi({mapValue:{fields:s.document.fields}}),f=Xi.newFoundDocument(c,l,h),d=s.targetIds||[],v=s.removedTargetIds||[];n=new Mo(d,v,f.key,f)}else if("documentDelete"in t){t.documentDelete;var p=t.documentDelete;p.document;var y=$o(e,p.document),m=p.readTime?Qo(p.readTime):di.min(),g=Xi.newNoDocument(y,m),k=p.removedTargetIds||[];n=new Mo([],k,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=$o(e,w.document),E=w.removedTargetIds||[];n=new Mo([],E,b,null)}else{if(!("filter"in t))return Kr();t.filter;var I=t.filter;I.targetId;var T=I.count||0,x=new yo(T),S=I.targetId;n=new Po(S,x)}return n}(this.k,e),n=function(e){if(!("targetChange"in e))return di.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?di.min():t.readTime?Qo(t.readTime):di.min()}(e);return this.listener.br(t,n)}},{key:"Pr",value:function(e){var t={};t.database=nu(this.k),t.addTarget=function(e,t){var n,r=t.target;return(n=na(r)?{documents:cu(e,r)}:{query:lu(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Ho(e,t.resumeToken):t.snapshotVersion.compareTo(di.min())>0&&(n.readTime=zo(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Kr()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,e);n&&(t.labels=n),this.gr(t)}},{key:"vr",value:function(e){var t={};t.database=nu(this.k),t.removeTarget=e,this.gr(t)}}]),n}(ul),cl=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a,o,u){var s;return(0,d.Z)(this,n),(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,u)).k=o,s.Vr=!1,s}return(0,v.Z)(n,[{key:"Sr",get:function(){return this.Vr}},{key:"start",value:function(){this.Vr=!1,this.lastStreamToken=void 0,(0,a.Z)((0,o.Z)(n.prototype),"start",this).call(this)}},{key:"Tr",value:function(){this.Vr&&this.Dr([])}},{key:"Rr",value:function(e,t){return this.ir.Qi("Write",e,t)}},{key:"onMessage",value:function(e){if(Gr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();var t=function(e,t){return e&&e.length>0?(Gr(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Qo(e.updateTime):Qo(t);return n.isEqual(di.min())&&(n=Qo(t)),new Xa(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Qo(e.commitTime);return this.listener.Cr(n,t)}return Gr(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}},{key:"kr",value:function(){var e={};e.database=nu(this.k),this.gr(e)}},{key:"Dr",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return uu(t.k,e)}))};this.gr(n)}}]),n}(ul),ll=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a){var o;return(0,d.Z)(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.ir=i,o.k=a,o.$r=!1,o}return(0,v.Z)(n,[{key:"Or",value:function(){if(this.$r)throw new Qr(Wr.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Bi",value:function(e,t,n){var r=this;return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var a=(0,u.Z)(i,2),o=a[0],s=a[1];return r.ir.Bi(e,t,n,o,s)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===Wr.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new Qr(Wr.UNKNOWN,e.toString())}))}},{key:"ji",value:function(e,t,n){var r=this;return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var a=(0,u.Z)(i,2),o=a[0],s=a[1];return r.ir.ji(e,t,n,o,s)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===Wr.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new Qr(Wr.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.$r=!0}}]),n}(function(){return(0,v.Z)((function e(){(0,d.Z)(this,e)}))}()),hl=function(){function e(t,n){(0,d.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.Fr=0,this.Mr=null,this.Lr=!0}return(0,v.Z)(e,[{key:"Br",value:function(){var e=this;0===this.Fr&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.Mr=null,e.qr("Backend didn't respond within 10 seconds."),e.Ur("Offline"),Promise.resolve()})))}},{key:"Kr",value:function(e){"Online"===this.state?this.Ur("Unknown"):(this.Fr++,this.Fr>=1&&(this.jr(),this.qr("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.Ur("Offline")))}},{key:"set",value:function(e){this.jr(),this.Fr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}},{key:"Ur",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"qr",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.Lr?(qr(t),this.Lr=!1):Ur("OnlineStateTracker",t)}},{key:"jr",value:function(){null!==this.Mr&&(this.Mr.cancel(),this.Mr=null)}}]),e}(),fl=(0,v.Z)((function e(t,n,r,i,a){var o=this;(0,d.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=a,this.Hr.Ei((function(e){r.enqueueAndForget((0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Il(o),!e.t0){e.next=5;break}return Ur("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,c.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Hr(t)).Gr.add(4),e.next=4,pl(n);case 4:return n.Jr.set("Unknown"),n.Gr.delete(4),e.next=8,dl(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.Jr=new hl(r,i)}));function dl(e){return vl.apply(this,arguments)}function vl(){return vl=(0,c.Z)(y().mark((function e(t){var n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Il(t)){e.next=18;break}n=(0,s.Z)(t.zr),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])}))),vl.apply(this,arguments)}function pl(e){return yl.apply(this,arguments)}function yl(){return yl=(0,c.Z)(y().mark((function e(t){var n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,s.Z)(t.zr),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])}))),yl.apply(this,arguments)}function ml(e,t){var n=Hr(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),El(n)?bl(n):Yl(n).lr()&&kl(n,t))}function gl(e,t){var n=Hr(e),r=Yl(n);n.Wr.delete(t),r.lr()&&wl(n,t),0===n.Wr.size&&(r.lr()?r._r():Il(n)&&n.Jr.set("Unknown"))}function kl(e,t){e.Yr.X(t.targetId),Yl(e).Pr(t)}function wl(e,t){e.Yr.X(t),Yl(e).vr(t)}function bl(e){e.Yr=new Uo({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},Et:function(t){return e.Wr.get(t)||null}}),Yl(e).start(),e.Jr.Br()}function El(e){return Il(e)&&!Yl(e).hr()&&e.Wr.size>0}function Il(e){return 0===Hr(e).Gr.size}function Tl(e){e.Yr=void 0}function xl(e){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.Wr.forEach((function(e,n){kl(t,e)}));case 1:case"end":return e.stop()}}),e)}))),Sl.apply(this,arguments)}function Al(e,t){return Zl.apply(this,arguments)}function Zl(){return Zl=(0,c.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Tl(t),El(t)?(t.Jr.Kr(n),bl(t)):t.Jr.set("Unknown");case 1:case"end":return e.stop()}}),e)}))),Zl.apply(this,arguments)}function _l(e,t,n){return Dl.apply(this,arguments)}function Dl(){return Dl=(0,c.Z)(y().mark((function e(t,n,r){var i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.Jr.set("Online"),!(n instanceof Fo&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=(0,s.Z)(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(o=a.value,e.t0=t.Wr.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.Wr.delete(o),t.Yr.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),Ur("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Cl(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof Mo?t.Yr.ot(n):n instanceof Po?t.Yr.dt(n):t.Yr.ut(n),r.isEqual(di.min())){e.next=29;break}return e.prev=14,e.next=17,yc(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Yr.gt(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.Wr.get(t);if(n){e.Wr.set(t,n.withResumeToken(Ii.EMPTY_BYTE_STRING,n.snapshotVersion)),wl(e,t);var r=new os(n.target,t,1,n.sequenceNumber);kl(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),Ur("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Cl(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),Dl.apply(this,arguments)}function Cl(e,t,n){return Nl.apply(this,arguments)}function Nl(){return Nl=(0,c.Z)(y().mark((function e(t,n,r){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xu(n)){e.next=2;break}throw n;case 2:return t.Gr.add(1),e.next=5,pl(t);case 5:t.Jr.set("Offline"),r||(r=function(){return yc(t.localStore)}),t.asyncQueue.enqueueRetryable((0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ur("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.Gr.delete(1),e.next=6,dl(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)}))),Nl.apply(this,arguments)}function Rl(e,t){return t().catch((function(n){return Cl(e,n,t)}))}function Ll(e){return Ol.apply(this,arguments)}function Ol(){return Ol=(0,c.Z)(y().mark((function e(t){var n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Hr(t),r=Xl(n),i=n.Qr.length>0?n.Qr[n.Qr.length-1].batchId:-1;case 2:if(!Ml(n)){e.next=19;break}return e.prev=3,e.next=6,kc(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.Qr.length&&r._r(),e.abrupt("break",19);case 10:i=a.batchId,Pl(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Cl(n,e.t0);case 17:e.next=2;break;case 19:Fl(n)&&Vl(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])}))),Ol.apply(this,arguments)}function Ml(e){return Il(e)&&e.Qr.length<10}function Pl(e,t){e.Qr.push(t);var n=Xl(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function Fl(e){return Il(e)&&!Xl(e).hr()&&e.Qr.length>0}function Vl(e){Xl(e).start()}function Ul(e){return ql.apply(this,arguments)}function ql(){return ql=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Xl(t).kr();case 1:case"end":return e.stop()}}),e)}))),ql.apply(this,arguments)}function Bl(e){return jl.apply(this,arguments)}function jl(){return jl=(0,c.Z)(y().mark((function e(t){var n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Xl(t),r=(0,s.Z)(t.Qr);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Dr(a.mutations)}catch(o){r.e(o)}finally{r.f()}case 3:case"end":return e.stop()}}),e)}))),jl.apply(this,arguments)}function Kl(e,t,n){return Gl.apply(this,arguments)}function Gl(){return Gl=(0,c.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.Qr.shift(),a=as.from(i,n,r),e.next=3,Rl(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Ll(t);case 5:case"end":return e.stop()}}),e)}))),Gl.apply(this,arguments)}function zl(e,t){return Hl.apply(this,arguments)}function Hl(){return Hl=(0,c.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Xl(t).Sr,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,c.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!mo(i=n.code)||i===Wr.ABORTED){e.next=7;break}return r=t.Qr.shift(),Xl(t).wr(),e.next=5,Rl(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Ll(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Fl(t)&&Vl(t);case 5:case"end":return e.stop()}}),e)}))),Hl.apply(this,arguments)}function Wl(e,t){return Ql.apply(this,arguments)}function Ql(){return Ql=(0,c.Z)(y().mark((function e(t,n){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Hr(t),!n){e.next=7;break}return r.Gr.delete(2),e.next=5,dl(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.Gr.add(2),e.next=12,pl(r);case 12:r.Jr.set("Unknown");case 13:case"end":return e.stop()}}),e)}))),Ql.apply(this,arguments)}function Yl(e){return e.Xr||(e.Xr=function(e,t,n){var r=Hr(e);return r.Or(),new sl(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:xl.bind(null,e),Ni:Al.bind(null,e),br:_l.bind(null,e)}),e.zr.push(function(){var t=(0,c.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.Xr.wr(),El(e)?bl(e):e.Jr.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.Xr.stop();case 6:Tl(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Xr}function Xl(e){return e.Zr||(e.Zr=function(e,t,n){var r=Hr(e);return r.Or(),new cl(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:Ul.bind(null,e),Ni:zl.bind(null,e),Nr:Bl.bind(null,e),Cr:Kl.bind(null,e)}),e.zr.push(function(){var t=(0,c.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Zr.wr(),t.next=4,Ll(e);case 4:t.next=9;break;case 6:return t.next=8,e.Zr.stop();case 8:e.Qr.length>0&&(Ur("RemoteStore","Stopping write stream with ".concat(e.Qr.length," pending writes")),e.Qr=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Zr}var Jl=function(){function e(t,n,r,i,a){(0,d.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Yr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,v.Z)(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Qr(Wr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function $l(e,t){if(qr("AsyncQueue","".concat(t,": ").concat(e)),Xu(e))return new Qr(Wr.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var eh=function(){function e(t){(0,d.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||Li.comparator(e.key,n.key)}:function(e,t){return Li.comparator(e.key,t.key)},this.keyedMap=Ao(),this.sortedSet=new ko(this.comparator)}return(0,v.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),th=function(){function e(){(0,d.Z)(this,e),this.eo=new ko(Li.comparator)}return(0,v.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):Kr():this.eo=this.eo.insert(t,e)}},{key:"no",value:function(){var e=[];return this.eo.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),nh=function(){function e(t,n,r,i,a,o,u,s){(0,d.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=s}return(0,v.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_a(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach((function(e){a.push({type:0,doc:e})})),new e(t,n,eh.emptySet(n),a,r,i,!0,!1)}}]),e}(),rh=(0,v.Z)((function e(){(0,d.Z)(this,e),this.so=void 0,this.listeners=[]})),ih=(0,v.Z)((function e(){(0,d.Z)(this,e),this.queries=new Hs((function(e){return Da(e)}),_a),this.onlineState="Unknown",this.io=new Set}));function ah(e,t){return oh.apply(this,arguments)}function oh(){return oh=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Hr(t),i=n.query,a=!1,(o=r.queries.get(i))||(a=!0,o=new rh),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:o.so=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),u=$l(e.t0,"Initialization of query '".concat(Ca(n.query),"' failed")),e.abrupt("return",void n.onError(u));case 13:r.queries.set(i,o),o.listeners.push(n),n.ro(r.onlineState),o.so&&n.oo(o.so)&&hh(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),oh.apply(this,arguments)}function uh(e,t){return sh.apply(this,arguments)}function sh(){return sh=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Hr(t),i=n.query,a=!1,(o=r.queries.get(i))&&(u=o.listeners.indexOf(n))>=0&&(o.listeners.splice(u,1),a=0===o.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)}))),sh.apply(this,arguments)}function ch(e,t){var n,r=Hr(e),i=!1,a=(0,s.Z)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,u=o.query,c=r.queries.get(u);if(c){var l,h=(0,s.Z)(c.listeners);try{for(h.s();!(l=h.n()).done;){l.value.oo(o)&&(i=!0)}}catch(f){h.e(f)}finally{h.f()}c.so=o}}}catch(f){a.e(f)}finally{a.f()}i&&hh(r)}function lh(e,t,n){var r=Hr(e),i=r.queries.get(t);if(i){var a,o=(0,s.Z)(i.listeners);try{for(o.s();!(a=o.n()).done;){a.value.onError(n)}}catch(u){o.e(u)}finally{o.f()}}r.queries.delete(t)}function hh(e){e.io.forEach((function(e){e.next()}))}var fh=function(){function e(t,n,r){(0,d.Z)(this,e),this.query=t,this.ao=n,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=r||{}}return(0,v.Z)(e,[{key:"oo",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=(0,s.Z)(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(o){r.e(o)}finally{r.f()}e=new nh(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.co?this.ho(e)&&(this.ao.next(e),a=!0):this.lo(e,this.onlineState)&&(this.fo(e),a=!0),this.uo=e,a}},{key:"onError",value:function(e){this.ao.error(e)}},{key:"ro",value:function(e){this.onlineState=e;var t=!1;return this.uo&&!this.co&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}},{key:"lo",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.wo||!n)&&(!e.docs.isEmpty()||"Offline"===t)}},{key:"ho",value:function(e){if(e.docChanges.length>0)return!0;var t=this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"fo",value:function(e){e=nh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.ao.next(e)}}]),e}(),dh=function(){function e(t,n){(0,d.Z)(this,e),this.payload=t,this.byteLength=n}return(0,v.Z)(e,[{key:"_o",value:function(){return"metadata"in this.payload}}]),e}(),vh=function(){function e(t){(0,d.Z)(this,e),this.k=t}return(0,v.Z)(e,[{key:"Hn",value:function(e){return $o(this.k,e)}},{key:"Jn",value:function(e){return e.metadata.exists?au(this.k,e.document,!1):Xi.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}},{key:"Yn",value:function(e){return Qo(e)}}]),e}(),ph=function(){function e(t,n,r){(0,d.Z)(this,e),this.mo=t,this.localStore=n,this.k=r,this.queries=[],this.documents=[],this.progress=yh(t)}return(0,v.Z)(e,[{key:"yo",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"po",value:function(e){var t,n=new Map,r=new vh(this.k),i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var o,u=r.Hn(a.metadata.name),c=(0,s.Z)(a.metadata.queries);try{for(c.s();!(o=c.n()).done;){var l=o.value,h=(n.get(l)||Co()).add(u);n.set(l,h)}}catch(f){c.e(f)}finally{c.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:function(){var e=(0,c.Z)(y().mark((function e(){var t,n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zc(this.localStore,new vh(this.k),this.documents,this.mo.id);case 2:t=e.sent,n=this.po(this.documents),r=(0,s.Z)(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Dc(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",new uc(Object.assign({},this.progress),t)));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function yh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var mh=(0,v.Z)((function e(t){(0,d.Z)(this,e),this.key=t})),gh=(0,v.Z)((function e(t){(0,d.Z)(this,e),this.key=t})),kh=function(){function e(t,n){(0,d.Z)(this,e),this.query=t,this.To=n,this.Eo=null,this.current=!1,this.Io=Co(),this.mutatedKeys=Co(),this.Ao=Ra(t),this.Ro=new eh(this.Ao)}return(0,v.Z)(e,[{key:"bo",get:function(){return this.To}},{key:"Po",value:function(e,t){var n=this,r=t?t.vo:new th,i=t?t.Ro:this.Ro,a=t?t.mutatedKeys:this.mutatedKeys,o=i,u=!1,s=ba(this.query)&&i.size===this.query.limit?i.last():null,c=Ea(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),h=Na(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),v=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),v=!0):n.Vo(l,h)||(r.track({type:2,doc:h}),v=!0,(s&&n.Ao(h,s)>0||c&&n.Ao(h,c)<0)&&(u=!0)):!l&&h?(r.track({type:0,doc:h}),v=!0):l&&!h&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(u=!0)),v&&(h?(o=o.add(h),a=d?a.add(e):a.delete(e)):(o=o.delete(e),a=a.delete(e)))})),ba(this.query)||Ea(this.query))for(;o.size>this.query.limit;){var l=ba(this.query)?o.last():o.first();o=o.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Ro:o,vo:r,Bn:u,mutatedKeys:a}}},{key:"Vo",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;var a=e.vo.no();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr()}};return n(e)-n(t)}(e.type,t.type)||r.Ao(e.doc,t.doc)})),this.So(n);var o=t?this.Do():[],u=0===this.Io.size&&this.current?1:0,s=u!==this.Eo;return this.Eo=u,0!==a.length||s?{snapshot:new nh(this.query,e.Ro,i,a,e.mutatedKeys,0===u,s,!1),Co:o}:{Co:o}}},{key:"ro",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new th,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}},{key:"No",value:function(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}},{key:"So",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.To=t.To.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.To=t.To.delete(e)})),this.current=e.current)}},{key:"Do",value:function(){var e=this;if(!this.current)return[];var t=this.Io;this.Io=Co(),this.Ro.forEach((function(t){e.No(t.key)&&(e.Io=e.Io.add(t.key))}));var n=[];return t.forEach((function(t){e.Io.has(t)||n.push(new gh(t))})),this.Io.forEach((function(e){t.has(e)||n.push(new mh(e))})),n}},{key:"ko",value:function(e){this.To=e.zn,this.Io=Co();var t=this.Po(e.documents);return this.applyChanges(t,!0)}},{key:"xo",value:function(){return nh.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}]),e}(),wh=(0,v.Z)((function e(t,n,r){(0,d.Z)(this,e),this.query=t,this.targetId=n,this.view=r})),bh=(0,v.Z)((function e(t){(0,d.Z)(this,e),this.key=t,this.$o=!1})),Eh=function(){function e(t,n,r,i,a,o){(0,d.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Oo={},this.Fo=new Hs((function(e){return Da(e)}),_a),this.Mo=new Map,this.Lo=new Set,this.Bo=new ko(Li.comparator),this.Uo=new Map,this.qo=new Rc,this.Ko={},this.jo=new Map,this.Qo=Ls.re(),this.onlineState="Unknown",this.Wo=void 0}return(0,v.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.Wo}}]),e}();function Ih(e,t){return Th.apply(this,arguments)}function Th(){return Th=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o,u,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=mf(t),!(o=r.Fo.get(n))){e.next=6;break}i=o.targetId,r.sharedClientState.addLocalQueryTarget(i),a=o.view.xo(),e.next=15;break;case 6:return e.next=8,wc(r.localStore,Aa(n));case 8:return u=e.sent,s=r.sharedClientState.addLocalQueryTarget(u.targetId),i=u.targetId,e.next=13,xh(r,n,i,"current"===s);case 13:a=e.sent,r.isPrimaryClient&&ml(r.remoteStore,u);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)}))),Th.apply(this,arguments)}function xh(e,t,n,r){return Sh.apply(this,arguments)}function Sh(){return Sh=(0,c.Z)(y().mark((function e(t,n,r,i){var a,o,u,s,l,h;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Go=function(e,n,r){return function(){var e=(0,c.Z)(y().mark((function e(t,n,r,i){var a,o,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Po(r),e.t0=a.Bn,!e.t0){e.next=6;break}return e.next=5,Ic(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.Po(t,a)}));case 5:a=e.sent;case 6:return o=i&&i.targetChanges.get(n.targetId),u=n.view.applyChanges(a,t.isPrimaryClient,o),e.abrupt("return",(zh(t,n.targetId,u.Co),u.snapshot));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,e,n,r)},e.next=3,Ic(t.localStore,n,!0);case 3:return a=e.sent,o=new kh(n,a.zn),u=o.Po(a.documents),s=Oo.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),l=o.applyChanges(u,t.isPrimaryClient,s),zh(t,r,l.Co),h=new wh(n,r,o),e.abrupt("return",(t.Fo.set(n,h),t.Mo.has(r)?t.Mo.get(r).push(n):t.Mo.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}}),e)}))),Sh.apply(this,arguments)}function Ah(e,t){return Zh.apply(this,arguments)}function Zh(){return Zh=(0,c.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Hr(t),i=r.Fo.get(n),!((a=r.Mo.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.Mo.set(i.targetId,a.filter((function(e){return!_a(e,n)}))),void r.Fo.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,bc(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),gl(r.remoteStore,i.targetId),Kh(r,i.targetId)})).catch(Vs);case 9:e.next=14;break;case 11:return Kh(r,i.targetId),e.next=14,bc(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)}))),Zh.apply(this,arguments)}function _h(e,t,n){return Dh.apply(this,arguments)}function Dh(){return Dh=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=gf(t),e.prev=1,e.next=4,function(e,t){var n,r=Hr(e),i=fi.now(),a=t.reduce((function(e,t){return e.add(t.key)}),Co());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(e){return r.Wn.vn(e,a).next((function(a){n=a;var o,u=[],c=(0,s.Z)(t);try{for(c.s();!(o=c.n()).done;){var l=o.value,h=ro(l,n.get(l.key));null!=h&&u.push(new uo(l.key,h,Yi(h.value.mapValue),Ja.exists(!0)))}}catch(f){c.e(f)}finally{c.f()}return r.An.addMutationBatch(e,i,u,t)}))})).then((function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Ko[e.currentUser.toKey()];r||(r=new ko(ci)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,Qh(i,a.changes);case 9:return e.next=11,Ll(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=$l(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Dh.apply(this,arguments)}function Ch(e,t){return Nh.apply(this,arguments)}function Nh(){return Nh=(0,c.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t),e.prev=1,e.next=4,mc(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Uo.get(t);n&&(Gr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.$o=!0:e.modifiedDocuments.size>0?Gr(n.$o):e.removedDocuments.size>0&&(Gr(n.$o),n.$o=!1))})),e.next=8,Qh(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Vs(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),Nh.apply(this,arguments)}function Rh(e,t,n){var r=Hr(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Fo.forEach((function(e,n){var r=n.view.ro(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=Hr(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=(0,s.Z)(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.ro(t)&&(r=!0)}}catch(o){a.e(o)}finally{a.f()}})),r&&hh(n)}(r.eventManager,t),i.length&&r.Oo.br(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Lh(e,t,n){return Oh.apply(this,arguments)}function Oh(){return Oh=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o,u,s,c;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=Hr(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Uo.get(n),!(o=a&&a.key)){e.next=14;break}return u=(u=new ko(Li.comparator)).insert(o,Xi.newNoDocument(o,di.min())),s=Co().add(o),c=new Lo(di.min(),new Map,new Eo(ci),u,s),e.next=9,Ch(i,c);case 9:i.Bo=i.Bo.remove(o),i.Uo.delete(n),Wh(i),e.next=16;break;case 14:return e.next=16,bc(i.localStore,n,!1).then((function(){return Kh(i,n,r)})).catch(Vs);case 16:case"end":return e.stop()}}),e)}))),Oh.apply(this,arguments)}function Mh(e,t){return Ph.apply(this,arguments)}function Ph(){return Ph=(0,c.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t),i=n.batch.batchId,e.prev=1,e.next=4,pc(r.localStore,n);case 4:return a=e.sent,jh(r,i,null),Bh(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,Qh(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Vs(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Ph.apply(this,arguments)}function Fh(e,t,n){return Vh.apply(this,arguments)}function Vh(){return Vh=(0,c.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Hr(t),e.prev=1,e.next=4,function(e,t){var n=Hr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.An.lookupMutationBatch(e,t).next((function(t){return Gr(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t)})).next((function(){return n.An.performConsistencyCheck(e)})).next((function(){return n.Wn.vn(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,jh(i,n,r),Bh(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,Qh(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Vs(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Vh.apply(this,arguments)}function Uh(e,t){return qh.apply(this,arguments)}function qh(){return qh=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Il((r=Hr(t)).remoteStore)||Ur("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=Hr(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.An.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.jo.get(i)||[]).push(n),r.jo.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),o=$l(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(o);case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),qh.apply(this,arguments)}function Bh(e,t){(e.jo.get(t)||[]).forEach((function(e){e.resolve()})),e.jo.delete(t)}function jh(e,t,n){var r=Hr(e),i=r.Ko[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function Kh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=(0,s.Z)(e.Mo.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.Fo.delete(a),n&&e.Oo.zo(a,n)}}catch(o){i.e(o)}finally{i.f()}e.Mo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach((function(t){e.qo.containsKey(t)||Gh(e,t)}))}function Gh(e,t){e.Lo.delete(t.path.canonicalString());var n=e.Bo.get(t);null!==n&&(gl(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Wh(e))}function zh(e,t,n){var r,i=(0,s.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof mh?(e.qo.addReference(a.key,t),Hh(e,a)):a instanceof gh?(Ur("SyncEngine","Document no longer in limbo: "+a.key),e.qo.removeReference(a.key,t),e.qo.containsKey(a.key)||Gh(e,a.key)):Kr()}}catch(o){i.e(o)}finally{i.f()}}function Hh(e,t){var n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(Ur("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Wh(e))}function Wh(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){var t=e.Lo.values().next().value;e.Lo.delete(t);var n=new Li(gi.fromString(t)),r=e.Qo.next();e.Uo.set(r,new bh(n)),e.Bo=e.Bo.insert(n,r),ml(e.remoteStore,new os(Aa(wa(n.path)),r,2,oi.I))}}function Qh(e,t,n){return Yh.apply(this,arguments)}function Yh(){return Yh=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Hr(t),a=[],o=[],u=[],e.t0=i.Fo.isEmpty(),e.t0){e.next=9;break}return i.Fo.forEach((function(e,t){u.push(i.Go(t,n,r).then((function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=cc.$n(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(u);case 6:return i.Oo.br(a),e.next=9,function(){var e=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o,u,c,l,h;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return zu.forEach(n,(function(t){return zu.forEach(t.kn,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return zu.forEach(t.xn,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Xu(e.t0)){e.next=10;break}throw e.t0;case 10:Ur("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=(0,s.Z)(n);try{for(i.s();!(a=i.n()).done;)o=a.value,u=o.targetId,o.fromCache||(c=r.qn.get(u),l=c.snapshotVersion,h=c.withLastLimboFreeSnapshotVersion(l),r.qn=r.qn.insert(u,h))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),Yh.apply(this,arguments)}function Xh(e,t){return Jh.apply(this,arguments)}function Jh(){return Jh=(0,c.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Hr(t)).currentUser.isEqual(n)){e.next=11;break}return Ur("SyncEngine","User change. New user:",n.toKey()),e.next=5,dc(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.jo.forEach((function(e){e.forEach((function(e){e.reject(new Qr(Wr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.jo.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,Qh(r,i.Gn);case 11:case"end":return e.stop()}}),e)}))),Jh.apply(this,arguments)}function $h(e,t){var n=Hr(e),r=n.Uo.get(t);if(r&&r.$o)return Co().add(r.key);var i=Co(),a=n.Mo.get(t);if(!a)return i;var o,u=(0,s.Z)(a);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=n.Fo.get(c);i=i.unionWith(l.view.bo)}}catch(h){u.e(h)}finally{u.f()}return i}function ef(e,t){return tf.apply(this,arguments)}function tf(){return tf=(0,c.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t),e.next=3,Ic(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.ko(i),e.abrupt("return",(r.isPrimaryClient&&zh(r,n.targetId,a.Co),a));case 6:case"end":return e.stop()}}),e)}))),tf.apply(this,arguments)}function nf(e){return rf.apply(this,arguments)}function rf(){return rf=(0,c.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Hr(t),e.abrupt("return",xc(n.localStore).then((function(e){return Qh(n,e)})));case 2:case"end":return e.stop()}}),e)}))),rf.apply(this,arguments)}function af(e,t,n,r){return of.apply(this,arguments)}function of(){return of=(0,c.Z)(y().mark((function e(t,n,r,i){var a,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Hr(t),e.next=3,function(e,t){var n=Hr(e),r=Hr(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Zt(e,t).next((function(t){return t?n.Wn.vn(e,t):zu.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(o=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Ll(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(jh(a,n,i||null),Bh(a,n),function(e,t){Hr(Hr(e).An).ee(t)}(a.localStore,n)):Kr();case 11:return e.next=13,Qh(a,o);case 13:e.next=16;break;case 15:Ur("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)}))),of.apply(this,arguments)}function uf(e,t){return sf.apply(this,arguments)}function sf(){return sf=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o,u,c,l,h;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mf(r=Hr(t)),gf(r),!0!==n||!0===r.Wo){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,cf(r,i.toArray());case 5:return a=e.sent,r.Wo=!0,e.next=9,Wl(r.remoteStore,!0);case 9:o=(0,s.Z)(a);try{for(o.s();!(u=o.n()).done;)c=u.value,ml(r.remoteStore,c)}catch(f){o.e(f)}finally{o.f()}e.next=25;break;case 13:if(!1!==n||!1===r.Wo){e.next=25;break}return l=[],h=Promise.resolve(),r.Mo.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?l.push(t):h=h.then((function(){return Kh(r,t),bc(r.localStore,t,!0)})),gl(r.remoteStore,t)})),e.next=19,h;case 19:return e.next=21,cf(r,l);case 21:return function(e){var t=Hr(e);t.Uo.forEach((function(e,n){gl(t.remoteStore,n)})),t.qo.hs(),t.Uo=new Map,t.Bo=new ko(Li.comparator)}(r),r.Wo=!1,e.next=25,Wl(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)}))),sf.apply(this,arguments)}function cf(e,t,n){return lf.apply(this,arguments)}function lf(){return lf=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o,u,c,l,h,f,d,v,p,m,g,k;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Hr(t),a=[],o=[],u=(0,s.Z)(n),e.prev=2,u.s();case 4:if((c=u.n()).done){e.next=45;break}if(l=c.value,h=void 0,!(f=i.Mo.get(l))||0===f.length){e.next=34;break}return e.next=11,wc(i.localStore,Aa(f[0]));case 11:h=e.sent,d=(0,s.Z)(f),e.prev=13,d.s();case 15:if((v=d.n()).done){e.next=24;break}return p=v.value,m=i.Fo.get(p),e.next=20,ef(i,m);case 20:(g=e.sent).snapshot&&o.push(g.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),d.e(e.t0);case 29:return e.prev=29,d.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,Tc(i.localStore,l);case 36:return k=e.sent,e.next=39,wc(i.localStore,k);case 39:return h=e.sent,e.next=42,xh(i,hf(k),l,!1);case 42:a.push(h);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),u.e(e.t1);case 50:return e.prev=50,u.f(),e.finish(50);case 53:return e.abrupt("return",(i.Oo.br(o),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])}))),lf.apply(this,arguments)}function hf(e){return ka(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function ff(e){var t=Hr(e);return Hr(Hr(t.localStore).persistence).Tn()}function df(e,t,n,r){return vf.apply(this,arguments)}function vf(){return vf=(0,c.Z)(y().mark((function e(t,n,r,i){var a,o,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=Hr(t)).Wo){e.next=5;break}Ur("SyncEngine","Ignoring unexpected query state notification."),e.next=21;break;case 5:if(!a.Mo.has(n)){e.next=21;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?9:"rejected"===e.t0?16:20;break;case 9:return e.next=11,xc(a.localStore);case 11:return o=e.sent,u=Lo.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=15,Qh(a,o,u);case 15:return e.abrupt("break",21);case 16:return e.next=18,bc(a.localStore,n,!0);case 18:return Kh(a,n,i),e.abrupt("break",21);case 20:Kr();case 21:case"end":return e.stop()}}),e)}))),vf.apply(this,arguments)}function pf(e,t,n){return yf.apply(this,arguments)}function yf(){return yf=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o,u,c,l,h,f,d;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=mf(t)).Wo){e.next=45;break}a=(0,s.Z)(n),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=21;break}if(u=o.value,!i.Mo.has(u)){e.next=10;break}return Ur("SyncEngine","Adding an already active target "+u),e.abrupt("continue",19);case 10:return e.next=12,Tc(i.localStore,u);case 12:return c=e.sent,e.next=15,wc(i.localStore,c);case 15:return l=e.sent,e.next=18,xh(i,hf(c),l.targetId,!1);case 18:ml(i.remoteStore,l);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:h=(0,s.Z)(r),e.prev=30,d=y().mark((function e(){var t;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.Mo.has(t),!e.t0){e.next=5;break}return e.next=5,bc(i.localStore,t,!1).then((function(){gl(i.remoteStore,t),Kh(i,t)})).catch(Vs);case 5:case"end":return e.stop()}}),e)})),h.s();case 33:if((f=h.n()).done){e.next=37;break}return e.delegateYield(d(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),h.e(e.t2);case 42:return e.prev=42,h.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])}))),yf.apply(this,arguments)}function mf(e){var t=Hr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ch.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=$h.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Lh.bind(null,t),t.Oo.br=ch.bind(null,t.eventManager),t.Oo.zo=lh.bind(null,t.eventManager),t}function gf(e){var t=Hr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Mh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Fh.bind(null,t),t}function kf(e,t,n){var r=Hr(e);(function(){var e=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o,u,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=Hr(e),r=Qo(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Ye.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=10;break}return e.next=9,n.close();case 9:return e.abrupt("return",void r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)));case 10:return r._updateProgress(yh(i)),a=new ph(i,t.localStore,n.k),e.next=14,n.Ho();case 14:o=e.sent;case 15:if(!o){e.next=25;break}return e.next=18,a.yo(o);case 18:return(u=e.sent)&&r._updateProgress(u),e.next=22,n.Ho();case 22:o=e.sent;case 23:e.next=15;break;case 25:return e.next=27,a.complete();case 27:return s=e.sent,e.next=30,Qh(t,s.In,void 0);case 30:return e.next=32,function(e,t){var n=Hr(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Ye.saveBundleMetadata(e,t)}))}(t.localStore,i);case 32:r._completeWith(s.progress),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(0),Br("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n,r){return e.apply(this,arguments)}})()(r,t,n).then((function(){r.sharedClientState.notifyBundleLoaded()}))}var wf=function(){function e(){(0,d.Z)(this,e),this.synchronizeTabs=!1}return(0,v.Z)(e,[{key:"initialize",value:function(){var e=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.k=al(t.databaseInfo.databaseId),this.sharedClientState=this.Jo(t),this.persistence=this.Yo(t),e.next=5,this.persistence.start();case 5:this.gcScheduler=this.Xo(t),this.localStore=this.Zo(t);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Xo",value:function(e){return null}},{key:"Zo",value:function(e){return fc(this.persistence,new lc,e.initialUser,this.k)}},{key:"Yo",value:function(e){return new Vc(qc.ks,this.k)}},{key:"Jo",value:function(e){return new Xc}},{key:"terminate",value:function(){var e=(0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),bf=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this)).ta=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.synchronizeTabs=!1,a}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=(0,c.Z)(y().mark((function e(t){var r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.Z)((0,o.Z)(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,Sc(this.localStore);case 4:return e.next=6,this.ta.initialize(this,t);case 6:return e.next=8,gf(this.ta.syncEngine);case 8:return e.next=10,Ll(this.ta.remoteStore);case 10:return e.next=12,this.persistence.sn((function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()}));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Zo",value:function(e){return fc(this.persistence,new lc,e.initialUser,this.k)}},{key:"Xo",value:function(e){var t=this.persistence.referenceDelegate.garbageCollector;return new js(t,e.asyncQueue)}},{key:"Yo",value:function(e){var t=oc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ss.withCacheSize(this.cacheSizeBytes):Ss.DEFAULT;return new rc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,rl(),il(),this.k,this.sharedClientState,!!this.forceOwnership)}},{key:"Jo",value:function(e){return new Xc}}]),n}(wf),Ef=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e,r,!1)).ta=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=(0,c.Z)(y().mark((function e(t){var r,i=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.Z)((0,o.Z)(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.ta.syncEngine,e.t0=this.sharedClientState instanceof Yc,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={mi:af.bind(null,r),gi:df.bind(null,r),yi:pf.bind(null,r),Tn:ff.bind(null,r),_i:nf.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.sn(function(){var e=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,uf(i.ta.syncEngine,t);case 2:i.gcScheduler&&(t&&!i.gcScheduler.started?i.gcScheduler.start(i.localStore):t||i.gcScheduler.stop());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Jo",value:function(e){var t=rl();if(!Yc.Pt(t))throw new Qr(Wr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=oc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Yc(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(bf),If=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,[{key:"initialize",value:function(){var e=(0,c.Z)(y().mark((function e(t,n){var r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Rh(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Xh.bind(null,this.syncEngine),e.next=12,Wl(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new ih}},{key:"createDatastore",value:function(e){var t,n=al(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new nl(t));return function(e,t,n,r){return new ll(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,o=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return Rh(o.syncEngine,e,0)},a=$c.Pt()?new $c:new Jc,new fl(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,o){var u=new Eh(e,t,n,r,i,a);return o&&(u.Wo=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return function(){var e=(0,c.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Hr(t),Ur("RemoteStore","RemoteStore shutting down."),n.Gr.add(5),e.next=5,pl(n);case 5:n.Hr.shutdown(),n.Jr.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore)}}]),e}();function Tf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return(0,c.Z)(y().mark((function r(){var i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return(0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var xf=function(){function e(t){(0,d.Z)(this,e),this.observer=t,this.muted=!1}return(0,v.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.ea(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"na",value:function(){this.muted=!0}},{key:"ea",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),Sf=function(){function e(t,n){var r=this;(0,d.Z)(this,e),this.sa=t,this.k=n,this.metadata=new Yr,this.buffer=new Uint8Array,this.ia=new TextDecoder("utf-8"),this.ra().then((function(e){e&&e._o()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))}),(function(e){return r.metadata.reject(e)}))}return(0,v.Z)(e,[{key:"close",value:function(){return this.sa.cancel()}},{key:"getMetadata",value:function(){var e=(0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Ho",value:function(){var e=(0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.ra());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ra",value:function(){var e=(0,c.Z)(y().mark((function e(){var t,n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.oa();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.ia.decode(t),r=Number(n),isNaN(r)&&this.aa("length string (".concat(n,") is not valid number")),e.next=9,this.ca(r);case 9:return i=e.sent,e.abrupt("return",new dh(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ua",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"oa",value:function(){var e=(0,c.Z)(y().mark((function e(){var t,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.ua()<0)){e.next=7;break}return e.next=3,this.ha();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.ua())<0&&this.aa("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ca",value:function(){var e=(0,c.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.ha();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.aa("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.ia.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"aa",value:function(e){throw this.sa.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"ha",value:function(){var e=(0,c.Z)(y().mark((function e(){var t,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sa.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Af=function(){function e(t){(0,d.Z)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return(0,v.Z)(e,[{key:"lookup",value:function(){var e=(0,c.Z)(y().mark((function e(t){var n,r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new Qr(Wr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=(0,c.Z)(y().mark((function e(t,n){var r,i,a,o,u,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t),i=nu(r.k)+"/documents",a={documents:n.map((function(e){return Jo(r.k,e)}))},e.next=5,r.ji("BatchGetDocuments",i,a);case 5:return o=e.sent,u=new Map,o.forEach((function(e){var t=ou(r.k,e);u.set(t.key.toString(),t)})),s=[],e.abrupt("return",(n.forEach((function(e){var t=u.get(e.toString());Gr(!!t),s.push(t)})),s));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new vo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=(0,c.Z)(y().mark((function e(){var t,n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=Li.fromPath(t);n.mutations.push(new po(r,n.precondition(r)))})),e.next=7,function(){var e=(0,c.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t),i=nu(r.k)+"/documents",a={writes:n.map((function(e){return uu(r.k,e)}))},e.next=3,r.Bi("Commit",i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Kr();t=di.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Qr(Wr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Ja.updateTime(t):Ja.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(di.min()))throw new Qr(Wr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ja.updateTime(t)}return Ja.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),Zf=function(){function e(t,n,r,i){(0,d.Z)(this,e),this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.la=5,this.ur=new ol(this.asyncQueue,"transaction_retry")}return(0,v.Z)(e,[{key:"run",value:function(){this.la-=1,this.fa()}},{key:"fa",value:function(){var e=this;this.ur.Zi((0,c.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new Af(e.datastore),(r=e.da(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.wa(t)}))}))})).catch((function(t){e.wa(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"da",value:function(e){try{var t=this.updateFunction(e);return!Ci(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"wa",value:function(e){var t=this;this.la>0&&this._a(e)?(this.la-=1,this.asyncQueue.enqueueAndForget((function(){return t.fa(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"_a",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!mo(t)}return!1}}]),e}(),_f=function(){function e(t,n,r,i){var a=this;(0,d.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Or.UNAUTHENTICATED,this.clientId=si.A(),this.authCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ur("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(){return Promise.resolve()}))}return(0,v.Z)(e,[{key:"getConfiguration",value:function(){var e=(0,c.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new Qr(Wr.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new Yr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,c.Z)(y().mark((function n(){var r;return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=$l(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function Df(e,t){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,c.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),Ur("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,dc(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),Cf.apply(this,arguments)}function Nf(e,t){return Rf.apply(this,arguments)}function Rf(){return Rf=(0,c.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Lf(t);case 3:return r=e.sent,Ur("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return function(){var e=(0,c.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Hr(t)).asyncQueue.verifyOperationInProgress(),Ur("RemoteStore","RemoteStore received new credentials"),i=Il(r),r.Gr.add(3),e.next=6,pl(r);case 6:return i&&r.Jr.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.Gr.delete(3),e.next=12,dl(r);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(n.remoteStore,e)})),t.onlineComponents=n;case 12:case"end":return e.stop()}}),e)}))),Rf.apply(this,arguments)}function Lf(e){return Of.apply(this,arguments)}function Of(){return Of=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return Ur("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,Df(t,new wf);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)}))),Of.apply(this,arguments)}function Mf(e){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,c.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return Ur("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,Nf(t,new If);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)}))),Pf.apply(this,arguments)}function Ff(e){return Lf(e).then((function(e){return e.persistence}))}function Vf(e){return Lf(e).then((function(e){return e.localStore}))}function Uf(e){return Mf(e).then((function(e){return e.remoteStore}))}function qf(e){return Mf(e).then((function(e){return e.syncEngine}))}function Bf(e){return jf.apply(this,arguments)}function jf(){return jf=(0,c.Z)(y().mark((function e(t){var n,r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mf(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Ih.bind(null,n.syncEngine),r.onUnlisten=Ah.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)}))),jf.apply(this,arguments)}function Kf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Yr;return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new xf({next:function(a){t.enqueueAndForget((function(){return uh(e,o)}));var u=a.docs.has(n);!u&&a.fromCache?i.reject(new Qr(Wr.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&a.fromCache&&r&&"server"===r.source?i.reject(new Qr(Wr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),o=new fh(wa(n.path),a,{includeMetadataChanges:!0,wo:!0});return ah(e,o)},i.next=3,Bf(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function Gf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Yr;return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new xf({next:function(n){t.enqueueAndForget((function(){return uh(e,o)})),n.fromCache&&"server"===r.source?i.reject(new Qr(Wr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),o=new fh(n,a,{includeMetadataChanges:!0,wo:!0});return ah(e,o)},i.next=3,Bf(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}var zf=(0,v.Z)((function e(t,n,r,i,a,o,u,s){(0,d.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.useFetchStreams=s})),Hf=function(){function e(t,n){(0,d.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,v.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}]),e}(),Wf=new Map;function Qf(e,t,n){if(!n)throw new Qr(Wr.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Yf(e,t,n,r){if(!0===t&&!0===r)throw new Qr(Wr.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function Xf(e){if(!Li.isDocumentKey(e))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Jf(e){if(Li.isDocumentKey(e))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function $f(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":Kr()}function ed(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Qr(Wr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=$f(e);throw new Qr(Wr.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function td(e,t){if(t<=0)throw new Qr(Wr.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var nd=function(){function e(t){var n;if((0,d.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new Qr(Wr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Qr(Wr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Yf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return(0,v.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),rd=function(){function e(t,n,r){(0,d.Z)(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nd({}),this._settingsFrozen=!1,t instanceof Hf?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Qr(Wr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hf(e.options.projectId)}(t))}return(0,v.Z)(e,[{key:"app",get:function(){if(!this._app)throw new Qr(Wr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new Qr(Wr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Jr;switch(e.type){case"gapi":var t=e.client;return Gr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new ni(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Qr(Wr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=Wf.get(e);t&&(Ur("ComponentProvider","Removing Datastore"),Wf.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function id(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=ed(e,rd))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&Br("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var o,u;if("string"==typeof i.mockUserToken)o=i.mockUserToken,u=Or.MOCK_USER;else{o=(0,w.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new Qr(Wr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Or(s)}e._authCredentials=new $r(new Xr(o,u))}}var ad=function(){function e(t,n,r){(0,d.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,v.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new ud(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),od=function(){function e(t,n,r){(0,d.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,v.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),ud=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this,e,r,wa(i)))._path=i,a.type="collection",a}return(0,v.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new ad(this.firestore,null,new Li(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(od);function sd(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,w.m9)(e),Qf("collection","path",t),e instanceof rd){var a=gi.fromString.apply(gi,[t].concat(r));return Jf(a),new ud(e,null,a)}if(!(e instanceof ad||e instanceof ud))throw new Qr(Wr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(gi.fromString.apply(gi,[t].concat(r)));return Jf(o),new ud(e.firestore,null,o)}function cd(e,t){if(e=ed(e,rd),Qf("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new od(e,null,function(e){return new ga(gi.emptyPath(),e)}(t))}function ld(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,w.m9)(e),1===arguments.length&&(t=si.A()),Qf("doc","path",t),e instanceof rd){var a=gi.fromString.apply(gi,[t].concat(r));return Xf(a),new ad(e,null,new Li(a))}if(!(e instanceof ad||e instanceof ud))throw new Qr(Wr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(gi.fromString.apply(gi,[t].concat(r)));return Xf(o),new ad(e.firestore,e instanceof ud?e.converter:null,new Li(o))}function hd(e,t){return e=(0,w.m9)(e),t=(0,w.m9)(t),(e instanceof ad||e instanceof ud)&&(t instanceof ad||t instanceof ud)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function fd(e,t){return e=(0,w.m9)(e),t=(0,w.m9)(t),e instanceof od&&t instanceof od&&e.firestore===t.firestore&&_a(e._query,t._query)&&e.converter===t.converter}var dd=function(){function e(){var t=this;(0,d.Z)(this,e),this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new ol(this,"async_queue_retry"),this.Ra=function(){var e=il();e&&Ur("AsyncQueue","Visibility state changed to "+e.visibilityState),t.ur.er()};var n=il();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Ra)}return(0,v.Z)(e,[{key:"isShuttingDown",get:function(){return this.ya}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.ba(),this.Pa(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.ya){this.ya=!0,this.Ia=e||!1;var t=il();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ra)}}},{key:"enqueue",value:function(e){var t=this;if(this.ba(),this.ya)return new Promise((function(){}));var n=new Yr;return this.Pa((function(){return t.ya&&t.Ia?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.ga.push(e),t.va()}))}},{key:"va",value:function(){var e=(0,c.Z)(y().mark((function e(){var t=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.ga.length){e.next=14;break}return e.prev=1,e.next=4,this.ga[0]();case 4:this.ga.shift(),this.ur.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Xu(e.t0)){e.next=12;break}throw e.t0;case 12:Ur("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.ga.length>0&&this.ur.Zi((function(){return t.va()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"Pa",value:function(e){var t=this,n=this.ma.then((function(){return t.Ea=!0,e().catch((function(e){t.Ta=e,t.Ea=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw qr("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.Ea=!1,e}))}));return this.ma=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.ba(),this.Aa.indexOf(e)>-1&&(t=0);var i=Jl.createAndSchedule(this,e,t,n,(function(e){return r.Va(e)}));return this.pa.push(i),i}},{key:"ba",value:function(){this.Ta&&Kr()}},{key:"verifyOperationInProgress",value:function(){}},{key:"Sa",value:function(){var e=(0,c.Z)(y().mark((function e(){var t;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ma,e.next=3,t;case 3:if(t!==this.ma){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Da",value:function(e){var t,n=(0,s.Z)(this.pa);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Ca",value:function(e){var t=this;return this.Sa().then((function(){t.pa.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=(0,s.Z)(t.pa);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.Sa()}))}},{key:"Na",value:function(e){this.Aa.push(e)}},{key:"Va",value:function(e){var t=this.pa.indexOf(e);this.pa.splice(t,1)}}]),e}();function vd(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=(0,s.Z)(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e)}var pd=function(){function e(){(0,d.Z)(this,e),this._progressObserver={},this._taskCompletionResolver=new Yr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return(0,v.Z)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),yd=-1,md=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this,e,r,i)).type="firestore",a._queue=new dd,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return(0,v.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||bd(this),this._firestoreClient.terminate()}}]),n}(rd);function gd(e,t){var n=(0,m.qX)(e,"firestore");if(n.isInitialized()){var r=n.getImmediate(),i=n.getOptions();if((0,w.vZ)(i,t))return r;throw new Qr(Wr.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Qr(Wr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:t})}function kd(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.Mq)();return(0,m.qX)(e,"firestore").getImmediate()}function wd(e){return e._firestoreClient||bd(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function bd(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new zf(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new _f(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Ed(e,t){Nd(e=ed(e,md));var n=wd(e),r=e._freezeSettings(),i=new If;return Td(n,i,new bf(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Id(e){Nd(e=ed(e,md));var t=wd(e),n=e._freezeSettings(),r=new If;return Td(t,r,new Ef(r,n.cacheSizeBytes))}function Td(e,t,n){var r=new Yr;return e.asyncQueue.enqueue((0,c.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Df(e,n);case 3:return i.next=5,Nf(e,t);case 5:r.resolve(),i.next=13;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===Wr.FAILED_PRECONDITION||e.code===Wr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i.t0)){i.next=12;break}throw i.t0;case 12:console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i.t0),r.reject(i.t0);case 13:case"end":return i.stop()}}),i,null,[[0,8]])})))).then((function(){return r.promise}))}function xd(e){if(e._initialized&&!e._terminated)throw new Qr(Wr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new Yr;return e._queue.enqueueAndForgetEvenWhileRestricted((0,c.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=(0,c.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wu.Pt()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Wu.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(oc(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}function Sd(e){return function(e){var t=new Yr;return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Uh,n.next=3,qf(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(wd(e=ed(e,md)))}function Ad(e){return function(e){return e.asyncQueue.enqueue((0,c.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(e);case 2:return n=t.sent,t.next=5,Uf(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=Hr(e);return t.Gr.delete(0),dl(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(wd(e=ed(e,md)))}function Zd(e){return function(e){return e.asyncQueue.enqueue((0,c.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(e);case 2:return n=t.sent,t.next=5,Uf(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=(0,c.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Hr(t)).Gr.add(0),e.next=4,pl(n);case 4:n.Jr.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(wd(e=ed(e,md)))}function _d(e){return(0,m.wN)(e.app,"firestore"),e._delete()}function Dd(e,t){var n=wd(e=ed(e,md)),r=new pd;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new Sf(e,t)}(function(e,t){if(e instanceof Uint8Array)return Tf(e,t);if(e instanceof ArrayBuffer)return Tf(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,al(t));e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=kf,t.next=3,qf(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function Cd(e,t){return function(e,t){return e.asyncQueue.enqueue((0,c.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=Hr(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Ye.getNamedQuery(e,t)}))},n.next=3,Vf(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(wd(e=ed(e,md)),t).then((function(t){return t?new od(e,null,t.query):null}))}function Nd(e){if(e._initialized||e._terminated)throw new Qr(Wr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Rd=function(){function e(){(0,d.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wi(n)}return(0,v.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();function Ld(){return new Rd("__name__")}var Od=function(){function e(t){(0,d.Z)(this,e),this._byteString=t}return(0,v.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(Ii.fromBase64String(t))}catch(t){throw new Qr(Wr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(Ii.fromUint8Array(t))}}]),e}(),Md=(0,v.Z)((function e(t){(0,d.Z)(this,e),this._methodName=t})),Pd=function(){function e(t,n){if((0,d.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new Qr(Wr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new Qr(Wr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,v.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return ci(this._lat,e._lat)||ci(this._long,e._long)}}]),e}(),Fd=/^__.*__$/,Vd=function(){function e(t,n,r){(0,d.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,v.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new uo(e,this.data,this.fieldMask,t,this.fieldTransforms):new oo(e,this.data,t,this.fieldTransforms)}}]),e}(),Ud=function(){function e(t,n,r){(0,d.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,v.Z)(e,[{key:"toMutation",value:function(e,t){return new uo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function qd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kr()}}var Bd=function(){function e(t,n,r,i,a,o){(0,d.Z)(this,e),this.settings=t,this.databaseId=n,this.k=r,this.ignoreUndefinedProperties=i,void 0===a&&this.ka(),this.fieldTransforms=a||[],this.fieldMask=o||[]}return(0,v.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"xa",get:function(){return this.settings.xa}},{key:"$a",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Oa",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Fa:!1});return r.Ma(e),r}},{key:"La",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Fa:!1});return r.ka(),r}},{key:"Ba",value:function(e){return this.$a({path:void 0,Fa:!0})}},{key:"Ua",value:function(e){return sv(e,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"ka",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.Ma(this.path.get(e))}},{key:"Ma",value:function(e){if(0===e.length)throw this.Ua("Document fields must not be empty");if(qd(this.xa)&&Fd.test(e))throw this.Ua('Document fields cannot begin and end with "__"')}}]),e}(),jd=function(){function e(t,n,r){(0,d.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.k=r||al(t)}return(0,v.Z)(e,[{key:"ja",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Bd({xa:e,methodName:t,Ka:n,path:wi.emptyPath(),Fa:!1,qa:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}]),e}();function Kd(e){var t=e._freezeSettings(),n=al(e._databaseId);return new jd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Gd(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.ja(a.merge||a.mergeFields?2:0,t,n,i);iv("Data must be an object, but it was:",o,r);var u,c,l=nv(r,o);if(a.merge)u=new bi(o.fieldMask),c=o.fieldTransforms;else if(a.mergeFields){var h,f=[],d=(0,s.Z)(a.mergeFields);try{for(d.s();!(h=d.n()).done;){var v=h.value,p=av(t,v,n);if(!o.contains(p))throw new Qr(Wr.INVALID_ARGUMENT,"Field '".concat(p,"' is specified in your field mask but missing from your input data."));cv(f,p)||f.push(p)}}catch(y){d.e(y)}finally{d.f()}u=new bi(f),c=o.fieldTransforms.filter((function(e){return u.covers(e.field)}))}else u=null,c=o.fieldTransforms;return new Vd(new Qi(l),u,c)}var zd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.xa)throw 1===e.xa?e.Ua("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Ua("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Md);function Hd(e,t,n){return new Bd({xa:3,Ka:t.settings.Ka,methodName:e._methodName,Fa:n},t.databaseId,t.k,t.ignoreUndefinedProperties)}var Wd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"_toFieldTransform",value:function(e){return new Ya(e.path,new Ba)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Md),Qd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).Qa=r,i}return(0,v.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Hd(this,e,!0),n=this.Qa.map((function(e){return tv(e,t)})),r=new ja(n);return new Ya(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Md),Yd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).Qa=r,i}return(0,v.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Hd(this,e,!0),n=this.Qa.map((function(e){return tv(e,t)})),r=new Ga(n);return new Ya(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Md),Xd=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).Wa=r,i}return(0,v.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new Ha(e.k,Pa(e.k,this.Wa));return new Ya(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Md);function Jd(e,t,n,r){var i=e.ja(1,t,n);iv("Data must be an object, but it was:",i,r);var a=[],o=Qi.empty();pi(r,(function(e,r){var u=uv(t,e,n);r=(0,w.m9)(r);var s=i.La(u);if(r instanceof zd)a.push(u);else{var c=tv(r,s);null!=c&&(a.push(u),o.set(u,c))}}));var u=new bi(a);return new Ud(o,u,i.fieldTransforms)}function $d(e,t,n,r,i,a){var o=e.ja(1,t,n),u=[av(t,r,n)],s=[i];if(a.length%2!=0)throw new Qr(Wr.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)u.push(av(t,a[c])),s.push(a[c+1]);for(var l=[],h=Qi.empty(),f=u.length-1;f>=0;--f)if(!cv(l,u[f])){var d=u[f],v=s[f];v=(0,w.m9)(v);var p=o.La(d);if(v instanceof zd)l.push(d);else{var y=tv(v,p);null!=y&&(l.push(d),h.set(d,y))}}var m=new bi(l);return new Ud(h,m,o.fieldTransforms)}function ev(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return tv(n,e.ja(r?4:3,t))}function tv(e,t){if(rv(e=(0,w.m9)(e)))return iv("Unsupported field value:",t,e),nv(e,t);if(e instanceof Md)return function(e,t){if(!qd(t.xa))throw t.Ua("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Ua("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fa&&4!==t.xa)throw t.Ua("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=(0,s.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=tv(n.value,t.Ba(i));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),i++}}catch(u){a.e(u)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,w.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Pa(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=fi.fromDate(e);return{timestampValue:zo(t.k,n)}}if(e instanceof fi){var r=new fi(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:zo(t.k,r)}}if(e instanceof Pd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Od)return{bytesValue:Ho(t.k,e._byteString)};if(e instanceof ad){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.Ua("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Yo(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ua("Unsupported field value: ".concat($f(e)))}(e,t)}function nv(e,t){var n={};return yi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):pi(e,(function(e,r){var i=tv(r,t.Oa(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function rv(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof fi||e instanceof Pd||e instanceof Od||e instanceof ad||e instanceof Md)}function iv(e,t,n){if(!rv(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=$f(n);throw"an object"===r?t.Ua(e+" a custom object"):t.Ua(e+" "+r)}}function av(e,t,n){if((t=(0,w.m9)(t))instanceof Rd)return t._internalPath;if("string"==typeof t)return uv(e,t);throw sv("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var ov=new RegExp("[~\\*/\\[\\]]");function uv(e,t,n){if(t.search(ov)>=0)throw sv("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,i.Z)(Rd,(0,f.Z)(t.split(".")))._internalPath}catch(r){throw sv("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function sv(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,u="Function ".concat(t,"() called with invalid data");n&&(u+=" (via `toFirestore()`)"),u+=". ";var s="";return(a||o)&&(s+=" (found",a&&(s+=" in field ".concat(r)),o&&(s+=" in document ".concat(i)),s+=")"),new Qr(Wr.INVALID_ARGUMENT,u+e+s)}function cv(e,t){return e.some((function(e){return e.isEqual(t)}))}var lv=function(){function e(t,n,r,i,a){(0,d.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,v.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new ad(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new hv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(fv("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),hv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"data",value:function(){return(0,a.Z)((0,o.Z)(n.prototype),"data",this).call(this)}}]),n}(lv);function fv(e,t){return"string"==typeof t?uv(e,t):t instanceof Rd?t._internalPath:t._delegate._internalPath}var dv=function(){function e(t,n){(0,d.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,v.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),vv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a,o,u){var s;return(0,d.Z)(this,n),(s=t.call(this,e,r,i,a,u))._firestore=e,s._firestoreImpl=e,s.metadata=o,s}return(0,v.Z)(n,[{key:"exists",value:function(){return(0,a.Z)((0,o.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new pv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(fv("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(lv),pv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,a.Z)((0,o.Z)(n.prototype),"data",this).call(this,e)}}]),n}(vv),yv=function(){function e(t,n,r,i){(0,d.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new dv(i.hasPendingWrites,i.fromCache),this.query=r}return(0,v.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new pv(n._firestore,n._userDataWriter,r.key,r,new dv(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Qr(Wr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new pv(e._firestore,e._userDataWriter,t.doc.key,t.doc,new dv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new pv(e._firestore,e._userDataWriter,t.doc.key,t.doc,new dv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:mv(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function mv(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr()}}function gv(e,t){return e instanceof vv&&t instanceof vv?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof yv&&t instanceof yv&&e._firestore===t._firestore&&fd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function kv(e){if(Ea(e)&&0===e.explicitOrderBy.length)throw new Qr(Wr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var wv=(0,v.Z)((function e(){(0,d.Z)(this,e)}));function bv(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=o._apply(e)}return e}var Ev=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this)).Ga=e,a.za=r,a.Ha=i,a.type="where",a}return(0,v.Z)(n,[{key:"_apply",value:function(e){var t=Kd(e.firestore),n=function(e,t,n,r,i,a,o){var u;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on FieldPath.documentId()."));if("in"===a||"not-in"===a){Pv(o,a);var c,l=[],h=(0,s.Z)(o);try{for(h.s();!(c=h.n()).done;){var f=c.value;l.push(Mv(r,e,f))}}catch(v){h.e(v)}finally{h.f()}u={arrayValue:{values:l}}}else u=Mv(r,e,o)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Pv(o,a),u=ev(n,"where",o,"in"===a||"not-in"===a);var d=ra.create(i,a,u);return function(e,t){if(t.V()){var n=Ta(e);if(null!==n&&!n.isEqual(t.field))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=Ia(e);null!==r&&Fv(e,t.field,r)}var i=function(e,t){var n,r=(0,s.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(v){r.e(v)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw i===t.op?new Qr(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new Qr(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,d),d}(e._query,0,t,e.firestore._databaseId,this.Ga,this.za,this.Ha);return new od(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}(wv);function Iv(e,t,n){var r=t,i=fv("where",e);return new Ev(i,r,n)}var Tv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this)).Ga=e,i.Ja=r,i.type="orderBy",i}return(0,v.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new va(t,n);return function(e,t){if(null===Ia(e)){var n=Ta(e);null!==n&&Fv(e,n,t.field)}}(e,r),r}(e._query,this.Ga,this.Ja);return new od(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new ga(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}(wv);function xv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=t,r=fv("orderBy",e);return new Tv(r,n)}var Sv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this)).type=e,a.Ya=r,a.Xa=i,a}return(0,v.Z)(n,[{key:"_apply",value:function(e){return new od(e.firestore,e.converter,Za(e._query,this.Ya,this.Xa))}}]),n}(wv);function Av(e){return td("limit",e),new Sv("limit",e,"F")}function Zv(e){return td("limitToLast",e),new Sv("limitToLast",e,"L")}var _v=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this)).type=e,a.Za=r,a.tc=i,a}return(0,v.Z)(n,[{key:"_apply",value:function(e){var t=Ov(e,this.type,this.Za,this.tc);return new od(e.firestore,e.converter,function(e,t){return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}(wv);function Dv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new _v("startAt",t,!0)}function Cv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new _v("startAfter",t,!1)}var Nv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var a;return(0,d.Z)(this,n),(a=t.call(this)).type=e,a.Za=r,a.tc=i,a}return(0,v.Z)(n,[{key:"_apply",value:function(e){var t=Ov(e,this.type,this.Za,this.tc);return new od(e.firestore,e.converter,function(e,t){return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}(wv);function Rv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Nv("endBefore",t,!0)}function Lv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Nv("endAt",t,!1)}function Ov(e,t,n,r){if(n[0]=(0,w.m9)(n[0]),n[0]instanceof lv)return function(e,t,n,r,i){if(!r)throw new Qr(Wr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,o=[],u=(0,s.Z)(Sa(e));try{for(u.s();!(a=u.n()).done;){var c=a.value;if(c.field.isKeyField())o.push(Bi(t,r.key));else{var l=r.data.field(c.field);if(Zi(l))throw new Qr(Wr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var h=c.field.canonicalString();throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(h,"' (used as the orderBy) does not exist."))}o.push(l)}}}catch(f){u.e(f)}finally{u.f()}return new fa(o,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Kd(e.firestore);return function(e,t,n,r,i,a){var o=e.explicitOrderBy;if(i.length>o.length)throw new Qr(Wr.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var u=[],s=0;s<i.length;s++){var c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!xa(e)&&-1!==c.indexOf("/"))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(gi.fromString(c));if(!Li.isDocumentKey(l))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new Li(l);u.push(Bi(t,h))}else{var f=ev(n,r,c);u.push(f)}}return new fa(u,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Mv(e,t,n){if("string"==typeof(n=(0,w.m9)(n))){if(""===n)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!xa(t)&&-1!==n.indexOf("/"))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(gi.fromString(n));if(!Li.isDocumentKey(r))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Bi(e,new Li(r))}if(n instanceof ad)return Bi(e,n._key);throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat($f(n),"."))}function Pv(e,t){if(!Array.isArray(e)||0===e.length)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new Qr(Wr.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function Fv(e,t,n){if(!n.isEqual(t))throw new Qr(Wr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var Vv=function(){function e(){(0,d.Z)(this,e)}return(0,v.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Oi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Si(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ai(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Kr()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return pi(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new Pd(Si(e.latitude),Si(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=_i(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Di(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=xi(e);return new fi(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=gi.fromString(e);Gr(Eu(n));var r=new Hf(n.get(1),n.get(3)),i=new Li(n.popFirst(5));return r.isEqual(t)||qr("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function Uv(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var qv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,v.Z)(n,[{key:"convertBytes",value:function(e){return new Od(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new ad(this.firestore,null,t)}}]),n}(Vv),Bv=function(){function e(t,n){(0,d.Z)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Kd(t)}return(0,v.Z)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=jv(e,this._firestore),i=Uv(r.converter,t,n),a=Gd(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Ja.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=jv(e,this._firestore),a=arguments.length,o=new Array(a>3?a-3:0),u=3;u<a;u++)o[u-3]=arguments[u];return r="string"==typeof(t=(0,w.m9)(t))||t instanceof Rd?$d(this._dataReader,"WriteBatch.update",i._key,t,n,o):Jd(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Ja.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=jv(e,this._firestore);return this._mutations=this._mutations.concat(new vo(t._key,Ja.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new Qr(Wr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function jv(e,t){if((e=(0,w.m9)(e)).firestore!==t)throw new Qr(Wr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Kv(e){e=ed(e,ad);var t=ed(e.firestore,md);return Kf(wd(t),e._key).then((function(n){return ip(t,e,n)}))}var Gv=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,d.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,v.Z)(n,[{key:"convertBytes",value:function(e){return new Od(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new ad(this.firestore,null,t)}}]),n}(Vv);function zv(e){e=ed(e,ad);var t=ed(e.firestore,md),n=wd(t),r=new Gv(t);return function(e,t){var n=new Yr;return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,c.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=Hr(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.Wn.Rn(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new Qr(Wr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=$l(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Vf(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new vv(t,r,e._key,n,new dv(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function Hv(e){e=ed(e,ad);var t=ed(e.firestore,md);return Kf(wd(t),e._key,{source:"server"}).then((function(n){return ip(t,e,n)}))}function Wv(e){e=ed(e,od);var t=ed(e.firestore,md),n=wd(t),r=new Gv(t);return kv(e._query),Gf(n,e._query).then((function(n){return new yv(t,r,e,n)}))}function Qv(e){e=ed(e,od);var t=ed(e.firestore,md),n=wd(t),r=new Gv(t);return function(e,t){var n=new Yr;return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,c.Z)(y().mark((function e(t,n,r){var i,a,o,u,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ic(t,n,!0);case 3:i=e.sent,a=new kh(n,i.zn),o=a.Po(i.documents),u=a.applyChanges(o,!1),r.resolve(u.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=$l(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Vf(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new yv(t,r,e,n)}))}function Yv(e){e=ed(e,od);var t=ed(e.firestore,md),n=wd(t),r=new Gv(t);return Gf(n,e._query,{source:"server"}).then((function(n){return new yv(t,r,e,n)}))}function Xv(e,t,n){e=ed(e,ad);var r=ed(e.firestore,md),i=Uv(e.converter,t,n);return rp(r,[Gd(Kd(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Ja.none())])}function Jv(e,t,n){e=ed(e,ad);for(var r=ed(e.firestore,md),i=Kd(r),a=arguments.length,o=new Array(a>3?a-3:0),u=3;u<a;u++)o[u-3]=arguments[u];return rp(r,[("string"==typeof(t=(0,w.m9)(t))||t instanceof Rd?$d(i,"updateDoc",e._key,t,n,o):Jd(i,"updateDoc",e._key,t)).toMutation(e._key,Ja.exists(!0))])}function $v(e){return rp(ed(e.firestore,md),[new vo(e._key,Ja.none())])}function ep(e,t){var n=ed(e.firestore,md),r=ld(e),i=Uv(e.converter,t);return rp(n,[Gd(Kd(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Ja.exists(!1))]).then((function(){return r}))}function tp(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=(0,w.m9)(e);var u={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||vd(n[s])||(u=n[s],s++);var l,h,f,d={includeMetadataChanges:u.includeMetadataChanges};if(vd(n[s])){var v=n[s];n[s]=null===(i=v.next)||void 0===i?void 0:i.bind(v),n[s+1]=null===(a=v.error)||void 0===a?void 0:a.bind(v),n[s+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof ad)h=ed(e.firestore,md),f=wa(e._key.path),l={next:function(t){n[s]&&n[s](ip(h,e,t))},error:n[s+1],complete:n[s+2]};else{var p=ed(e,od);h=ed(p.firestore,md),f=p._query;var m=new Gv(h);l={next:function(e){n[s]&&n[s](new yv(h,m,p,e))},error:n[s+1],complete:n[s+2]},kv(e._query)}return function(e,t,n,r){var i=new xf(r),a=new fh(t,i,n);return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=ah,t.next=3,Bf(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.na(),e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=uh,t.next=3,Bf(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(wd(h),f,d,l)}function np(e,t){return function(e,t){var n=new xf(t);return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Hr(e).io.add(t),t.next()},t.next=3,Bf(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.na(),e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Hr(e).io.delete(t)},t.next=3,Bf(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(wd(e=ed(e,md)),vd(t)?t:{next:t})}function rp(e,t){return function(e,t){var n=new Yr;return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=_h,r.next=3,qf(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(wd(e),t)}function ip(e,t,n){var r=n.docs.get(t._key),i=new Gv(e);return new vv(e,i,t._key,r,new dv(n.hasPendingWrites,n.fromCache),t.converter)}var ap=function(e){(0,l.Z)(n,e);var t=(0,h.Z)(n);function n(e,r){var i;return(0,d.Z)(this,n),(i=t.call(this,e,r))._firestore=e,i}return(0,v.Z)(n,[{key:"get",value:function(e){var t=this,r=jv(e,this._firestore),i=new Gv(this._firestore);return(0,a.Z)((0,o.Z)(n.prototype),"get",this).call(this,e).then((function(e){return new vv(t._firestore,i,r._key,e._document,new dv(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){(0,d.Z)(this,e),this._firestore=t,this._transaction=n,this._dataReader=Kd(t)}return(0,v.Z)(e,[{key:"get",value:function(e){var t=this,n=jv(e,this._firestore),r=new qv(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return Kr();var i=e[0];if(i.isFoundDocument())return new lv(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new lv(t._firestore,r,n._key,null,n.converter);throw Kr()}))}},{key:"set",value:function(e,t,n){var r=jv(e,this._firestore),i=Uv(r.converter,t,n),a=Gd(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=jv(e,this._firestore),a=arguments.length,o=new Array(a>3?a-3:0),u=3;u<a;u++)o[u-3]=arguments[u];return r="string"==typeof(t=(0,w.m9)(t))||t instanceof Rd?$d(this._dataReader,"Transaction.update",i._key,t,n,o):Jd(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=jv(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function op(e,t){return function(e,t){var n=new Yr;return e.asyncQueue.enqueueAndForget((0,c.Z)(y().mark((function r(){var i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,function(e){return Mf(e).then((function(e){return e.datastore}))}(e);case 2:i=r.sent,new Zf(e.asyncQueue,i,t,n).run();case 4:case"end":return r.stop()}}),r)})))),n.promise}(wd(e=ed(e,md)),(function(n){return t(new ap(e,n))}))}function up(){return new zd("deleteField")}function sp(){return new Wd("serverTimestamp")}function cp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Qd("arrayUnion",t)}function lp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Yd("arrayRemove",t)}function hp(e){return new Xd("increment",e)}function fp(e){return wd(e=ed(e,md)),new Bv(e,(function(t){return rp(e,t)}))}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Mr=e}(m.Jn),(0,m.Xd)(new g.wA("firestore",(function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new md(i,new ei(e.getProvider("auth-internal")),new ii(e.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a}),"PUBLIC")),(0,m.KN)(Lr,"3.4.2",e),(0,m.KN)(Lr,"3.4.2","esm2017")}()},9727:function(e){var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(C){s=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),o=new Z(r||[]);return a._invoke=function(e,t,n){var r=h;return function(i,a){if(r===d)throw new Error("Generator is already running");if(r===v){if("throw"===i)throw a;return D()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var u=x(o,n);if(u){if(u===p)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var s=l(e,t,n);if("normal"===s.type){if(r=n.done?v:f,s.arg===p)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=v,n.method="throw",n.arg=s.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(C){return{type:"throw",arg:C}}}e.wrap=c;var h="suspendedStart",f="suspendedYield",d="executing",v="completed",p={};function y(){}function m(){}function g(){}var k={};s(k,a,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(_([])));b&&b!==n&&r.call(b,a)&&(k=b);var E=g.prototype=y.prototype=Object.create(k);function I(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,a,o,u){var s=l(e[i],e,a);if("throw"!==s.type){var c=s.arg,h=c.value;return h&&"object"===typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,u)}),(function(e){n("throw",e,o,u)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,u)}))}u(s.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function x(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function _(e){if(e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:D}}function D(){return{value:t,done:!0}}return m.prototype=g,s(E,"constructor",g),s(g,"constructor",m),m.displayName=s(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},I(T.prototype),s(T.prototype,o,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new T(c(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},I(E),s(E,u,"Generator"),s(E,a,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=_,Z.prototype={constructor:Z,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return u.type="throw",u.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],u=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:_(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=t}catch(n){"object"===typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},5861:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var u=e[a](o),s=u.value}catch(c){return void n(c)}u.done?t(s):Promise.resolve(s).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function u(e){r(o,i,a,u,s,"next",e)}function s(e){r(o,i,a,u,s,"throw",e)}u(void 0)}))}}n.d(t,{Z:function(){return i}})},5647:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9611),i=n(8814);function a(e,t,n){return a=(0,i.Z)()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&(0,r.Z)(a,n.prototype),a},a.apply(null,arguments)}},7762:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(181);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,r.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){s=!0,o=e},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw o}}}}},3668:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(1120),i=n(8814);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}var o=n(7326);function u(e,t){if(t&&("object"===a(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,o.Z)(e)}function s(e){var t=(0,i.Z)();return function(){var n,i=(0,r.Z)(e);if(t){var a=(0,r.Z)(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return u(this,n)}}},1752:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(1120);function i(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}function a(){return a="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=i(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},a.apply(this,arguments)}},1120:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,{Z:function(){return r}})},136:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9611);function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,r.Z)(e,t)}},8814:function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,{Z:function(){return r}})},9474:function(e,t,n){"use strict";n.d(t,{ZR:function(){return d.ZR},Jn:function(){return N},l4:function(){return g},H9:function(){return E},Vr:function(){return I},Af:function(){return w},Z8:function(){return A},lz:function(){return b},qX:function(){return x},Xd:function(){return T},wN:function(){return S},P2:function(){return M},Mq:function(){return L},C6:function(){return O},ZF:function(){return R},TP:function(){return V},KN:function(){return F},Ub:function(){return U}});var r,i,a=n(5861),o=n(7762),u=n(4942),s=n(5671),c=n(9521),l=n(7757),h=n(3258),f=n(6781),d=n(1492),v=function(){function e(t){(0,s.Z)(this,e),this.container=t}return(0,c.Z)(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var p="@firebase/app",y="0.7.12",m=new f.Yd("@firebase/app"),g="[DEFAULT]",k=(r={},(0,u.Z)(r,p,"fire-core"),(0,u.Z)(r,"@firebase/app-compat","fire-core-compat"),(0,u.Z)(r,"@firebase/analytics","fire-analytics"),(0,u.Z)(r,"@firebase/analytics-compat","fire-analytics-compat"),(0,u.Z)(r,"@firebase/app-check","fire-app-check"),(0,u.Z)(r,"@firebase/app-check-compat","fire-app-check-compat"),(0,u.Z)(r,"@firebase/auth","fire-auth"),(0,u.Z)(r,"@firebase/auth-compat","fire-auth-compat"),(0,u.Z)(r,"@firebase/database","fire-rtdb"),(0,u.Z)(r,"@firebase/database-compat","fire-rtdb-compat"),(0,u.Z)(r,"@firebase/functions","fire-fn"),(0,u.Z)(r,"@firebase/functions-compat","fire-fn-compat"),(0,u.Z)(r,"@firebase/installations","fire-iid"),(0,u.Z)(r,"@firebase/installations-compat","fire-iid-compat"),(0,u.Z)(r,"@firebase/messaging","fire-fcm"),(0,u.Z)(r,"@firebase/messaging-compat","fire-fcm-compat"),(0,u.Z)(r,"@firebase/performance","fire-perf"),(0,u.Z)(r,"@firebase/performance-compat","fire-perf-compat"),(0,u.Z)(r,"@firebase/remote-config","fire-rc"),(0,u.Z)(r,"@firebase/remote-config-compat","fire-rc-compat"),(0,u.Z)(r,"@firebase/storage","fire-gcs"),(0,u.Z)(r,"@firebase/storage-compat","fire-gcs-compat"),(0,u.Z)(r,"@firebase/firestore","fire-fst"),(0,u.Z)(r,"@firebase/firestore-compat","fire-fst-compat"),(0,u.Z)(r,"fire-js","fire-js"),(0,u.Z)(r,"firebase","fire-js-all"),r),w=new Map,b=new Map;function E(e,t){try{e.container.addComponent(t)}catch(n){m.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function I(e,t){e.container.addOrOverwriteComponent(t)}function T(e){var t=e.name;if(b.has(t))return m.debug("There were multiple attempts to register component ".concat(t,".")),!1;b.set(t,e);var n,r=(0,o.Z)(w.values());try{for(r.s();!(n=r.n()).done;){E(n.value,e)}}catch(i){r.e(i)}finally{r.f()}return!0}function x(e,t){return e.container.getProvider(t)}function S(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;x(e,t).clearInstance(n)}function A(){b.clear()}var Z,_=(i={},(0,u.Z)(i,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),(0,u.Z)(i,"bad-app-name","Illegal App name: '{$appName}"),(0,u.Z)(i,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),(0,u.Z)(i,"app-deleted","Firebase App named '{$appName}' already deleted"),(0,u.Z)(i,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),(0,u.Z)(i,"invalid-log-argument","First argument to `onLog` must be null or a function."),i),D=new d.LL("app","Firebase",_),C=function(){function e(t,n,r){var i=this;(0,s.Z)(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new h.wA("app",(function(){return i}),"PUBLIC"))}return(0,c.Z)(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw D.create("app-deleted",{appName:this._name})}}]),e}(),N="9.6.2";function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==typeof t){var n=t;t={name:n}}var r=Object.assign({name:g,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw D.create("bad-app-name",{appName:String(i)});var a=w.get(i);if(a){if((0,d.vZ)(e,a.options)&&(0,d.vZ)(r,a.config))return a;throw D.create("duplicate-app",{appName:i})}var u,s=new h.H0(i),c=(0,o.Z)(b.values());try{for(c.s();!(u=c.n()).done;){var l=u.value;s.addComponent(l)}}catch(v){c.e(v)}finally{c.f()}var f=new C(e,r,s);return w.set(i,f),f}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=w.get(e);if(!t)throw D.create("no-app",{appName:e});return t}function O(){return Array.from(w.values())}function M(e){return P.apply(this,arguments)}function P(){return P=(0,a.Z)(l.mark((function e(t){var n;return l.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.name,!w.has(n)){e.next=6;break}return w.delete(n),e.next=5,Promise.all(t.container.getProviders().map((function(e){return e.delete()})));case 5:t.isDeleted=!0;case 6:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}function F(e,t,n){var r,i=null!==(r=k[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var u=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&u.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&u.push("and"),o&&u.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void m.warn(u.join(" "))}T(new h.wA("".concat(i,"-version"),(function(){return{library:i,version:t}}),"VERSION"))}function V(e,t){if(null!==e&&"function"!==typeof e)throw D.create("invalid-log-argument");(0,f.Am)(e,t)}function U(e){(0,f.Ub)(e)}Z="",T(new h.wA("platform-logger",(function(e){return new v(e)}),"PRIVATE")),F(p,y,Z),F(p,y,"esm2017"),F("fire-js","")},3258:function(e,t,n){"use strict";n.d(t,{wA:function(){return h},H0:function(){return v}});var r=n(3433),i=n(5861),a=n(9439),o=n(7762),u=n(5671),s=n(9521),c=n(7757),l=n(1492),h=function(){function e(t,n,r){(0,u.Z)(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return(0,s.Z)(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),f="[DEFAULT]",d=function(){function e(t,n){(0,u.Z)(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return(0,s.Z)(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new l.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:f})}catch(l){}var t,n=(0,o.Z)(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,a.Z)(t.value,2),i=r[0],u=r[1],s=this.normalizeInstanceIdentifier(i);try{var c=this.getOrInitializeService({instanceIdentifier:s});u.resolve(c)}catch(l){}}}catch(h){n.e(h)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=(0,i.Z)(c.mark((function e(){var t;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat((0,r.Z)(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),(0,r.Z)(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,u=this.getOrInitializeService({instanceIdentifier:r,options:n}),s=(0,o.Z)(this.instancesDeferred.entries());try{for(s.s();!(i=s.n()).done;){var c=(0,a.Z)(i.value,2),l=c[0],h=c[1],f=this.normalizeInstanceIdentifier(l);r===f&&h.resolve(u)}}catch(d){s.e(d)}finally{s.f()}return u}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(u){}}}catch(s){i.e(s)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===f?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(o){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.component?this.component.multipleInstances?e:f:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();var v=function(){function e(t){(0,u.Z)(this,e),this.name=t,this.providers=new Map}return(0,s.Z)(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new d(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}()},6781:function(e,t,n){"use strict";n.d(t,{in:function(){return i},Yd:function(){return v},Ub:function(){return p},Am:function(){return y}});var r,i,a=n(7762),o=n(5671),u=n(9521),s=n(4942),c=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));var l={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},h=i.INFO,f=(r={},(0,s.Z)(r,i.DEBUG,"log"),(0,s.Z)(r,i.VERBOSE,"log"),(0,s.Z)(r,i.INFO,"info"),(0,s.Z)(r,i.WARN,"warn"),(0,s.Z)(r,i.ERROR,"error"),r),d=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=f[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i,a=arguments.length,o=new Array(a>2?a-2:0),u=2;u<a;u++)o[u-2]=arguments[u];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},v=function(){function e(t){(0,o.Z)(this,e),this.name=t,this._logLevel=h,this._logHandler=d,this._userLogHandler=null,c.push(this)}return(0,u.Z)(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"===typeof e?l[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.DEBUG].concat(t)),this._logHandler.apply(this,[this,i.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.VERBOSE].concat(t)),this._logHandler.apply(this,[this,i.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.INFO].concat(t)),this._logHandler.apply(this,[this,i.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.WARN].concat(t)),this._logHandler.apply(this,[this,i.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.ERROR].concat(t)),this._logHandler.apply(this,[this,i.ERROR].concat(t))}}]),e}();function p(e){c.forEach((function(t){t.setLogLevel(e)}))}function y(e,t){var n,r=(0,a.Z)(c);try{var o=function(){var r=n.value,a=null;t&&t.level&&(a=l[t.level]),r.userLogHandler=null===e?null:function(t,n){for(var r=arguments.length,o=new Array(r>2?r-2:0),u=2;u<r;u++)o[u-2]=arguments[u];var s=o.map((function(e){if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((function(e){return e})).join(" ");n>=(null!==a&&void 0!==a?a:t.logLevel)&&e({level:i[n].toLowerCase(),message:s,args:o,type:t.name})}};for(r.s();!(n=r.n()).done;)o()}catch(u){r.e(u)}finally{r.f()}}}}]);
//# sourceMappingURL=62.40e53483.chunk.js.map